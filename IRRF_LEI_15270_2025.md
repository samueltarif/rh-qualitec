# üìã IRRF - Lei 15.270/2025

## üéØ Vis√£o Geral

Este documento descreve a implementa√ß√£o do c√°lculo de IRRF conforme a **Lei n¬∫ 15.270/2025**, v√°lida a partir de **01/01/2026**.

A lei introduz um **redutor legal** que beneficia trabalhadores com rendimentos at√© R$ 7.350,00, podendo zerar completamente o imposto para quem ganha at√© R$ 5.000,00.

---

## üìä Regra do Redutor Legal

### Faixas de Aplica√ß√£o

| Rendimentos Tribut√°veis | Redutor |
|------------------------|---------|
| ‚â§ R$ 5.000,00 | R$ 312,89 (m√°ximo) |
| R$ 5.000,01 a R$ 7.350,00 | 978,62 ‚àí (0,133145 √ó rendimentos) |
| > R$ 7.350,00 | R$ 0,00 (sem redutor) |

### F√≥rmula Final

```
IR_Final = max(0, IR_Tabela ‚àí min(IR_Tabela, Redutor))
```

### Regras Obrigat√≥rias

- ‚ùå O redutor **nunca pode ser negativo**
- ‚ùå O imposto final **nunca pode ser negativo**
- ‚úÖ O redutor aplicado √© **limitado ao valor do IR calculado pela tabela**

---

## üîß Arquivos Implementados

### Fun√ß√£o Central (Backend)

```
nuxt-app/server/utils/irrf-lei-15270-2025.ts
```

Esta √© a **√∫nica fonte de verdade** para o c√°lculo de IRRF. Todos os m√≥dulos devem usar esta fun√ß√£o.

**Fun√ß√µes exportadas:**
- `calcularIRRF()` - C√°lculo completo com detalhes
- `calcularIRRFSimples()` - Retorna apenas o valor
- `calcularRedutorLei15270()` - Calcula apenas o redutor
- `isLei15270EmVigor()` - Verifica vig√™ncia da lei
- `auditarIRRF()` - Audita e identifica diverg√™ncias
- `IRRF_CONFIG` - Configura√ß√£o com constantes legais

### Composable (Frontend)

```
nuxt-app/app/composables/useFolhaCalculos.ts
```

**Fun√ß√µes dispon√≠veis:**
- `calcularIRRF()` - C√°lculo com redutor
- `calcularIRRFDetalhado()` - C√°lculo com detalhes para holerite
- `calcularRedutorLei15270()` - C√°lculo do redutor
- `isLei15270EmVigor()` - Verifica√ß√£o de vig√™ncia

### APIs Atualizadas

| Arquivo | Descri√ß√£o |
|---------|-----------|
| `server/api/folha/calcular.post.ts` | C√°lculo da folha de pagamento |
| `server/api/holerites/gerar.post.ts` | Gera√ß√£o de holerites mensais |
| `server/api/decimo-terceiro/gerar.post.ts` | Gera√ß√£o de 13¬∫ sal√°rio |
| `server/api/auditoria/corrigir-irrf.post.ts` | Auditoria e corre√ß√£o de IRRF |

---

## üß™ Testes Automatizados

```
nuxt-app/server/utils/__tests__/irrf-lei-15270-2025.test.ts
```

### Instalar Vitest (se necess√°rio)

```bash
cd nuxt-app
npm install -D vitest
```

### Executar Testes

```bash
cd nuxt-app
npx vitest run server/utils/__tests__/irrf-lei-15270-2025.test.ts
```

### Executar Todos os Testes

```bash
npx vitest run
```

### Cen√°rios Cobertos

1. **Sal√°rio R$ 5.000, INSS R$ 450, 2 dependentes**
   - IR tabela ‚âà R$ 275,66
   - Redutor = R$ 312,89
   - **IR final = R$ 0,00** ‚úÖ

2. **Sal√°rio R$ 6.000 na faixa de transi√ß√£o**
   - Redutor parcial calculado
   - IR reduzido proporcionalmente

3. **Sal√°rios at√© R$ 5.000 sempre isentos**
   - Redutor m√°ximo aplicado
   - IR zerado ou muito reduzido

4. **13¬∫ sal√°rio com redutor**
   - 1¬™ parcela: sem IRRF
   - 2¬™ parcela: com redutor aplicado
   - Rendimentos totais considerados

5. **Sal√°rios > R$ 7.350 sem redutor**
   - IR da tabela mantido
   - Sem benef√≠cio do redutor

---

## üìÑ Exibi√ß√£o no Holerite

O holerite deve exibir claramente:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ DESCONTOS                                   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ INSS                           R$ 450,00    ‚îÇ
‚îÇ IRRF (Tabela)                  R$ 275,66    ‚îÇ
‚îÇ Redutor Lei 15.270/2025       -R$ 275,66    ‚îÇ
‚îÇ IRRF Retido                    R$ 0,00      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üîç Auditoria

A API de auditoria registra:

- IR antes do redutor
- Valor do redutor calculado
- Valor do redutor aplicado (limitado ao IR)
- IR final retido
- Diverg√™ncias entre m√≥dulos
- Alertas para m√∫ltiplas fontes de renda

### Endpoint

```
POST /api/auditoria/corrigir-irrf
```

### Payload

```json
{
  "salario_bruto": 5000,
  "inss": 450,
  "dependentes": 2,
  "colaborador_id": "uuid",
  "mes": "01",
  "ano": "2026"
}
```

---

## ‚öôÔ∏è Configura√ß√£o

As constantes legais est√£o centralizadas em:

```typescript
// nuxt-app/server/utils/irrf-lei-15270-2025.ts

export const IRRF_CONFIG = {
  tabela: {
    faixas: [...],
    deducaoPorDependente: 189.59,
  },
  lei15270: {
    vigenciaInicio: new Date('2026-01-01'),
    limiteIsencaoTotal: 5000.00,
    limiteFaixaTransicao: 7350.00,
    redutorMaximo: 312.89,
    coeficienteReducao: 0.133145,
    constanteReducao: 978.62,
  },
}
```

---

## üéÑ Regra Especial para 13¬∫ Sal√°rio

### 1¬™ Parcela (Novembro)
- 50% do valor proporcional
- **Sem descontos** (adiantamento)
- IRRF = R$ 0,00

### 2¬™ Parcela (Dezembro)
- 50% restante
- INSS e IRRF sobre o **valor total** do 13¬∫
- Redutor aplicado considerando **rendimentos totais do m√™s**:
  - Sal√°rio de dezembro
  - 13¬∫ sal√°rio
  - Outras verbas tribut√°veis

### Exemplo

```
Sal√°rio mensal: R$ 4.000,00
13¬∫ proporcional: R$ 4.000,00
Rendimentos totais dezembro: R$ 8.000,00

Como R$ 8.000 > R$ 7.350, redutor = R$ 0,00
IRRF calculado normalmente pela tabela.
```

---

## ‚úÖ Checklist de Conformidade

- [x] Todos os m√≥dulos usam a mesma fun√ß√£o de IRRF
- [x] Redutor aplicado corretamente em 100% dos cen√°rios
- [x] Nenhum IR negativo √© gerado
- [x] Auditoria validando os valores
- [x] Testes automatizados passando
- [x] C√≥digo documentado
- [x] Sistema pronto para produ√ß√£o em 2026

---

## ‚ö†Ô∏è Importante

- **N√£o altere a tabela progressiva** sem justificativa legal
- **N√£o simplifique c√°lculos** - priorize exatid√£o
- **Impostos errados podem gerar passivo fiscal, multas e fal√™ncia**
- A lei entra em vigor em **01/01/2026** - antes disso, o redutor n√£o √© aplicado

---

## üìû Suporte

Em caso de d√∫vidas sobre a implementa√ß√£o ou diverg√™ncias nos c√°lculos, consulte:

1. Texto da Lei 15.270/2025
2. Tabela progressiva do IRRF vigente
3. Contador ou advogado tributarista
