import{d as a,c as o,r as e}from"../../../_/nitro.mjs";import{s as r}from"../../../_/serverSupabaseClient.mjs";import{s as t}from"../../../_/serverSupabaseUser.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"@supabase/ssr";import"../../../_/fetch-retry.mjs";const s=a(async a=>{const s=await r(a),i=await t(a);if(!i)throw o({statusCode:401,message:"Não autenticado"});try{const r=await e(a),{data:t}=await s.from("app_users").select("id, role").eq("auth_uid",i.id).single();if(!t||!["admin","rh"].includes(t.role))throw o({statusCode:403,message:"Sem permissão"});const{data:c,error:n}=await s.from("relatorios_templates").insert({nome:r.nome,descricao:r.descricao,categoria:r.categoria,entidade_principal:r.entidade_principal,campos_selecionados:r.campos_selecionados,formato_padrao:r.formato_padrao||"pdf",orientacao:r.orientacao||"portrait",incluir_logo:!1!==r.incluir_logo,incluir_cabecalho:!1!==r.incluir_cabecalho,incluir_rodape:!1!==r.incluir_rodape,ativo:!1!==r.ativo,created_by:t.id}).select().single();if(n)throw n;return{success:!0,data:c}}catch(a){throw console.error("Erro ao criar template:",a),o({statusCode:a.statusCode||500,message:a.message||"Erro ao criar template de relatório"})}});export{s as default};
