import{d as a,c as o,g as e,r as t}from"../../../../_/nitro.mjs";import{s as r}from"../../../../_/serverSupabaseClient.mjs";import{s}from"../../../../_/serverSupabaseUser.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"@supabase/ssr";import"../../../../_/fetch-retry.mjs";const i=a(async a=>{const i=await r(a),c=await s(a);if(!c)throw o({statusCode:401,message:"Não autenticado"});try{const r=e(a,"id"),s=await t(a),{data:n}=await i.from("app_users").select("role").eq("auth_uid",c.id).single();if(!n||!["admin","rh"].includes(n.role))throw o({statusCode:403,message:"Sem permissão"});const{data:m,error:p}=await i.from("relatorios_templates").update({nome:s.nome,descricao:s.descricao,categoria:s.categoria,entidade_principal:s.entidade_principal,campos_selecionados:s.campos_selecionados,formato_padrao:s.formato_padrao,orientacao:s.orientacao,incluir_logo:s.incluir_logo,incluir_cabecalho:s.incluir_cabecalho,incluir_rodape:s.incluir_rodape,ativo:s.ativo,favorito:s.favorito}).eq("id",r).select().single();if(p)throw p;return{success:!0,data:m}}catch(a){throw console.error("Erro ao atualizar template:",a),o({statusCode:a.statusCode||500,message:a.message||"Erro ao atualizar template"})}});export{i as default};
