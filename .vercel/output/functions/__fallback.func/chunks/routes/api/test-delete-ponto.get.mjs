import{d as r}from"../../_/nitro.mjs";import{s as e}from"../../_/serverSupabaseClient.mjs";import{s as t}from"../../_/serverSupabaseUser.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"@supabase/ssr";import"../../_/fetch-retry.mjs";const o=r(async r=>{const o=await e(r),s=await t(r);if(!s)return{error:"Não autenticado"};try{const{data:r,error:e}=await o.from("registros_ponto").select("id, data, colaborador_id, entrada_1, saida_1, status").order("data",{ascending:!1}).limit(5);if(e)return{error:"Erro ao buscar registros",details:e};const t=(null==s?void 0:s.id)||(null==s?void 0:s.sub),{data:a,error:i}=await o.from("app_users").select("id, role, colaborador_id").eq("auth_uid",t).single();if(i)return{error:"Erro ao buscar usuário",details:i};const{data:d,error:n}=await o.rpc("get_table_policies",{table_name:"registros_ponto"}).select();return{success:!0,user:{id:t,appUser:a},registros:r||[],totalRegistros:(null==r?void 0:r.length)||0,policies:d||[],message:"Teste de DELETE API - Conectividade OK"}}catch(r){return{error:"Erro no teste",details:r.message}}});export{o as default};
