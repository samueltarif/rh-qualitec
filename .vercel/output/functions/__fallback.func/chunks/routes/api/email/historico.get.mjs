import{d as t,u as e,c as o,a}from"../../../_/nitro.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";const s=t(async t=>{try{const s=e(),r=s.public.supabaseUrl,i=s.supabaseServiceKey;if(!i)throw o({statusCode:500,message:"Service key n√£o configurada"});const n={Authorization:`Bearer ${i}`,apikey:i,Prefer:"count=exact"},c=a(t),m=parseInt(c.limit)||50,d=parseInt(c.offset)||0,l=c.status,p=c.contexto,f=await $fetch(`${r}/rest/v1/empresa?select=id&limit=1`,{headers:n});if(!f||0===f.length)return{data:[],total:0,limit:m,offset:d};let u=`${r}/rest/v1/historico_emails?empresa_id=eq.${f[0].id}&select=*,templates_email(nome)&order=created_at.desc&limit=${m}&offset=${d}`;l&&(u+=`&status=eq.${l}`),p&&(u+=`&contexto=eq.${p}`);const h=await $fetch(u,{headers:n});return{data:h||[],total:(null==h?void 0:h.length)||0,limit:m,offset:d}}catch(t){return console.error("[GET HISTORICO] Erro:",t.message||t),{data:[],total:0,limit:50,offset:0}}});export{s as default};
