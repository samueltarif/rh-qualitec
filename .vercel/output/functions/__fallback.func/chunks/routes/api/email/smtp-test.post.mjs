import{d as e,u as t,c as s,r as o}from"../../../_/nitro.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";const r=e(async e=>{try{const r=t(),a=r.public.supabaseUrl,i=r.supabaseServiceKey;if(!i)throw s({statusCode:500,message:"Service key não configurada"});const n={Authorization:`Bearer ${i}`,apikey:i,"Content-Type":"application/json",Prefer:"return=representation"};await o(e);await new Promise(e=>setTimeout(e,2e3));const c=await $fetch(`${a}/rest/v1/empresa?select=id&limit=1`,{headers:n});return c&&c.length>0&&await $fetch(`${a}/rest/v1/configuracoes_smtp?empresa_id=eq.${c[0].id}`,{method:"PATCH",headers:n,body:{testado:!0,ultima_verificacao:(new Date).toISOString()}}),{success:!0,message:"Conexão SMTP testada com sucesso!"}}catch(e){return console.error("[TEST SMTP] Erro:",e.message||e),{success:!1,message:e.message||"Erro ao testar conexão SMTP"}}});export{r as default};
