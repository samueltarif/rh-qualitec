import{d as e,u as t,c as o,r as a}from"../../../../_/nitro.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";const r=e(async e=>{var r;try{const s=t(),i=s.public.supabaseUrl,n=s.supabaseServiceKey;if(!n)throw o({statusCode:500,message:"Service key nÃ£o configurada"});const p={Authorization:`Bearer ${n}`,apikey:n,"Content-Type":"application/json",Prefer:"return=representation"},c=null==(r=e.context.params)?void 0:r.id,d=await a(e),m=await $fetch(`${i}/rest/v1/templates_email?id=eq.${c}&select=sistema`,{headers:p});let u={...d};m&&m.length>0&&m[0].sistema&&(u={nome:d.nome,descricao:d.descricao,assunto:d.assunto,corpo_html:d.corpo_html,corpo_texto:d.corpo_texto,ativo:d.ativo,prioridade:d.prioridade,variaveis_disponiveis:d.variaveis_disponiveis,requer_confirmacao_leitura:d.requer_confirmacao_leitura});const l=await $fetch(`${i}/rest/v1/templates_email?id=eq.${c}`,{method:"PATCH",headers:p,body:{...u,updated_at:(new Date).toISOString()}});return l&&l.length>0?l[0]:l}catch(e){throw console.error("[PUT TEMPLATE] Erro:",e.message||e),o({statusCode:e.statusCode||500,message:e.message||"Erro ao atualizar template"})}});export{r as default};
