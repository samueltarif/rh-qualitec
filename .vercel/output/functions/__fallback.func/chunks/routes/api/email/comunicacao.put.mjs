import{d as e,u as t,c as a,r as o}from"../../../_/nitro.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";const r=e(async e=>{try{const r=t(),s=r.public.supabaseUrl,i=r.supabaseServiceKey;if(!i)throw a({statusCode:500,message:"Service key não configurada"});const n={Authorization:`Bearer ${i}`,apikey:i,"Content-Type":"application/json",Prefer:"return=representation"},c=await o(e),d=await $fetch(`${s}/rest/v1/empresa?select=id&limit=1`,{headers:n});if(!d||0===d.length)throw a({statusCode:404,message:"Empresa não encontrada"});const m=await $fetch(`${s}/rest/v1/configuracoes_comunicacao?empresa_id=eq.${d[0].id}&select=id`,{headers:n});let p;return p=m&&m.length>0?await $fetch(`${s}/rest/v1/configuracoes_comunicacao?id=eq.${m[0].id}`,{method:"PATCH",headers:n,body:{...c,updated_at:(new Date).toISOString()}}):await $fetch(`${s}/rest/v1/configuracoes_comunicacao`,{method:"POST",headers:n,body:{...c,empresa_id:d[0].id}}),p&&p.length>0?p[0]:p}catch(e){throw console.error("[PUT COMUNICACAO] Erro:",e.message||e),a({statusCode:e.statusCode||500,message:e.message||"Erro ao salvar configurações de comunicação"})}});export{r as default};
