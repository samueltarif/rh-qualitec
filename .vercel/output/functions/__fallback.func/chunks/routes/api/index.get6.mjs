import{d as o,a,c as r}from"../../_/nitro.mjs";import{s as t}from"../../_/serverSupabaseClient.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"@supabase/ssr";import"../../_/fetch-retry.mjs";const e=o(async o=>{const e=await t(o),s=a(o),{status:i,colaborador_id:d,ano:n}=s;try{let o=e.from("ferias").select("*").order("created_at",{ascending:!1});if(i&&"todos"!==i&&(o=o.eq("status",i)),d&&(o=o.eq("colaborador_id",d)),n){const a=parseInt(n);o=o.gte("data_inicio",`${a}-01-01`).lte("data_inicio",`${a}-12-31`)}const{data:a,error:t}=await o;if(t)throw console.error("Erro ao buscar férias:",t),r({statusCode:500,message:t.message});const s=[...new Set((a||[]).map(o=>o.colaborador_id).filter(Boolean))];let c={};if(s.length>0){const{data:o}=await e.from("colaboradores").select("id, nome, matricula, email_corporativo").in("id",s);o&&(c=Object.fromEntries(o.map(o=>[o.id,o])))}return(a||[]).map(o=>{const a=c[o.colaborador_id];return{...o,colaborador_nome:(null==a?void 0:a.nome)||"",cargo:"",departamento:"",dias_solicitados:o.dias_gozo,dias_venda:o.dias_abono}})}catch(o){throw console.error("Erro ao buscar férias:",o),r({statusCode:500,message:o.message||"Erro ao buscar férias"})}});export{e as default};
