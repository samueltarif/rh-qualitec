import{d as o,c as a,r as e}from"../../_/nitro.mjs";import{s as r}from"../../_/serverSupabaseClient.mjs";import{s}from"../../_/serverSupabaseUser.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"@supabase/ssr";import"../../_/fetch-retry.mjs";const t=o(async o=>{const t=await r(o),i=await s(o);if(!i)throw a({statusCode:401,message:"Não autenticado"});try{const r=await e(o),{data:s}=await t.from("app_users").select("id, role").eq("auth_uid",i.id).single();if(!s||!["admin","rh"].includes(s.role))throw a({statusCode:403,message:"Sem permissão"});const{data:m,error:d}=await t.from("campos_customizados").insert({nome:r.nome,label:r.label,descricao:r.descricao,entidade:r.entidade,tipo_campo:r.tipo_campo,opcoes:r.opcoes,obrigatorio:r.obrigatorio||!1,valor_padrao:r.valor_padrao,mascara:r.mascara,ordem:r.ordem||0,grupo:r.grupo,visivel:!1!==r.visivel,editavel:!1!==r.editavel,ativo:!1!==r.ativo,created_by:s.id}).select().single();if(d)throw d;return{success:!0,data:m}}catch(o){throw console.error("Erro ao criar campo customizado:",o),a({statusCode:o.statusCode||500,message:o.message||"Erro ao criar campo customizado"})}});export{t as default};
