import{d as e,c as t,g as a,s as o}from"../../../../../_/nitro.mjs";import{s as r}from"../../../../../_/serverSupabaseUser.mjs";import{s}from"../../../../../_/serverSupabaseClient.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"@supabase/ssr";import"../../../../../_/fetch-retry.mjs";const m=e(async e=>{try{if(!await r(e))throw t({statusCode:401,message:"Não autenticado"});const m=a(e,"id");if(!m)throw t({statusCode:400,message:"ID não fornecido"});const n=await s(e),{data:i,error:p}=await n.from("templates_importacao").select("*").eq("id",m).single();if(p)throw p;if(!i)throw t({statusCode:404,message:"Template não encontrado"});let c="";const d=i;if(d.campos_mapeamento&&Array.isArray(d.campos_mapeamento)){c=d.campos_mapeamento.map(e=>e.campo).join(",")+"\n";c+=d.campos_mapeamento.map(e=>{switch(e.tipo){case"string":return"Exemplo";case"email":return"exemplo@email.com";case"date":return"2024-01-01";case"decimal":return"1000.00";case"integer":return"10";case"boolean":return"true";default:return""}}).join(",")+"\n"}return o(e,{"Content-Type":"text/csv","Content-Disposition":`attachment; filename="${d.nome.replace(/[^a-z0-9]/gi,"_")}.csv"`}),c}catch(e){throw console.error("Erro ao baixar template:",e),t({statusCode:e.statusCode||500,message:e.message||"Erro ao baixar template"})}});export{m as default};
