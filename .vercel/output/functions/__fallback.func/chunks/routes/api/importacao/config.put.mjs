import{d as o,c as a,r}from"../../../_/nitro.mjs";import{s as e}from"../../../_/serverSupabaseUser.mjs";import{s as t}from"../../../_/serverSupabaseClient.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"@supabase/ssr";import"../../../_/fetch-retry.mjs";const s=o(async o=>{if(!await e(o))throw a({statusCode:401,message:"Não autenticado"});const s=await r(o),i=await t(o);try{const o={id:"00000000-0000-0000-0000-000000000001",tamanho_maximo_arquivo:s.tamanho_maximo_arquivo,tempo_expiracao_exportacao:s.tempo_expiracao_exportacao,limite_registros_exportacao:s.limite_registros_exportacao,encoding_padrao:s.encoding_padrao,delimitador_csv:s.delimitador_csv,validacao_automatica:s.validacao_automatica,backup_antes_importacao:s.backup_antes_importacao,notificar_conclusao:s.notificar_conclusao,permitir_importacao_paralela:s.permitir_importacao_paralela,updated_at:(new Date).toISOString()};console.log("Tentando upsert com dados:",o);const{data:r,error:e}=await i.from("config_importacao_exportacao").upsert(o,{onConflict:"id"}).select();if(e)throw console.error("Erro no upsert:",e),console.error("Código do erro:",e.code),console.error("Mensagem do erro:",e.message),console.error("Detalhes do erro:",e.details),a({statusCode:500,message:`Erro ao salvar: ${e.message}`});console.log("Upsert bem-sucedido, data:",r);return{success:!0,data:Array.isArray(r)?r[0]:r}}catch(o){throw console.error("Erro geral ao atualizar configurações:",o),a({statusCode:o.statusCode||500,message:o.message||"Erro ao atualizar configurações"})}});export{s as default};
