import{d as t}from"../../../_/nitro.mjs";import{s as e}from"../../../_/serverSupabaseClient.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"@supabase/ssr";import"../../../_/fetch-retry.mjs";const o=t(async t=>{const o=await e(t),a=new Date;a.setDate(a.getDate()-30);const{data:s}=await o.from("logs_sincronizacao").select("tipo_integracao, status").gte("created_at",a.toISOString()),{data:i}=await o.from("arquivos_cnab").select("status").order("created_at",{ascending:!1}).limit(10),{data:l}=await o.from("eventos_esocial").select("status").gte("created_at",a.toISOString()),{data:n}=await o.from("historico_emails").select("status").gte("created_at",a.toISOString());return{sincronizacoes:{total:(null==s?void 0:s.length)||0,sucesso:(null==s?void 0:s.filter(t=>"sucesso"===t.status).length)||0,erro:(null==s?void 0:s.filter(t=>"erro"===t.status).length)||0,por_tipo:{contabilidade:(null==s?void 0:s.filter(t=>"contabilidade"===t.tipo_integracao).length)||0,esocial:(null==s?void 0:s.filter(t=>"esocial"===t.tipo_integracao).length)||0,banco:(null==s?void 0:s.filter(t=>"banco"===t.tipo_integracao).length)||0,ponto:(null==s?void 0:s.filter(t=>"ponto"===t.tipo_integracao).length)||0}},cnabs:{total:(null==i?void 0:i.length)||0,gerados:(null==i?void 0:i.filter(t=>"gerado"===t.status).length)||0,processados:(null==i?void 0:i.filter(t=>"processado"===t.status).length)||0},esocial:{total:(null==l?void 0:l.length)||0,enviados:(null==l?void 0:l.filter(t=>"enviado"===t.status).length)||0,processados:(null==l?void 0:l.filter(t=>"processado"===t.status).length)||0,erros:(null==l?void 0:l.filter(t=>"erro"===t.status).length)||0},emails:{total:(null==n?void 0:n.length)||0,enviados:(null==n?void 0:n.filter(t=>"enviado"===t.status).length)||0,abertos:(null==n?void 0:n.filter(t=>"aberto"===t.status).length)||0}}});export{o as default};
