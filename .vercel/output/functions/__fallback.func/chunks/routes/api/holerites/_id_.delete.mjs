import{d as e,g as o,c as t}from"../../../_/nitro.mjs";import{s}from"../../../_/serverSupabaseClient.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"@supabase/ssr";import"../../../_/fetch-retry.mjs";const r=e(async e=>{try{const r=o(e,"id");if(!r)throw t({statusCode:400,message:"ID do holerite é obrigatório"});const a=await s(e),{data:{user:i}}=await a.auth.getUser();if(!i)throw t({statusCode:401,message:"Não autenticado"});const{data:d,error:m}=await a.from("holerites").select("id, nome_colaborador, mes, ano, tipo, status").eq("id",r).single();if(m||!d)throw t({statusCode:404,message:"Holerite não encontrado"});if("enviado"===d.status||"pago"===d.status)throw t({statusCode:400,message:"Não é possível excluir holerite já enviado ou pago"});const{error:n}=await a.from("holerites").delete().eq("id",r);if(n)throw console.error("Erro ao excluir holerite:",n),t({statusCode:500,message:"Erro ao excluir holerite"});return{success:!0,message:`Holerite de ${d.nome_colaborador} (${d.mes}/${d.ano}) excluído com sucesso`}}catch(e){throw console.error("Erro ao excluir holerite:",e),t({statusCode:e.statusCode||500,message:e.message||"Erro ao excluir holerite"})}});export{r as default};
