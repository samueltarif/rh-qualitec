import{d as o,c as t,g as e}from"../../../_/nitro.mjs";import{s}from"../../../_/serverSupabaseClient.mjs";import{s as a}from"../../../_/serverSupabaseUser.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"@supabase/ssr";import"../../../_/fetch-retry.mjs";const r=o(async o=>{const r=await s(o),i=await a(o),d=(null==i?void 0:i.sub)||(null==i?void 0:i.id);if(!i||!d)throw t({statusCode:401,message:"Não autenticado"});const n=e(o,"id");if(!n)throw t({statusCode:400,message:"ID do holerite é obrigatório"});try{const{data:o,error:e}=await r.from("holerites").select("*").eq("id",n).single();if(e)throw e;if(!o)throw t({statusCode:404,message:"Holerite não encontrado"});const{data:s}=await r.from("app_users").select("role").eq("auth_uid",d).single();return"funcionario"!==(null==s?void 0:s.role)||o.visualizado_em||(await r.from("holerites").update({visualizado_em:(new Date).toISOString(),status:"visualizado"}).eq("id",n),o.visualizado_em=(new Date).toISOString(),o.status="visualizado"),{success:!0,data:o}}catch(o){throw console.error("Erro ao buscar holerite:",o),t({statusCode:500,message:o.message||"Erro ao buscar holerite"})}});export{r as default};
