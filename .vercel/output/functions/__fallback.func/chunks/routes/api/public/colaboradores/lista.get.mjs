import{d as o,s as e,c as a}from"../../../../_/nitro.mjs";import{s as t}from"../../../../_/serverSupabaseServiceRole.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"@supabase/functions-js";import"../../../../virtual/_commonjsHelpers.mjs";import"@supabase/postgrest-js";import"@supabase/realtime-js";import"@supabase/storage-js";import"@supabase/auth-js";import"../../../../_/fetch-retry.mjs";const s=o(async o=>{try{const a=t(o);console.log("üîç [P√öBLICO] Listando colaboradores...");const{data:s,error:r}=await a.from("colaboradores").select("id, nome, matricula, cargo:cargos(nome), departamento:departamentos(nome)").order("nome");if(r)throw r;const l=null==s?void 0:s.map(o=>({...o,links:{html:`/api/public/ponto/download-html?colaborador_id=${o.id}`,pdf:`/api/public/ponto/download-pdf?colaborador_id=${o.id}`,htmlMesAtual:`/api/public/ponto/download-html?colaborador_id=${o.id}&mes=${(new Date).getMonth()+1}&ano=${(new Date).getFullYear()}`,pdfMesAtual:`/api/public/ponto/download-pdf?colaborador_id=${o.id}&mes=${(new Date).getMonth()+1}&ano=${(new Date).getFullYear()}`}}));return e(o,{"Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET","Access-Control-Allow-Headers":"Content-Type"}),{success:!0,data:l,total:(null==l?void 0:l.length)||0,message:"Lista de colaboradores com links de acesso p√∫blico"}}catch(o){throw console.error("Erro ao listar colaboradores:",o),a({statusCode:500,message:"Erro ao listar colaboradores: "+o.message})}});export{s as default};
