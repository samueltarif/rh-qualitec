import{d as t,c as a}from"../../../_/nitro.mjs";import{s as e}from"../../../_/serverSupabaseClient.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"@supabase/ssr";import"../../../_/fetch-retry.mjs";const o=t(async t=>{const o=await e(t);try{const{data:t,error:e}=await o.from("ferias").select("status, dias_gozo, dias_abono, data_inicio, data_fim, periodo_aquisitivo_fim");if(e)throw console.error("Erro ao buscar estatísticas:",e),a({statusCode:500,message:e.message});const s=new Date,i=s.getFullYear(),r={pendentes:0,aprovadas:0,em_gozo:0,concluidas:0,rejeitadas:0,vencendo:0,total_dias_ano:0};for(const a of t||[]){if("Pendente"===a.status&&r.pendentes++,"Aprovada"===a.status&&r.aprovadas++,"Em_Andamento"===a.status&&r.em_gozo++,"Concluida"===a.status&&r.concluidas++,"Rejeitada"===a.status&&r.rejeitadas++,a.periodo_aquisitivo_fim){const t=new Date(a.periodo_aquisitivo_fim);t.setFullYear(t.getFullYear()+1);const e=Math.ceil((t.getTime()-s.getTime())/864e5);e>0&&e<=60&&"Pendente"===a.status&&r.vencendo++}if(a.data_inicio){new Date(a.data_inicio).getFullYear()===i&&["Aprovada","Em_Andamento","Concluida"].includes(a.status)&&(r.total_dias_ano+=a.dias_gozo||0)}}return r}catch(t){throw console.error("Erro ao buscar estatísticas:",t),a({statusCode:500,message:t.message||"Erro ao buscar estatísticas"})}});export{o as default};
