import{d as e,r,c as o}from"../../../_/nitro.mjs";import{s as a}from"../../../_/serverSupabaseClient.mjs";import{s as t}from"../../../_/serverSupabaseUser.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"@supabase/ssr";import"../../../_/fetch-retry.mjs";const s=e(async e=>{const s=await a(e),i=await t(e),m=await r(e),{id:p,acao:d,motivo_rejeicao:n}=m;if(!p||!d)throw o({statusCode:400,message:"ID e ação são obrigatórios"});if("aprovar"!==d&&"rejeitar"!==d)throw o({statusCode:400,message:'Ação deve ser "aprovar" ou "rejeitar"'});if("rejeitar"===d&&!n)throw o({statusCode:400,message:"Motivo da rejeição é obrigatório"});let f=null;if(i){const{data:e}=await s.from("users").select("id").eq("auth_uid",i.id).single();e&&(f=e.id)}const u={status:"aprovar"===d?"Aprovada":"Rejeitada",aprovado_em:(new Date).toISOString(),aprovado_por:f};"rejeitar"===d&&(u.motivo_rejeicao=n);const{data:c,error:v}=await s.from("ferias").update(u).eq("id",p).select().single();if(v)throw console.error("Erro ao aprovar/rejeitar férias:",v),o({statusCode:500,message:v.message});return c});export{s as default};
