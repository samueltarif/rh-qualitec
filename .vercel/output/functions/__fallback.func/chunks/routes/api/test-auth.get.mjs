import{d as e}from"../../_/nitro.mjs";import{s as o}from"../../_/serverSupabaseUser.mjs";import{s as r}from"../../_/serverSupabaseClient.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"@supabase/ssr";import"../../_/fetch-retry.mjs";const s=e(async e=>{const s=await o(e),t=await r(e),i=(null==s?void 0:s.id)||(null==s?void 0:s.sub);if(console.log("ğŸ” [TEST AUTH] User object:",s),console.log("ğŸ” [TEST AUTH] User ID (id):",null==s?void 0:s.id),console.log("ğŸ” [TEST AUTH] User ID (sub):",null==s?void 0:s.sub),console.log("ğŸ” [TEST AUTH] User ID final:",i),!s||!i)return{authenticated:!1,error:"UsuÃ¡rio nÃ£o autenticado ou sessÃ£o invÃ¡lida",user:null,app_user:null};let a=null;try{const{data:e,error:o}=await t.from("app_users").select("id, role, colaborador_id").eq("auth_uid",i).single();o?console.error("âŒ [TEST AUTH] Erro ao buscar app_user:",o):a=e}catch(e){console.error("âŒ [TEST AUTH] Exception:",e)}return{authenticated:!0,user:{id:i,email:s.email,id_type:typeof i,id_length:null==i?void 0:i.length,is_valid_uuid:/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(i),has_id_field:!!s.id,has_sub_field:!!s.sub},app_user:a,timestamp:(new Date).toISOString()}});export{s as default};
