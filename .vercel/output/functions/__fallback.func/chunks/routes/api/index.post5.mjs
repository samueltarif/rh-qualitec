import{d as o,r as a,c as t}from"../../_/nitro.mjs";import{s as i}from"../../_/serverSupabaseClient.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"@supabase/ssr";import"../../_/fetch-retry.mjs";const e=o(async o=>{const e=await i(o),s=await a(o),{colaborador_id:r,periodo_aquisitivo_inicio:d,periodo_aquisitivo_fim:n,data_inicio:m,data_fim:_,dias_gozo:p,dias_abono:c=0,tipo:l="normal",vender_dias:f=!1,adiantamento_13:g=!1,observacoes:u}=s;if(!(r&&m&&_&&p))throw t({statusCode:400,message:"Campos obrigatórios: colaborador_id, data_inicio, data_fim, dias_gozo"});let b=d,w=n;if(!b||!w){const{data:o}=await e.from("colaboradores").select("data_admissao").eq("id",r).single();if(o){const a=new Date(o.data_admissao),t=new Date,i=Math.floor((t.getTime()-a.getTime())/315576e5);b=new Date(a),b.setFullYear(a.getFullYear()+i),w=new Date(b),w.setFullYear(w.getFullYear()+1),w.setDate(w.getDate()-1),b=b.toISOString().split("T")[0],w=w.toISOString().split("T")[0]}}const{data:v,error:h}=await e.from("ferias").insert({colaborador_id:r,periodo_aquisitivo_inicio:b,periodo_aquisitivo_fim:w,data_inicio:m,data_fim:_,dias_gozo:p,dias_abono:f?c:0,tipo:l,vender_dias:f,adiantamento_13:g,observacoes:u,status:"Pendente",solicitado_em:(new Date).toISOString()}).select().single();if(h)throw console.error("Erro ao criar solicitação de férias:",h),t({statusCode:500,message:h.message});return v});export{e as default};
