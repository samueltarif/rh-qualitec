import{d as t,u as e,c as i}from"../../../_/nitro.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";const a=t(async t=>{try{const t=e(),a=t.public.supabaseUrl,o=t.supabaseServiceKey;if(!o)throw i({statusCode:500,message:"Service key não configurada"});const s={Authorization:`Bearer ${o}`,apikey:o,"Content-Type":"application/json"},l=await $fetch(`${a}/rest/v1/politicas_compliance?select=id,status,publicado,obrigatorio_aceite`,{headers:s}),n=await $fetch(`${a}/rest/v1/politicas_aceites?select=aceito,atrasado,prazo_aceite`,{headers:s}),r=await $fetch(`${a}/rest/v1/politicas_incidentes?select=status,gravidade`,{headers:s}),c=await $fetch(`${a}/rest/v1/politicas_treinamentos?select=id,ativo`,{headers:s});return{totalPoliticas:(null==l?void 0:l.length)||0,politicasPublicadas:(null==l?void 0:l.filter(t=>t.publicado).length)||0,politicasRascunho:(null==l?void 0:l.filter(t=>"rascunho"===t.status).length)||0,politicasObrigatorias:(null==l?void 0:l.filter(t=>t.obrigatorio_aceite).length)||0,totalAceites:(null==n?void 0:n.length)||0,aceitesCompletos:(null==n?void 0:n.filter(t=>t.aceito).length)||0,aceitesPendentes:(null==n?void 0:n.filter(t=>!t.aceito).length)||0,aceitesAtrasados:(null==n?void 0:n.filter(t=>t.atrasado).length)||0,taxaAceite:(null==n?void 0:n.length)>0?(n.filter(t=>t.aceito).length/n.length*100).toFixed(1):"0.0",totalIncidentes:(null==r?void 0:r.length)||0,incidentesAbertos:(null==r?void 0:r.filter(t=>"aberto"===t.status).length)||0,incidentesCriticos:(null==r?void 0:r.filter(t=>"critica"===t.gravidade).length)||0,totalTreinamentos:(null==c?void 0:c.length)||0,treinamentosAtivos:(null==c?void 0:c.filter(t=>t.ativo).length)||0}}catch(t){throw console.error("[GET STATS POLÍTICAS] Erro:",t.message||t),i({statusCode:t.statusCode||500,message:t.message||"Erro ao buscar estatísticas"})}});export{a as default};
