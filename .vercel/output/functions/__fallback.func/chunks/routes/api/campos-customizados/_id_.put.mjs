import{d as o,c as a,g as s,r as t}from"../../../_/nitro.mjs";import{s as e}from"../../../_/serverSupabaseClient.mjs";import{s as r}from"../../../_/serverSupabaseUser.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"@supabase/ssr";import"../../../_/fetch-retry.mjs";const i=o(async o=>{const i=await e(o),m=await r(o);if(!m)throw a({statusCode:401,message:"Não autenticado"});try{const e=s(o,"id"),r=await t(o),{data:p}=await i.from("app_users").select("role").eq("auth_uid",m.id).single();if(!p||!["admin","rh"].includes(p.role))throw a({statusCode:403,message:"Sem permissão"});const{data:d,error:c}=await i.from("campos_customizados").update({label:r.label,descricao:r.descricao,tipo_campo:r.tipo_campo,opcoes:r.opcoes,obrigatorio:r.obrigatorio,valor_padrao:r.valor_padrao,mascara:r.mascara,ordem:r.ordem,grupo:r.grupo,visivel:r.visivel,editavel:r.editavel,ativo:r.ativo}).eq("id",e).select().single();if(c)throw c;return{success:!0,data:d}}catch(o){throw console.error("Erro ao atualizar campo customizado:",o),a({statusCode:o.statusCode||500,message:o.message||"Erro ao atualizar campo customizado"})}});export{i as default};
