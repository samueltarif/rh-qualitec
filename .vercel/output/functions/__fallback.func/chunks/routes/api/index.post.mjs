import{d as e,r as t,c as a}from"../../_/nitro.mjs";import{s as o}from"../../_/serverSupabaseClient.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"@supabase/ssr";import"../../_/fetch-retry.mjs";const r=e(async e=>{const r=await o(e),i=await t(e);if(!i.titulo||!i.mensagem)throw a({statusCode:400,message:"Título e mensagem são obrigatórios"});let s=i.empresa_id;if(!s){const{data:e}=await r.from("empresas").select("id").limit(1).single();s=null==e?void 0:e.id}const d={empresa_id:s,tipo_alerta_id:i.tipo_alerta_id||null,colaborador_id:i.colaborador_id||null,documento_id:i.documento_id||null,referencia_tipo:i.referencia_tipo||"manual",referencia_id:i.referencia_id||null,titulo:i.titulo,mensagem:i.mensagem,dados_extras:i.dados_extras||{},status:"pendente",prioridade:i.prioridade||"media",data_vencimento:i.data_vencimento||null},{data:n,error:m}=await r.from("alertas").insert(d).select().single();if(m)throw a({statusCode:500,message:m.message});return n});export{r as default};
