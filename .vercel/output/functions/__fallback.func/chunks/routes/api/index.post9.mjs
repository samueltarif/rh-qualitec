import{d as a,r as o,c as r}from"../../_/nitro.mjs";import{s as t}from"../../_/serverSupabaseClient.mjs";import{s}from"../../_/serverSupabaseUser.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"@supabase/ssr";import"../../_/fetch-retry.mjs";const e=a(async a=>{const e=await t(a),i=await s(a),d=await o(a);if(!i)throw r({statusCode:401,message:"Não autenticado"});try{if(!d.colaborador_id)throw r({statusCode:400,message:"Colaborador é obrigatório"});if(!d.data)throw r({statusCode:400,message:"Data é obrigatória"});const{data:a}=await e.from("registros_ponto").select("id").eq("colaborador_id",d.colaborador_id).eq("data",d.data).maybeSingle();if(a)throw r({statusCode:400,message:"Já existe um registro de ponto para este colaborador nesta data"});const{data:o,error:t}=await e.from("registros_ponto").insert({colaborador_id:d.colaborador_id,data:d.data,entrada_1:d.entrada_1||null,saida_1:d.saida_1||null,entrada_2:d.entrada_2||null,saida_2:d.saida_2||null,status:d.status||"Normal",justificativa:d.justificativa||null,observacoes:d.observacoes||null}).select("\n        *,\n        colaborador:colaboradores(id, nome, matricula)\n      ").single();if(t)throw console.error("Erro ao criar registro:",t),r({statusCode:500,message:t.message});return o}catch(a){throw console.error("Erro ao criar registro de ponto:",a),r({statusCode:a.statusCode||500,message:a.message||"Erro ao criar registro"})}});export{e as default};
