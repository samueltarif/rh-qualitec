import{d as o,a as e,c as r}from"../../../_/nitro.mjs";import{s as a}from"../../../_/serverSupabaseClient.mjs";import{s as t}from"../../../_/serverSupabaseUser.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"@supabase/ssr";import"../../../_/fetch-retry.mjs";const s=o(async o=>{const s=await a(o),i=await t(o),n=e(o);if(!i)throw r({statusCode:401,message:"NÃ£o autenticado"});try{const{data:o}=await s.from("app_users").select("colaborador_id").eq("auth_uid",i.id).single(),e=o;if(!(null==e?void 0:e.colaborador_id))return[];let a=s.from("documentos_funcionario").select("*").eq("colaborador_id",e.colaborador_id).eq("disponivel_para_funcionario",!0).order("created_at",{ascending:!1});n.tipo&&(a=a.eq("tipo",n.tipo)),n.ano&&(a=a.like("competencia",`${n.ano}%`));const{data:t,error:d}=await a;if(d)throw r({statusCode:500,message:d.message});return t||[]}catch(o){throw console.error("Erro ao buscar documentos:",o),r({statusCode:500,message:o.message||"Erro ao buscar documentos"})}});export{s as default};
