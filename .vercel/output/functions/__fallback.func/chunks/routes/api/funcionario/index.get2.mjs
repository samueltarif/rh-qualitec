import{d as o,a as s,c as t}from"../../../_/nitro.mjs";import{s as a}from"../../../_/serverSupabaseClient.mjs";import{s as r}from"../../../_/serverSupabaseUser.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"@supabase/ssr";import"../../../_/fetch-retry.mjs";const e=o(async o=>{const e=await a(o),i=await r(o),d=s(o);if(!i)throw t({statusCode:401,message:"Não autenticado"});try{const{data:o}=await e.from("app_users").select("colaborador_id").eq("auth_uid",i.id).single(),s=o;if(!(null==s?void 0:s.colaborador_id))return[];let a=e.from("solicitacoes_funcionario").select("\n        *,\n        respondido:app_users!solicitacoes_funcionario_respondido_por_fkey(nome)\n      ").eq("colaborador_id",s.colaborador_id).order("created_at",{ascending:!1});d.status&&"todos"!==d.status&&(a=a.eq("status",d.status)),d.tipo&&(a=a.eq("tipo",d.tipo));const{data:r,error:n}=await a;if(n)throw t({statusCode:500,message:n.message});return r||[]}catch(o){throw console.error("Erro ao buscar solicitações:",o),t({statusCode:500,message:o.message||"Erro ao buscar solicitações"})}});export{e as default};
