import{d as o,r as a,c as r}from"../../../_/nitro.mjs";import{s as e}from"../../../_/serverSupabaseClient.mjs";import{s}from"../../../_/serverSupabaseUser.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"@supabase/ssr";import"../../../_/fetch-retry.mjs";const t=o(async o=>{const t=await e(o),i=await s(o),d=await a(o);if(!i)throw r({statusCode:401,message:"Não autenticado"});try{const{data:o}=await t.from("app_users").select("colaborador_id").eq("auth_uid",i.id).single(),a=o;if(!(null==a?void 0:a.colaborador_id))throw r({statusCode:400,message:"Usuário não vinculado a um colaborador"});const{data:e}=await t.from("colaboradores").select("empresa_id").eq("id",a.colaborador_id).single(),s=e;if(!(null==s?void 0:s.empresa_id))throw r({statusCode:400,message:"Colaborador não vinculado a uma empresa"});const{data:m,error:c}=await t.from("solicitacoes_funcionario").insert({empresa_id:s.empresa_id,colaborador_id:a.colaborador_id,tipo:d.tipo,titulo:d.titulo,descricao:d.descricao,prioridade:d.prioridade||"Normal",anexos:d.anexos||[],metadata:d.metadata||{}}).select().single();if(c)throw r({statusCode:500,message:c.message});return m}catch(o){throw console.error("Erro ao criar solicitação:",o),r({statusCode:500,message:o.message||"Erro ao criar solicitação"})}});export{t as default};
