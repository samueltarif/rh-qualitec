import{d as s,a as o,c as a}from"../../../../_/nitro.mjs";import{s as r}from"../../../../_/serverSupabaseClient.mjs";import{s as t}from"../../../../_/serverSupabaseUser.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"@supabase/ssr";import"../../../../_/fetch-retry.mjs";const e=s(async s=>{try{const e=await r(s),n=await t(s),i=o(s),{mes:u,ano:d}=i;if(!u||!d)throw a({statusCode:400,statusMessage:"MÃªs e ano sÃ£o obrigatÃ³rios"});const c=(null==n?void 0:n.id)||(null==n?void 0:n.sub);if(!n||!c)throw a({statusCode:401,statusMessage:"UsuÃ¡rio nÃ£o autenticado"});console.log("ğŸ” [ASSINATURA PONTO] User ID:",c),console.log("ğŸ” [ASSINATURA PONTO] Query:",i);const{data:l,error:m}=await e.from("app_users").select("colaborador_id").eq("auth_uid",c).single();console.log("ğŸ” [ASSINATURA PONTO] App User:",l),console.log("ğŸ” [ASSINATURA PONTO] Error:",m);const p=l;if(!(null==p?void 0:p.colaborador_id))throw a({statusCode:404,statusMessage:"UsuÃ¡rio nÃ£o encontrado no sistema"});const{data:A,error:g}=await e.from("assinaturas_ponto").select("*").eq("colaborador_id",p.colaborador_id).eq("mes",u).eq("ano",d).maybeSingle();if(console.log("ğŸ” [ASSINATURA PONTO] Assinatura encontrada:",A),console.log("ğŸ” [ASSINATURA PONTO] Erro:",g),g)return console.warn("Erro ao buscar assinatura:",g.message),{success:!0,data:null};return{success:!0,data:A&&A.hash_assinatura&&""!==A.hash_assinatura.trim()?A:null}}catch(s){throw console.error("Erro ao buscar assinatura:",s),a({statusCode:s.statusCode||500,statusMessage:s.statusMessage||"Erro interno do servidor"})}});export{e as default};
