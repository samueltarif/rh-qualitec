import{d as o,g as a,c as r}from"../../../../../_/nitro.mjs";import{s}from"../../../../../_/serverSupabaseClient.mjs";import{s as t}from"../../../../../_/serverSupabaseUser.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"@supabase/ssr";import"../../../../../_/fetch-retry.mjs";const e=o(async o=>{const e=await s(o),i=await t(o),d=a(o,"id");if(!i)throw r({statusCode:401,message:"Não autenticado"});if(!d)throw r({statusCode:400,message:"ID do comunicado é obrigatório"});try{const{data:o}=await e.from("app_users").select("colaborador_id").eq("auth_uid",i.id).single();if(!(null==o?void 0:o.colaborador_id))throw r({statusCode:400,message:"Usuário não vinculado a um colaborador"});const{error:a}=await e.from("comunicados_lidos").upsert({comunicado_id:d,colaborador_id:o.colaborador_id},{onConflict:"comunicado_id,colaborador_id"});if(a)throw r({statusCode:500,message:a.message});return{success:!0}}catch(o){throw console.error("Erro ao marcar comunicado como lido:",o),r({statusCode:500,message:o.message||"Erro ao marcar como lido"})}});export{e as default};
