import{d as o,c as r}from"../../../_/nitro.mjs";import{s}from"../../../_/serverSupabaseClient.mjs";import{s as e}from"../../../_/serverSupabaseUser.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"@supabase/ssr";import"../../../_/fetch-retry.mjs";const a=o(async o=>{const a=await s(o),t=await e(o),n=(null==t?void 0:t.sub)||(null==t?void 0:t.id);if(!t||!n)throw r({statusCode:401,message:"NÃ£o autenticado"});try{console.log("ğŸ” [HOLERITES] Buscando para userId:",n);const{data:o,error:s}=await a.from("app_users").select("id, colaborador_id").eq("auth_uid",n).single();if(console.log("ğŸ” [HOLERITES] App User:",o),console.log("ğŸ” [HOLERITES] Error:",s),!o)throw r({statusCode:404,message:"UsuÃ¡rio nÃ£o encontrado"});const e=o.colaborador_id;if(console.log("ğŸ” [HOLERITES] Colaborador ID:",e),!e)throw r({statusCode:404,message:"Colaborador nÃ£o vinculado ao usuÃ¡rio"});const{data:t,error:i}=await a.from("holerites").select("*").eq("colaborador_id",e).order("ano",{ascending:!1}).order("mes",{ascending:!1});if(console.log("ğŸ” [HOLERITES] Holerites encontrados:",(null==t?void 0:t.length)||0),console.log("ğŸ” [HOLERITES] Erro ao buscar:",i),i)throw i;return{success:!0,data:t||[]}}catch(o){throw console.error("âŒ [HOLERITES] Erro:",o.message),r({statusCode:500,message:o.message||"Erro ao buscar holerites"})}});export{a as default};
