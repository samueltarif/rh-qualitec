import{d as o,a as r}from"../../../_/nitro.mjs";import{s as a}from"../../../_/serverSupabaseServiceRole.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"@supabase/functions-js";import"../../../virtual/_commonjsHelpers.mjs";import"@supabase/postgrest-js";import"@supabase/realtime-js";import"@supabase/storage-js";import"@supabase/auth-js";import"../../../_/fetch-retry.mjs";const s=o(async o=>{try{const s=a(o);console.log("üîç [ADMIN ASSINATURAS] Iniciando busca...");const e=r(o),t=e.mes?parseInt(e.mes):null,n=e.ano?parseInt(e.ano):null,i=e.colaborador_id;console.log("üìã [ADMIN ASSINATURAS] Filtros:",{mes:t,ano:n,colaboradorId:i});const{data:l,error:d}=await s.from("assinaturas_ponto").select("\n        id,\n        colaborador_id,\n        mes,\n        ano,\n        data_assinatura,\n        ip_assinatura,\n        user_agent,\n        hash_assinatura,\n        total_dias,\n        total_horas,\n        observacoes,\n        created_at,\n        colaborador:colaboradores(\n          id,\n          nome,\n          cpf\n        )\n      ").order("data_assinatura",{ascending:!1});if(console.log("üìä [ADMIN ASSINATURAS] Resultado bruto:",{total:(null==l?void 0:l.length)||0,error:(null==d?void 0:d.message)||null,primeiraAssinatura:(null==l?void 0:l[0])||null}),d)return console.error("‚ùå [ADMIN ASSINATURAS] Erro SQL:",d),{success:!1,error:d.message,data:[]};let m=l||[];return t&&(m=m.filter(o=>o.mes===t)),n&&(m=m.filter(o=>o.ano===n)),i&&(m=m.filter(o=>o.colaborador_id===i)),console.log("‚úÖ [ADMIN ASSINATURAS] Retornando:",m.length,"assinaturas"),m}catch(o){return console.error("‚ùå [ADMIN ASSINATURAS] Erro geral:",o),{success:!1,error:o.message,data:[]}}});export{s as default};
