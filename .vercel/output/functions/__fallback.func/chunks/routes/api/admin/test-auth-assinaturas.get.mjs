import{d as e}from"../../../_/nitro.mjs";import{s}from"../../../_/serverSupabaseServiceRole.mjs";import{s as r}from"../../../_/serverSupabaseUser.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"@supabase/functions-js";import"../../../virtual/_commonjsHelpers.mjs";import"@supabase/postgrest-js";import"@supabase/realtime-js";import"@supabase/storage-js";import"@supabase/auth-js";import"../../../_/fetch-retry.mjs";import"../../../_/serverSupabaseClient.mjs";import"@supabase/ssr";const o=e(async e=>{try{const o=await s(e),a=await r(e);if(console.log("=== DEBUG AUTH ASSINATURAS ==="),console.log("User from serverSupabaseUser:",a),!a)return{error:"Usuário não autenticado",user:null,appUser:null,canAccess:!1};const{data:t,error:p}=await o.from("app_users").select("*").eq("auth_uid",a.id).single();console.log("App user:",t),console.log("App user error:",p);const{data:i}=await o.from("app_users").select("email, role").in("role",["admin","super_admin"]);console.log("All admins:",i);const n=t&&["admin","super_admin"].includes(t.role);return{user:{id:a.id,email:a.email},appUser:t,allAdmins:i,canAccess:n,error:(null==p?void 0:p.message)||null}}catch(e){return console.error("Erro no teste de auth:",e),{error:e.message,user:null,appUser:null,canAccess:!1}}});export{o as default};
