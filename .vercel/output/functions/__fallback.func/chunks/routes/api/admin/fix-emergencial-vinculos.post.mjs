import{d as o}from"../../../_/nitro.mjs";import{s as a}from"../../../_/serverSupabaseClient.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"@supabase/ssr";import"../../../_/fetch-retry.mjs";const r=o(async o=>{const r=await a(o);try{console.log("üö® FIX EMERGENCIAL: Corrigindo v√≠nculos trocados");const{data:o}=await r.from("app_users").select("\n        id,\n        email,\n        nome,\n        auth_uid,\n        colaborador_id,\n        colaborador:colaboradores(nome, email_corporativo, matricula)\n      ");console.log("üìä Situa√ß√£o atual dos app_users:"),null==o||o.forEach(o=>{var a;console.log(`- Email: ${o.email} ‚Üí Nome: ${o.nome} ‚Üí Colaborador: ${null==(a=o.colaborador)?void 0:a.nome}`)});const a="quotextarif@gmail.com",e="conta3secunndaria@gmail.com",{data:i}=await r.from("colaboradores").select("id, nome, email_corporativo, matricula").ilike("nome","%CLAUDIA%").single(),{data:l}=await r.from("colaboradores").select("id, nome, email_corporativo, matricula").ilike("nome","%ENOA%").single();if(console.log("üë§ Colaboradores encontrados:"),console.log("Claudia:",i),console.log("Enoa:",l),!i||!l)throw new Error("Colaboradores n√£o encontrados");const{error:n}=await r.from("app_users").update({colaborador_id:i.id,nome:i.nome,email:a}).eq("email",a);n?console.error("‚ùå Erro ao corrigir Claudia:",n):console.log("‚úÖ Claudia corrigida: quotextarif@gmail.com ‚Üí CLAUDIA SILVA SANTOS");const{error:s}=await r.from("app_users").update({colaborador_id:l.id,nome:l.nome,email:e}).eq("email",e);s?console.error("‚ùå Erro ao corrigir Enoa:",s):console.log("‚úÖ Enoa corrigida: conta3secunndaria@gmail.com ‚Üí ENOA SILVA COSTA");const{data:c}=await r.from("app_users").select("\n        email,\n        nome,\n        colaborador:colaboradores(nome, matricula)\n      ").in("email",[a,e]);return console.log("=== VERIFICA√á√ÉO FINAL ==="),null==c||c.forEach(o=>{var r,i,l,n,s;const c=o.email===a&&(null==(i=null==(r=o.colaborador)?void 0:r.nome)?void 0:i.includes("CLAUDIA"))||o.email===e&&(null==(n=null==(l=o.colaborador)?void 0:l.nome)?void 0:n.includes("ENOA"))?"‚úÖ CORRETO":"‚ùå AINDA INCORRETO";console.log(`${o.email} ‚Üí ${null==(s=o.colaborador)?void 0:s.nome} ${c}`)}),console.log("üîÑ Limpando cache de sess√£o..."),{success:!0,message:"V√≠nculos corrigidos emergencialmente!",dados:{claudia_corrigida:!n,enoa_corrigida:!s,verificacao:c,acao_necessaria:"Usu√°rios devem fazer logout e login novamente"}}}catch(o){return console.error("‚ùå Erro no fix emergencial:",o),{success:!1,error:o.message,details:o}}});export{r as default};
