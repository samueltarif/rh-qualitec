import{d as o}from"../../../_/nitro.mjs";import{s as e}from"../../../_/serverSupabaseClient.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"@supabase/ssr";import"../../../_/fetch-retry.mjs";const t=o(async o=>{try{const t=await e(o),{data:a}=await t.from("colaboradores").select("id, nome, email_corporativo, auth_uid, status").is("auth_uid",null).eq("status","Ativo"),{data:r}=await t.from("colaboradores").select("\n        id, \n        nome, \n        email_corporativo, \n        auth_uid,\n        app_users!inner(nome, email)\n      ").not("auth_uid","is",null).eq("status","Ativo"),{data:s}=await t.from("app_users").select("id, nome, email, auth_uid, role").eq("role","funcionario"),i=(null==r?void 0:r.map(o=>o.auth_uid))||[],n=(null==s?void 0:s.filter(o=>!i.includes(o.auth_uid)))||[];return{success:!0,diagnostico:{colaboradores_sem_vinculo:(null==a?void 0:a.length)||0,colaboradores_com_vinculo:(null==r?void 0:r.length)||0,usuarios_sem_colaborador:n.length,detalhes:{sem_vinculo:a||[],com_vinculo:r||[],usuarios_sem_colaborador:n}}}}catch(o){return console.error("Erro no diagn√≥stico:",o),{success:!1,error:o.message}}});export{t as default};
