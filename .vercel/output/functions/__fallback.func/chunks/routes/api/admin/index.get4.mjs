import{d as o,a as r,c as a}from"../../../_/nitro.mjs";import{s as e}from"../../../_/serverSupabaseClient.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"@supabase/ssr";import"../../../_/fetch-retry.mjs";const t=o(async o=>{const t=await e(o),s=r(o);try{let o=t.from("solicitacoes_funcionario").select("\n        *,\n        colaborador:colaboradores(id, nome, matricula, cargo:cargos(nome), departamento:departamentos(nome)),\n        respondido:app_users!solicitacoes_funcionario_respondido_por_fkey(nome)\n      ").order("created_at",{ascending:!1});s.status&&"todos"!==s.status&&(o=o.eq("status",s.status)),s.tipo&&(o=o.eq("tipo",s.tipo));const{data:r,error:e}=await o;if(e)throw a({statusCode:500,message:e.message});return(r||[]).map(o=>{var r,a,e,t,s,n,i;return{...o,colaborador_nome:(null==(r=o.colaborador)?void 0:r.nome)||"",colaborador_matricula:(null==(a=o.colaborador)?void 0:a.matricula)||"",cargo:(null==(t=null==(e=o.colaborador)?void 0:e.cargo)?void 0:t.nome)||"",departamento:(null==(n=null==(s=o.colaborador)?void 0:s.departamento)?void 0:n.nome)||"",respondido_nome:(null==(i=o.respondido)?void 0:i.nome)||""}})}catch(o){throw console.error("Erro ao buscar solicitações:",o),a({statusCode:500,message:o.message||"Erro ao buscar solicitações"})}});export{t as default};
