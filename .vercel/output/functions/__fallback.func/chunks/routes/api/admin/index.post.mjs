import{d as t,r as o,c as a}from"../../../_/nitro.mjs";import{s}from"../../../_/serverSupabaseClient.mjs";import{s as e}from"../../../_/serverSupabaseUser.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"@supabase/ssr";import"../../../_/fetch-retry.mjs";const r=t(async t=>{const r=await s(t),i=await e(t),d=await o(t);if(!i)throw a({statusCode:401,message:"NÃ£o autenticado"});try{const{data:t}=await r.from("app_users").select("id").eq("auth_uid",i.id).single(),{data:o}=await r.from("empresas").select("id").limit(1).single();if(!o)throw a({statusCode:400,message:"Nenhuma empresa cadastrada"});const{data:s,error:e}=await r.from("comunicados").insert({empresa_id:o.id,titulo:d.titulo,conteudo:d.conteudo,tipo:d.tipo||"Informativo",destino:d.destino||"todos",destino_ids:d.destino_ids||[],data_expiracao:d.data_expiracao||null,publicado_por:null==t?void 0:t.id,ativo:!0}).select().single();if(e)throw a({statusCode:500,message:e.message});return s}catch(t){throw console.error("Erro ao criar comunicado:",t),a({statusCode:500,message:t.message||"Erro ao criar comunicado"})}});export{r as default};
