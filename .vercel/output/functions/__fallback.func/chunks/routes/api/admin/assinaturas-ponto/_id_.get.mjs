import{d as s,c as a,g as o}from"../../../../_/nitro.mjs";import{s as t}from"../../../../_/serverSupabaseClient.mjs";import{s as e}from"../../../../_/serverSupabaseUser.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"@supabase/ssr";import"../../../../_/fetch-retry.mjs";const r=s(async s=>{const r=await t(s),n=await e(s);if(!n)throw a({statusCode:401,message:"Não autenticado"});const{data:i}=await r.from("app_users").select("role").eq("auth_uid",n.id).single();if(!i||!["admin","super_admin"].includes(i.role))throw a({statusCode:403,message:"Acesso negado"});const d=o(s,"id");if(!d)throw a({statusCode:400,message:"ID da assinatura é obrigatório"});const{data:m,error:p}=await r.from("assinaturas_ponto").select("\n      *,\n      colaborador:colaboradores(\n        id,\n        nome,\n        email,\n        cargo,\n        departamento\n      )\n    ").eq("id",d).single();if(p){if("PGRST116"===p.code)throw a({statusCode:404,message:"Assinatura não encontrada"});throw a({statusCode:500,message:"Erro ao buscar assinatura"})}return m});export{r as default};
