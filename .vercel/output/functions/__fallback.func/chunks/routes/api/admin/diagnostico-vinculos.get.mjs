import{d as o}from"../../../_/nitro.mjs";import{s as a}from"../../../_/serverSupabaseClient.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"@supabase/ssr";import"../../../_/fetch-retry.mjs";const e=o(async o=>{var e;const l=await a(o);try{console.log("ğŸ” DiagnÃ³stico completo de vÃ­nculos...");const{data:o,error:a}=await l.rpc("get_auth_users");a&&(console.log("âŒ NÃ£o foi possÃ­vel acessar auth.users via RPC"),console.log("Tentando mÃ©todo alternativo..."));const{data:s}=await l.from("app_users").select("\n        id,\n        email,\n        nome,\n        auth_uid,\n        colaborador_id,\n        role,\n        colaborador:colaboradores(nome, email_corporativo, email_pessoal, status)\n      ");console.log("ğŸ“Š App Users encontrados:",null==s?void 0:s.length),null==s||s.forEach(o=>{var a;console.log(`- ${o.email} -> ${null==(a=o.colaborador)?void 0:a.nome} (auth_uid: ${o.auth_uid})`)});const{data:n}=await l.from("colaboradores").select("id, nome, email_corporativo, email_pessoal, status").eq("status","Ativo");console.log("ğŸ‘¥ Colaboradores ativos:",null==n?void 0:n.length),null==n||n.forEach(o=>{console.log(`- ${o.nome} (${o.email_corporativo||o.email_pessoal})`)});const t=["conta3secunndaria@gmail.com","quotextarif@gmail.com"];for(const o of t){const a=null==s?void 0:s.find(a=>a.email===o);console.log(`ğŸ” Email ${o}:`,a?"Encontrado":"NÃ£o encontrado"),a&&(console.log(`  - Nome: ${a.nome}`),console.log(`  - Colaborador: ${null==(e=a.colaborador)?void 0:e.nome}`),console.log(`  - Auth UID: ${a.auth_uid}`))}const r=null==s?void 0:s.filter(o=>!o.auth_uid||"undefined"===o.auth_uid);return console.log(`âš ï¸ UsuÃ¡rios sem auth_uid vÃ¡lido: ${(null==r?void 0:r.length)||0}`),null==r||r.forEach(o=>{console.log(`  - ${o.email} (${o.nome})`)}),{success:!0,dados:{total_app_users:(null==s?void 0:s.length)||0,total_colaboradores:(null==n?void 0:n.length)||0,usuarios_sem_auth_uid:(null==r?void 0:r.length)||0,app_users:s,colaboradores:n,usuarios_problematicos:t.map(o=>({email:o,encontrado:!!(null==s?void 0:s.find(a=>a.email===o)),dados:null==s?void 0:s.find(a=>a.email===o)}))}}}catch(o){return console.error("âŒ Erro no diagnÃ³stico:",o),{success:!1,error:o.message,details:o}}});export{e as default};
