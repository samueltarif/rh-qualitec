import{d as t,g as a,r as o,c as s}from"../../../../_/nitro.mjs";import{s as e}from"../../../../_/serverSupabaseClient.mjs";import{s as r}from"../../../../_/serverSupabaseUser.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"@supabase/ssr";import"../../../../_/fetch-retry.mjs";const i=t(async t=>{const i=await e(t),d=await r(t),p=a(t,"id"),m=await o(t);if(!d)throw s({statusCode:401,message:"Não autenticado"});if(!p)throw s({statusCode:400,message:"ID é obrigatório"});try{const{data:t}=await i.from("app_users").select("id").eq("auth_uid",d.id).single(),a={status:m.status,updated_at:(new Date).toISOString()};m.resposta&&(a.resposta=m.resposta),m.motivo_rejeicao&&(a.motivo_rejeicao=m.motivo_rejeicao),["Aprovada","Rejeitada","Concluida"].includes(m.status)&&(a.data_resposta=(new Date).toISOString(),a.respondido_por=null==t?void 0:t.id);const{data:o,error:e}=await i.from("solicitacoes_funcionario").update(a).eq("id",p).select().single();if(e)throw s({statusCode:500,message:e.message});return o}catch(t){throw console.error("Erro ao atualizar solicitação:",t),s({statusCode:500,message:t.message||"Erro ao atualizar solicitação"})}});export{i as default};
