import{d as s,g as r,c as a}from"../../../../../_/nitro.mjs";import{s as o}from"../../../../../_/serverSupabaseServiceRole.mjs";import{s as t}from"../../../../../_/serverSupabaseUser.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"@supabase/functions-js";import"../../../../../virtual/_commonjsHelpers.mjs";import"@supabase/postgrest-js";import"@supabase/realtime-js";import"@supabase/storage-js";import"@supabase/auth-js";import"../../../../../_/fetch-retry.mjs";import"../../../../../_/serverSupabaseClient.mjs";import"@supabase/ssr";const e=s(async s=>{var e;try{const i=r(s,"id");if(!i)throw a({statusCode:400,statusMessage:"ID da assinatura é obrigatório"});const n=await o(s),{data:m,error:u}=await n.from("assinaturas_ponto").select("*, colaborador:colaboradores(nome)").eq("id",i).single();if(u||!m)throw a({statusCode:404,statusMessage:"Assinatura não encontrada"});const{error:p}=await n.from("assinaturas_ponto").delete().eq("id",i);if(p)throw console.error("Erro ao zerar assinatura:",p),a({statusCode:500,statusMessage:"Erro ao zerar assinatura"});try{const r=await t(s);console.log(`Assinatura zerada: ${null==(e=m.colaborador)?void 0:e.nome} - ${null==r?void 0:r.email}`)}catch(s){console.error("Erro ao registrar log:",s)}return{success:!0,message:"Assinatura zerada com sucesso"}}catch(s){throw console.error("Erro ao zerar assinatura:",s),a({statusCode:s.statusCode||500,statusMessage:s.statusMessage||"Erro interno do servidor"})}});export{e as default};
