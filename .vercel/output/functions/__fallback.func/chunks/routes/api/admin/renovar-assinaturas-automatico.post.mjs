import{d as o,c as e}from"../../../_/nitro.mjs";import{s as a}from"../../../_/serverSupabaseServiceRole.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"@supabase/functions-js";import"../../../virtual/_commonjsHelpers.mjs";import"@supabase/postgrest-js";import"@supabase/realtime-js";import"@supabase/storage-js";import"@supabase/auth-js";import"../../../_/fetch-retry.mjs";const r=o(async o=>{try{const e=a(o),r=new Date,s=r.getDate();if(s<5)return{success:!1,message:`Renovação automática só ocorre a partir do dia 5. Hoje é dia ${s}.`};const t=r.getMonth()+1,i=r.getFullYear(),{data:n}=await e.from("colaboradores").select("id, nome, email_corporativo").eq("status","Ativo");if(!n)return{success:!1,message:"Nenhum colaborador encontrado"};let c=0;for(const o of n){const{data:a}=await e.from("assinaturas_ponto").select("id").eq("colaborador_id",o.id).eq("mes",t).eq("ano",i).single();a||(c++,console.log(`Colaborador ${o.nome} precisa renovar assinatura para ${t}/${i}`))}return{success:!0,message:`Verificação concluída. ${c} colaboradores precisam renovar assinatura.`,renovacoesNecessarias:c,totalColaboradores:n.length}}catch(o){throw console.error("Erro na renovação automática:",o),e({statusCode:500,message:"Erro interno do servidor"})}});export{r as default};
