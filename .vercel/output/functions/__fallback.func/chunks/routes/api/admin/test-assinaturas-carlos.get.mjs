import{d as o}from"../../../_/nitro.mjs";import{s as a}from"../../../_/serverSupabaseServiceRole.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"@supabase/functions-js";import"../../../virtual/_commonjsHelpers.mjs";import"@supabase/postgrest-js";import"@supabase/realtime-js";import"@supabase/storage-js";import"@supabase/auth-js";import"../../../_/fetch-retry.mjs";const r=o(async o=>{try{const r=a(o);console.log("ğŸ” Testando busca de assinaturas para Carlos...");const{data:s,error:t}=await r.from("colaboradores").select("id, nome, matricula").ilike("nome","%CARLOS%").single();if(t)return console.error("âŒ Erro ao buscar colaborador:",t),{error:"Colaborador nÃ£o encontrado",details:t};console.log("ğŸ‘¤ Colaborador encontrado:",s);const{data:e,error:n}=await r.from("assinaturas_ponto").select("*").eq("colaborador_id",s.id).order("created_at",{ascending:!1});console.log("ğŸ“‹ Todas as assinaturas do Carlos:",e);const i=12,c=2025,{data:l,error:d}=await r.from("assinaturas_ponto").select("*").eq("colaborador_id",s.id).eq("mes",i).eq("ano",c).maybeSingle();console.log("ğŸ“ Assinatura dezembro/2025:",l);const{data:m}=await r.rpc("exec_sql",{sql_query:"\n          SELECT column_name, data_type, is_nullable \n          FROM information_schema.columns \n          WHERE table_name = 'assinaturas_ponto' \n          ORDER BY ordinal_position\n        "}),{count:u}=await r.from("assinaturas_ponto").select("*",{count:"exact",head:!0});return{success:!0,colaborador:s,totalAssinaturas:u,todasAssinaturas:e,assinaturaAtual:l,estruturaTabela:m,busca:{colaborador_id:s.id,mes:i,ano:c},errors:{colaboradorError:t,todasError:n,assinaturaError:d}}}catch(o){return console.error("âŒ Erro no teste:",o),{success:!1,error:o.message,stack:o.stack}}});export{r as default};
