import{d as o}from"../../../_/nitro.mjs";import{s as e}from"../../../_/serverSupabaseClient.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"@supabase/ssr";import"../../../_/fetch-retry.mjs";const a=o(async o=>{const a=await e(o);try{console.log("üîß Corrigindo v√≠nculo espec√≠fico: Claudia");const{data:o,error:e}=await a.from("colaboradores").select("id, nome, email_corporativo, email_pessoal, matricula").or("nome.ilike.%CLAUDIA%,matricula.eq.2").single();if(e||!o)return console.error("‚ùå Claudia n√£o encontrada:",e),{success:!1,error:"Claudia n√£o encontrada"};console.log("üë§ Claudia encontrada:",o);const{data:r,error:s}=await a.from("app_users").select("id, email, nome, auth_uid, colaborador_id").eq("email","conta3secunndaria@gmail.com").single();if(s||!r)return console.error("‚ùå Usu√°rio com email conta3secunndaria@gmail.com n√£o encontrado:",s),{success:!1,error:"Usu√°rio n√£o encontrado"};if(console.log("üë§ Usu√°rio encontrado:",r),r.colaborador_id===o.id)return console.log("‚úÖ V√≠nculo j√° est√° correto!"),{success:!0,message:"V√≠nculo j√° estava correto",dados:{claudia:o,appUser:r}};const{data:i,error:n}=await a.from("app_users").update({colaborador_id:o.id,nome:o.nome}).eq("id",r.id).select().single();if(n)return console.error("‚ùå Erro ao atualizar v√≠nculo:",n),{success:!1,error:n.message};console.log("‚úÖ V√≠nculo corrigido com sucesso!"),console.log("Antes:",`${r.email} -> ${r.nome}`),console.log("Depois:",`${i.email} -> ${i.nome}`);const{data:c}=await a.from("app_users").select("id, email, nome, auth_uid").eq("colaborador_id",o.id).neq("id",r.id);if(c&&c.length>0){console.log("‚ö†Ô∏è Outros v√≠nculos encontrados para Claudia:",c);for(const o of c)o.auth_uid&&"undefined"!==o.auth_uid||(await a.from("app_users").delete().eq("id",o.id),console.log(`üßπ Removido v√≠nculo duplicado: ${o.email}`))}const{data:t}=await a.from("app_users").select("\n        email,\n        nome,\n        auth_uid,\n        colaborador:colaboradores(nome, matricula)\n      ").eq("email","conta3secunndaria@gmail.com").single();return console.log("üîç Verifica√ß√£o final:",t),{success:!0,message:"V√≠nculo da Claudia corrigido com sucesso!",dados:{antes:r,depois:i,verificacao:t}}}catch(o){return console.error("‚ùå Erro na corre√ß√£o:",o),{success:!1,error:o.message,details:o}}});export{a as default};
