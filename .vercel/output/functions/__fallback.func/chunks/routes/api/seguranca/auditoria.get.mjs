import{d as t,a,c as e}from"../../../_/nitro.mjs";import{s as i}from"../../../_/serverSupabaseClient.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"@supabase/ssr";import"../../../_/fetch-retry.mjs";const r=t(async t=>{const r=await i(t),o=a(t);let s=r.from("auditoria").select("*").order("created_at",{ascending:!1});o.usuario_id&&(s=s.eq("usuario_id",o.usuario_id)),o.tabela&&(s=s.eq("tabela",o.tabela)),o.acao&&(s=s.eq("acao",o.acao)),o.registro_id&&(s=s.eq("registro_id",o.registro_id)),o.data_inicio&&(s=s.gte("created_at",o.data_inicio)),o.data_fim&&(s=s.lte("created_at",o.data_fim));const d=o.limit?Number(o.limit):100;s=s.limit(d);const{data:m,error:n}=await s;if(n)throw e({statusCode:500,message:n.message});return m||[]});export{r as default};
