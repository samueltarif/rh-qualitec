import{d as t}from"../../../_/nitro.mjs";import{s as e}from"../../../_/serverSupabaseClient.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"@supabase/ssr";import"../../../_/fetch-retry.mjs";const o=t(async t=>{const o=await e(t),s=new Date;s.setDate(s.getDate()-30);const{data:a}=await o.from("logs_acesso").select("acao, sucesso, created_at").gte("created_at",s.toISOString()),{data:l}=await o.from("auditoria").select("acao, created_at").gte("created_at",s.toISOString()),{data:i}=await o.from("historico_backups").select("status, sucesso").order("created_at",{ascending:!1}).limit(10),{data:n}=await o.from("sessoes_ativas").select("ativo"),{data:r}=await o.from("tentativas_login").select("sucesso").gte("created_at",s.toISOString());return{logs:{total:(null==a?void 0:a.length)||0,sucessos:(null==a?void 0:a.filter(t=>t.sucesso).length)||0,erros:(null==a?void 0:a.filter(t=>!t.sucesso).length)||0,logins:(null==a?void 0:a.filter(t=>"login"===t.acao).length)||0},auditoria:{total:(null==l?void 0:l.length)||0,creates:(null==l?void 0:l.filter(t=>"create"===t.acao).length)||0,updates:(null==l?void 0:l.filter(t=>"update"===t.acao).length)||0,deletes:(null==l?void 0:l.filter(t=>"delete"===t.acao).length)||0},backups:{total:(null==i?void 0:i.length)||0,sucesso:(null==i?void 0:i.filter(t=>t.sucesso).length)||0,erro:(null==i?void 0:i.filter(t=>!t.sucesso).length)||0,ultimo:(null==i?void 0:i[0])||null},sessoes:{ativas:(null==n?void 0:n.filter(t=>t.ativo).length)||0,total:(null==n?void 0:n.length)||0},tentativas_login:{total:(null==r?void 0:r.length)||0,sucesso:(null==r?void 0:r.filter(t=>t.sucesso).length)||0,falhas:(null==r?void 0:r.filter(t=>!t.sucesso).length)||0}}});export{o as default};
