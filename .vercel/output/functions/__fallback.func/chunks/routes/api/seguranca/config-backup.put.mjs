import{d as e,r as t,c as a}from"../../../_/nitro.mjs";import{s}from"../../../_/serverSupabaseClient.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"@supabase/ssr";import"../../../_/fetch-retry.mjs";const r=e(async e=>{const r=await s(e),o=await t(e),{data:i}=await r.from("configuracoes_backup").select("id, empresa_id").limit(1).single();if(i){const{data:e,error:t}=await r.from("configuracoes_backup").update({...o,updated_at:(new Date).toISOString()}).eq("id",i.id).select().single();if(t)throw a({statusCode:500,message:t.message});return e}{const{data:e}=await r.from("empresas").select("id").limit(1).single(),{data:t,error:s}=await r.from("configuracoes_backup").insert({...o,empresa_id:null==e?void 0:e.id}).select().single();if(s)throw a({statusCode:500,message:s.message});return t}});export{r as default};
