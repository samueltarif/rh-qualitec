import{d as t,c as a}from"../../../_/nitro.mjs";import{s as e}from"../../../_/serverSupabaseClient.mjs";import{s as o}from"../../../_/serverSupabaseUser.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"@supabase/ssr";import"../../../_/fetch-retry.mjs";const s=t(async t=>{const s=await e(t);if(!await o(t))throw a({statusCode:401,message:"NÃ£o autenticado"});try{const t=(new Date).toISOString().split("T")[0],a=(new Date).getMonth()+1,e=`${(new Date).getFullYear()}-${String(a).padStart(2,"0")}-01`,{data:o}=await s.from("registros_ponto").select("id, entrada_1, saida_1, entrada_2, saida_2").eq("data",t),r=(o||[]).filter(t=>t.entrada_1&&!t.saida_2&&!t.saida_1).length,{count:n}=await s.from("registros_ponto").select("*",{count:"exact",head:!0}).gte("data",e),{count:i}=await s.from("registros_ponto").select("*",{count:"exact",head:!0}).eq("status","Falta").gte("data",e);return{pendentes:r||0,totalHoje:(null==o?void 0:o.length)||0,totalMes:n||0,faltas:i||0}}catch(t){return console.error("Erro ao buscar stats do ponto:",t),{pendentes:0,totalHoje:0,totalMes:0,faltas:0}}});export{s as default};
