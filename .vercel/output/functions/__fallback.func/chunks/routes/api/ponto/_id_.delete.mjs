import{d as o,g as s,c as e}from"../../../_/nitro.mjs";import{s as t}from"../../../_/serverSupabaseClient.mjs";import{s as r}from"../../../_/serverSupabaseUser.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"@supabase/ssr";import"../../../_/fetch-retry.mjs";const a=o(async o=>{const a=await t(o),i=await r(o),d=s(o,"id");if(!i)throw e({statusCode:401,message:"Não autenticado"});if(!d)throw e({statusCode:400,message:"ID do registro não informado"});try{const o=(null==i?void 0:i.id)||(null==i?void 0:i.sub);if(!o)throw e({statusCode:401,message:"ID de usuário inválido"});const{data:s}=await a.from("app_users").select("id, role").eq("auth_uid",o).single();if(!s)throw e({statusCode:400,message:"Usuário não encontrado"});const{data:t}=await a.from("registros_ponto").select("id").eq("id",d).single();if(!t)throw e({statusCode:404,message:"Registro não encontrado"});const{error:r}=await a.from("registros_ponto").delete().eq("id",d);if(r)throw console.error("Erro ao excluir registro:",r),e({statusCode:500,message:r.message});return console.log("✅ Registro de ponto excluído com sucesso:",d),{success:!0,message:"Registro excluído com sucesso"}}catch(o){throw console.error("Erro ao excluir registro de ponto:",o),e({statusCode:o.statusCode||500,message:o.message||"Erro ao excluir registro"})}});export{a as default};
