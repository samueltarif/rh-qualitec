import{_ as e,b as a}from"./server.mjs";import{_ as o}from"./UserProfileDropdown-D7V90wtd.mjs";import{defineComponent as t,ref as s,computed as r,resolveComponent as l,mergeProps as i,withCtx as n,createVNode as d,unref as c,createTextVNode as u,isRef as m,createBlock as v,openBlock as p,Fragment as b,renderList as x,toDisplayString as g,useSSRContext as f}from"vue";import{ssrRenderAttrs as y,ssrRenderComponent as h,ssrInterpolate as w,ssrRenderList as _,ssrRenderClass as $,ssrRenderAttr as U,ssrIncludeBooleanAttr as C,ssrLooseContain as A}from"vue/server-renderer";import{_ as S}from"./UIInput-CnioD5-Q.mjs";import{_ as k}from"./UISelect-C9tnEbh5.mjs";import{_ as E}from"./UIButton-BfdUCxqX.mjs";import"../_/nitro.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"../routes/renderer.mjs";import"vue-bundle-renderer/runtime";import"unhead/server";import"devalue";import"pinia";import"vue-router";import"@supabase/ssr";const j=t({__name:"ColaboradoresSemAcessoCard",__ssrInlineRender:!0,props:{colaboradoresSemAcesso:{}},emits:["criar-acesso"],setup(e){const a=s(!0);return(o,t,s,r)=>{const n=l("Icon");t(`<div${y(i({class:"card"},r))}><div class="flex items-center justify-between mb-4"><div class="flex items-center gap-3"><div class="w-10 h-10 bg-amber-100 rounded-lg flex items-center justify-center">`),t(h(n,{name:"heroicons:user-plus",class:"text-amber-600",size:"24"},null,s)),t(`</div><div><h3 class="font-semibold text-gray-800">Colaboradores sem Acesso</h3><p class="text-sm text-gray-600">${w(e.colaboradoresSemAcesso.length)} colaboradores sem usu√°rio</p></div></div><button class="p-2 hover:bg-gray-100 rounded-lg transition-colors">`),t(h(n,{name:c(a)?"heroicons:chevron-up":"heroicons:chevron-down",size:"20",class:"text-gray-600"},null,s)),t("</button></div>"),c(a)&&e.colaboradoresSemAcesso.length>0?(t('<div class="space-y-2">\x3c!--[--\x3e'),_(e.colaboradoresSemAcesso,e=>{t(`<div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors"><div class="flex items-center gap-3"><div class="w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center text-white text-sm font-semibold">${w((e=>{const a=e.split(" ");return 1===a.length?a[0].substring(0,2).toUpperCase():(a[0][0]+a[a.length-1][0]).toUpperCase()})(e.nome))}</div><div><p class="font-medium text-gray-800">${w(e.nome)}</p><p class="text-xs text-gray-600">${w(e.email_corporativo||"Sem email")} `),e.cargo?t(`<span class="ml-2">‚Ä¢ ${w(e.cargo.nome)}</span>`):t("\x3c!----\x3e"),t('</p></div></div><button class="px-3 py-1.5 bg-red-700 text-white text-sm font-medium rounded-lg hover:bg-red-800 transition-colors flex items-center gap-2">'),t(h(n,{name:"heroicons:key",size:"16"},null,s)),t(" Criar Acesso </button></div>")}),t("\x3c!--]--\x3e</div>")):c(a)?(t('<div class="text-center py-6 text-gray-500">'),t(h(n,{name:"heroicons:check-circle",class:"mx-auto mb-2 text-green-500",size:"32"},null,s)),t('<p class="text-sm">Todos os colaboradores ativos t√™m acesso ao sistema</p></div>')):t("\x3c!----\x3e"),t("</div>")}}}),q=j.setup;j.setup=(e,a)=>{const o=f();return(o.modules||(o.modules=new Set)).add("components/ColaboradoresSemAcessoCard.vue"),q?q(e,a):void 0};const z=Object.assign(j,{__name:"ColaboradoresSemAcessoCard"}),V=t({__name:"NewUserButton",__ssrInlineRender:!0,emits:["click"],setup:e=>(e,a,o,t)=>{a(h(E,i({theme:"admin",variant:"primary","icon-left":"heroicons:user-plus",onClick:a=>e.$emit("click")},t),{default:n((e,a,o,t)=>{if(!a)return[u(" Novo Usu√°rio ")];a(" Novo Usu√°rio ")}),_:1},o))}}),I=V.setup;V.setup=(e,a)=>{const o=f();return(o.modules||(o.modules=new Set)).add("components/NewUserButton.vue"),I?I(e,a):void 0};const F=Object.assign(V,{__name:"NewUserButton"}),T=t({__name:"UserTableActions",__ssrInlineRender:!0,props:{isActive:{type:Boolean}},emits:["toggle-status","edit"],setup:e=>(a,o,t,s)=>{const r=l("Icon");o(`<div${y(i({class:"flex items-center justify-end gap-2"},s))}><button class="p-2 hover:bg-gray-100 rounded-lg transition-colors"${U("title",e.isActive?"Desativar":"Ativar")}>`),o(h(r,{name:e.isActive?"heroicons:no-symbol":"heroicons:check-circle",class:e.isActive?"text-red-600":"text-green-600",size:"20"},null,t)),o('</button><button class="p-2 hover:bg-gray-100 rounded-lg transition-colors" title="Editar">'),o(h(r,{name:"heroicons:pencil",class:"text-blue-600",size:"20"},null,t)),o("</button></div>")}}),N=T.setup;T.setup=(e,a)=>{const o=f();return(o.modules||(o.modules=new Set)).add("components/UserTableActions.vue"),N?N(e,a):void 0};const M=Object.assign(T,{__name:"UserTableActions"}),B=t({__name:"UserFormModal",__ssrInlineRender:!0,props:{isEditing:{type:Boolean},form:{},saving:{type:Boolean},colaboradores:{}},emits:["close","submit","update:form"],setup(e,{emit:a}){const o=e,t=a,r=s(""),update=(e,a)=>{t("update:form",{...o.form,[e]:a})};return(a,o,t,s)=>{const f=l("Icon"),$=S,A=k,j=E;o(`<div${y(i({class:"fixed inset-0 z-50 flex items-center justify-center"},s))}><div class="absolute inset-0 bg-black/50"></div><div class="relative bg-white rounded-xl shadow-xl w-full max-w-md mx-4"><div class="sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between rounded-t-xl"><h3 class="text-xl font-bold text-gray-800">${w(e.isEditing?"Editar Usu√°rio":"Novo Usu√°rio")}</h3><button class="p-2 hover:bg-gray-100 rounded-lg">`),o(h(f,{name:"heroicons:x-mark",size:"24"},null,t)),o('</button></div><form class="p-6"><div class="space-y-4"><div><label class="block text-sm font-medium text-gray-700 mb-1">Nome *</label>'),o(h($,{"model-value":e.form.nome,"onUpdate:modelValue":e=>update("nome",e),type:"text",required:""},null,t)),o('</div><div><label class="block text-sm font-medium text-gray-700 mb-1">Email *</label>'),o(h($,{"model-value":e.form.email,"onUpdate:modelValue":e=>update("email",e),type:"email",required:""},null,t)),o("</div>"),e.isEditing?o("\x3c!----\x3e"):(o('<div><label class="block text-sm font-medium text-gray-700 mb-1">Senha *</label>'),o(h($,{"model-value":e.form.password,"onUpdate:modelValue":e=>update("password",e),type:"password",required:""},null,t)),o('<p class="text-xs text-gray-500 mt-1"> M√≠nimo 6 caracteres '),"Qualitec@2025"===e.form.password?o('<span class="text-green-600 font-medium ml-2"> ‚úì Senha padr√£o aplicada </span>'):o("\x3c!----\x3e"),o("</p></div>")),o('<div><label class="block text-sm font-medium text-gray-700 mb-1">Tipo de Acesso *</label>'),o(h(A,{"model-value":e.form.role,"onUpdate:modelValue":e=>update("role",e),required:""},{default:n((e,a,o,t)=>{if(!a)return[d("option",{value:""},"Selecione"),d("option",{value:"admin"},"Administrador"),d("option",{value:"funcionario"},"Funcion√°rio")];a(`<option value=""${t}>Selecione</option><option value="admin"${t}>Administrador</option><option value="funcionario"${t}>Funcion√°rio</option>`)}),_:1},t)),o('</div><div><label class="block text-sm font-medium text-gray-700 mb-1"> Este usu√°rio √â qual colaborador? (opcional) </label><div class="space-y-2">'),o(h(A,{modelValue:c(r),"onUpdate:modelValue":e=>m(r)?r.value=e:null},{default:n((a,o,t,s)=>{if(!o)return[d("option",{value:""},"Nenhum - Criar usu√°rio sem v√≠nculo"),(p(!0),v(b,null,x(e.colaboradores,e=>(p(),v("option",{key:e.id,value:e.id},g(e.nome)+g(e.email_corporativo?` (${e.email_corporativo})`:""),9,["value"]))),128))];o(`<option value=""${s}>Nenhum - Criar usu√°rio sem v√≠nculo</option>\x3c!--[--\x3e`),_(e.colaboradores,e=>{o(`<option${U("value",e.id)}${s}>${w(e.nome)}${w(e.email_corporativo?` (${e.email_corporativo})`:"")}</option>`)}),o("\x3c!--]--\x3e")}),_:1},t)),c(r)?(o('<button type="button" class="w-full px-4 py-2 bg-green-600 hover:bg-green-700 text-white text-sm font-medium rounded-lg transition-colors flex items-center justify-center gap-2">'),o(h(f,{name:"heroicons:sparkles",size:"18"},null,t)),o(" Autopreencher com dados deste colaborador </button>")):o("\x3c!----\x3e"),o('</div><div class="mt-2 p-3 bg-blue-50 border border-blue-200 rounded-lg"><p class="text-xs text-blue-800">'),o(h(f,{name:"heroicons:information-circle",size:"14",class:"inline"},null,t)),o('<strong>O que significa?</strong><br> Vincule se este usu√°rio do sistema √â um colaborador j√° cadastrado no RH.<br> Exemplo: Criar login para &quot;Silvana&quot; ‚Üí Selecione o colaborador &quot;Silvana&quot; </p></div><div class="mt-2 p-3 bg-amber-50 border border-amber-200 rounded-lg"><p class="text-xs text-amber-800">'),o(h(f,{name:"heroicons:light-bulb",size:"14",class:"inline"},null,t)),o(`<strong>Hierarquia (quem responde a quem):</strong><br> Configure no cadastro do Colaborador, no campo &quot;Gestor Direto&quot; </p></div></div><div class="flex items-center gap-2"><input type="checkbox"${C(e.form.ativo)?" checked":""} class="w-4 h-4 text-red-700 border-gray-300 rounded focus:ring-red-500"><label class="text-sm font-medium text-gray-700">Usu√°rio ativo</label></div></div><div class="flex gap-3 mt-6 pt-6 border-t border-gray-200">`),o(h(j,{type:"button",theme:"admin",variant:"secondary","full-width":"",onClick:e=>a.$emit("close")},{default:n((e,a,o,t)=>{if(!a)return[u("Cancelar")];a("Cancelar")}),_:1},t)),o(h(j,{type:"submit",theme:"admin",variant:"primary","full-width":"",disabled:e.saving},{default:n((a,o,t,s)=>{if(!o)return[u(g(e.saving?"Salvando...":e.isEditing?"Salvar":"Criar Usu√°rio"),1)];o(`${w(e.saving?"Salvando...":e.isEditing?"Salvar":"Criar Usu√°rio")}`)}),_:1},t)),o("</div></form></div></div>")}}}),O=B.setup;B.setup=(e,a)=>{const o=f();return(o.modules||(o.modules=new Set)).add("components/UserFormModal.vue"),O?O(e,a):void 0};const R=Object.assign(B,{__name:"UserFormModal"}),D=t({__name:"UserEditModal",__ssrInlineRender:!0,props:{user:{},colaboradores:{}},emits:["close","save"],setup(e,{expose:a,emit:o}){const t=e,r=s(!1),m=s({nome:t.user.nome,email:t.user.email,password:"",role:t.user.role,colaborador_id:t.user.colaborador_id||"",ativo:t.user.ativo});return a({saving:r}),(a,o,t,s)=>{const f=l("Icon"),$=S,j=k,q=E;o(`<div${y(i({class:"fixed inset-0 z-50 flex items-center justify-center"},s))}><div class="absolute inset-0 bg-black/50"></div><div class="relative bg-white rounded-xl shadow-xl w-full max-w-md mx-4"><div class="sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between rounded-t-xl"><h3 class="text-xl font-bold text-gray-800">Editar Usu√°rio</h3><button class="p-2 hover:bg-gray-100 rounded-lg">`),o(h(f,{name:"heroicons:x-mark",size:"24"},null,t)),o('</button></div><form class="p-6"><div class="space-y-4"><div><label class="block text-sm font-medium text-gray-700 mb-1">Nome *</label>'),o(h($,{modelValue:c(m).nome,"onUpdate:modelValue":e=>c(m).nome=e,type:"text",required:""},null,t)),o('</div><div><label class="block text-sm font-medium text-gray-700 mb-1">Email *</label>'),o(h($,{modelValue:c(m).email,"onUpdate:modelValue":e=>c(m).email=e,type:"email",required:""},null,t)),o('</div><div><label class="block text-sm font-medium text-gray-700 mb-1">Nova Senha (deixe vazio para manter)</label>'),o(h($,{modelValue:c(m).password,"onUpdate:modelValue":e=>c(m).password=e,type:"password",placeholder:"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"},null,t)),o('<p class="text-xs text-gray-500 mt-1">M√≠nimo 6 caracteres</p></div><div><label class="block text-sm font-medium text-gray-700 mb-1">N√≠vel de Acesso *</label>'),o(h(j,{modelValue:c(m).role,"onUpdate:modelValue":e=>c(m).role=e,required:""},{default:n((e,a,o,t)=>{if(!a)return[d("option",{value:"funcionario"},"Funcion√°rio"),d("option",{value:"admin",disabled:"silvana@qualitec.ind.br"!==c(m).email}," Administrador "+g("silvana@qualitec.ind.br"!==c(m).email?"(apenas silvana@qualitec.ind.br)":""),9,["disabled"])];a(`<option value="funcionario"${t}>Funcion√°rio</option><option value="admin"${C("silvana@qualitec.ind.br"!==c(m).email)?" disabled":""}${t}> Administrador ${w("silvana@qualitec.ind.br"!==c(m).email?"(apenas silvana@qualitec.ind.br)":"")}</option>`)}),_:1},t)),"admin"===c(m).role&&"silvana@qualitec.ind.br"!==c(m).email?o('<p class="text-xs text-amber-600 mt-1"> ‚ö†Ô∏è Apenas silvana@qualitec.ind.br pode ser admin </p>'):o("\x3c!----\x3e"),o('</div><div><label class="block text-sm font-medium text-gray-700 mb-1">Vincular a Colaborador</label>'),o(h(j,{modelValue:c(m).colaborador_id,"onUpdate:modelValue":e=>c(m).colaborador_id=e},{default:n((a,o,t,s)=>{if(!o)return[d("option",{value:""},"Nenhum v√≠nculo"),(p(!0),v(b,null,x(e.colaboradores,e=>(p(),v("option",{key:e.id,value:e.id},g(e.nome)+g(e.email_corporativo?` (${e.email_corporativo})`:""),9,["value"]))),128))];o(`<option value=""${s}>Nenhum v√≠nculo</option>\x3c!--[--\x3e`),_(e.colaboradores,e=>{o(`<option${U("value",e.id)}${s}>${w(e.nome)}${w(e.email_corporativo?` (${e.email_corporativo})`:"")}</option>`)}),o("\x3c!--]--\x3e")}),_:1},t)),o(`</div><div class="flex items-center gap-2"><input type="checkbox"${C(Array.isArray(c(m).ativo)?A(c(m).ativo,null):c(m).ativo)?" checked":""} class="w-4 h-4 text-red-700 border-gray-300 rounded focus:ring-red-500"><label class="text-sm font-medium text-gray-700">Usu√°rio ativo</label></div></div><div class="flex gap-3 mt-6 pt-6 border-t border-gray-200">`),o(h(q,{type:"button",theme:"admin",variant:"secondary","full-width":"",onClick:e=>a.$emit("close")},{default:n((e,a,o,t)=>{if(!a)return[u(" Cancelar ")];a(" Cancelar ")}),_:1},t)),o(h(q,{type:"submit",theme:"admin",variant:"primary","full-width":"",disabled:c(r)},{default:n((e,a,o,t)=>{if(!a)return[u(g(c(r)?"Salvando...":"Salvar Altera√ß√µes"),1)];a(`${w(c(r)?"Salvando...":"Salvar Altera√ß√µes")}`)}),_:1},t)),o("</div></form></div></div>")}}}),L=D.setup;D.setup=(e,a)=>{const o=f();return(o.modules||(o.modules=new Set)).add("components/UserEditModal.vue"),L?L(e,a):void 0};const P=Object.assign(D,{__name:"UserEditModal"}),G=t({__name:"UserCreateFromColaboradorModal",__ssrInlineRender:!0,props:{colaborador:{}},emits:["close","save"],setup(e,{expose:a,emit:o}){const t=e,m=s(!1),v=s({email:t.colaborador.email_corporativo||"",password:"",role:"funcionario",ativo:!0}),p=r(()=>"silvana@qualitec.ind.br"===v.value.email.toLowerCase());return a({saving:m}),(a,o,t,s)=>{const r=l("Icon"),b=S,x=k,f=E;o(`<div${y(i({class:"fixed inset-0 z-50 flex items-center justify-center"},s))}><div class="absolute inset-0 bg-black/50"></div><div class="relative bg-white rounded-xl shadow-xl w-full max-w-md mx-4"><div class="sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between rounded-t-xl"><h3 class="text-xl font-bold text-gray-800">Criar Acesso ao Sistema</h3><button class="p-2 hover:bg-gray-100 rounded-lg">`),o(h(r,{name:"heroicons:x-mark",size:"24"},null,t)),o(`</button></div><form class="p-6"><div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6"><div class="flex items-center gap-3"><div class="w-12 h-12 bg-blue-600 rounded-full flex items-center justify-center text-white font-semibold">${w((e=>{const a=e.split(" ");return 1===a.length?a[0].substring(0,2).toUpperCase():(a[0][0]+a[a.length-1][0]).toUpperCase()})(e.colaborador.nome))}</div><div><p class="font-semibold text-gray-800">${w(e.colaborador.nome)}</p><p class="text-sm text-gray-600">${w(e.colaborador.cpf)}</p>`),e.colaborador.cargo?o(`<p class="text-xs text-gray-500">${w(e.colaborador.cargo.nome)}</p>`):o("\x3c!----\x3e"),o('</div></div></div><div class="space-y-4"><div><label class="block text-sm font-medium text-gray-700 mb-1">Email de Login *</label>'),o(h(b,{modelValue:c(v).email,"onUpdate:modelValue":e=>c(v).email=e,type:"email",required:"",placeholder:"usuario@qualitec.ind.br"},null,t)),o('<p class="text-xs text-gray-500 mt-1"> Este email ser√° usado para fazer login no sistema </p></div><div><label class="block text-sm font-medium text-gray-700 mb-1">Senha Inicial *</label>'),o(h(b,{modelValue:c(v).password,"onUpdate:modelValue":e=>c(v).password=e,type:"password",required:"",placeholder:"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"},null,t)),o('<p class="text-xs text-gray-500 mt-1">M√≠nimo 6 caracteres</p></div><div><label class="block text-sm font-medium text-gray-700 mb-1">N√≠vel de Acesso *</label>'),o(h(x,{modelValue:c(v).role,"onUpdate:modelValue":e=>c(v).role=e,required:""},{default:n((e,a,o,t)=>{if(!a)return[d("option",{value:"funcionario"},"üë§ Funcion√°rio (Portal do Funcion√°rio)"),d("option",{value:"admin",disabled:!c(p)}," üëë Administrador (Acesso Total) "+g(c(p)?"":" - Apenas silvana@qualitec.ind.br"),9,["disabled"])];a(`<option value="funcionario"${t}>üë§ Funcion√°rio (Portal do Funcion√°rio)</option><option value="admin"${C(!c(p))?" disabled":""}${t}> üëë Administrador (Acesso Total) ${w(c(p)?"":" - Apenas silvana@qualitec.ind.br")}</option>`)}),_:1},t)),o(`</div><div class="flex items-center gap-2"><input type="checkbox"${C(Array.isArray(c(v).ativo)?A(c(v).ativo,null):c(v).ativo)?" checked":""} class="w-4 h-4 text-red-700 border-gray-300 rounded focus:ring-red-500"><label class="text-sm font-medium text-gray-700">Usu√°rio ativo (pode fazer login)</label></div></div><div class="flex gap-3 mt-6 pt-6 border-t border-gray-200">`),o(h(f,{type:"button",theme:"admin",variant:"secondary","full-width":"",onClick:e=>a.$emit("close")},{default:n((e,a,o,t)=>{if(!a)return[u(" Cancelar ")];a(" Cancelar ")}),_:1},t)),o(h(f,{type:"submit",theme:"admin",variant:"primary","full-width":"",disabled:c(m)},{default:n((e,a,o,t)=>{if(!a)return[u(g(c(m)?"Criando...":"Criar Acesso"),1)];a(`${w(c(m)?"Criando...":"Criar Acesso")}`)}),_:1},t)),o("</div></form></div></div>")}}}),H=G.setup;G.setup=(e,a)=>{const o=f();return(o.modules||(o.modules=new Set)).add("components/UserCreateFromColaboradorModal.vue"),H?H(e,a):void 0};const Q=Object.assign(G,{__name:"UserCreateFromColaboradorModal"}),X=t({__name:"users",__ssrInlineRender:!0,setup(t){const{users:u,loading:m,countByRole:v,countByStatus:p,filterUsers:b,toggleUserStatus:x,createUser:g,updateUser:f}=(()=>{const e=a(),o=s([]),t=s(!1),l=s(null),fetchUsers=async()=>{t.value=!0,l.value=null;try{const e=await $fetch("/api/users/list");if(e.success)return o.value=e.data,{success:!0,data:e.data};throw new Error("Falha ao carregar usu√°rios")}catch(e){return console.error("Erro ao listar usu√°rios:",e),l.value=e.data?.message||e.message||"Erro ao carregar usu√°rios",{success:!1,error:l.value}}finally{t.value=!1}},updateUser=async(e,a)=>{t.value=!0,l.value=null;try{const o=await $fetch("/api/users/update",{method:"PUT",body:{id:e,...a}});if(o.success)return await fetchUsers(),{success:!0,data:o.data};throw new Error("Falha ao atualizar usu√°rio")}catch(e){console.error("Erro ao atualizar usu√°rio:",e);const a=e.data?.message||e.message||"Erro ao atualizar usu√°rio";return l.value=a,{success:!1,error:a}}finally{t.value=!1}},toggleUserStatus=async(e,a)=>await updateUser(e,{ativo:a}),i=r(()=>({admin:o.value.filter(e=>"admin"===e.role).length,funcionario:o.value.filter(e=>"funcionario"===e.role).length,total:o.value.length})),n=r(()=>({ativo:o.value.filter(e=>e.ativo).length,inativo:o.value.filter(e=>!e.ativo).length}));return{users:o,loading:t,error:l,countByRole:i,countByStatus:n,fetchUsers:fetchUsers,fetchUserById:async a=>{t.value=!0,l.value=null;try{const{data:o,error:t}=await e.from("app_users").select("*").eq("id",a).single();if(t)throw t;return{success:!0,data:o}}catch(e){return l.value=e.message,{success:!1,error:e.message}}finally{t.value=!1}},createUser:async e=>{t.value=!0,l.value=null;try{const a=await $fetch("/api/users/create",{method:"POST",body:{email:e.email,password:e.password,nome:e.nome,role:e.role||"funcionario",colaborador_id:e.colaborador_id}});return await fetchUsers(),{success:!0,data:a.data}}catch(e){console.error("Erro ao criar usu√°rio:",e);let a="Erro ao criar usu√°rio";if(e.data?.message?a=e.data.message:e.data?.statusMessage?a=e.data.statusMessage:e.message&&!e.message.includes("[POST]")?a=e.message:e.statusMessage&&(a=e.statusMessage),a.includes("[POST]")||a.includes("[GET]")){const e=a.match(/\d{3}\s+(.+)$/);e&&(a=e[1])}return l.value=a,{success:!1,error:a}}finally{t.value=!1}},updateUser:updateUser,toggleUserStatus:toggleUserStatus,deleteUser:async e=>await toggleUserStatus(e,!1),filterUsers:e=>{let a=[...o.value];if(e.search){const o=e.search.toLowerCase();a=a.filter(e=>e.nome.toLowerCase().includes(o)||e.email.toLowerCase().includes(o))}if(e.role&&"all"!==e.role&&(a=a.filter(a=>a.role===e.role)),e.status&&"all"!==e.status){const o="ativo"===e.status;a=a.filter(e=>e.ativo===o)}return a}}})(),U=s({search:"",role:"all",status:"all"}),C=s(!1),A=s(!1),E=s(!1),j=s(null),q=s(null),V=s(!1),I={nome:"",email:"",password:"",role:"funcionario",colaborador_id:"",ativo:!0},T=s({...I}),N=s([]),B=s([]),O=r(()=>b(U.value)),D=r(()=>{const e=u.value.filter(e=>e.colaborador_id).map(e=>e.colaborador_id);return B.value.filter(a=>{const o=e.includes(a.id),t="silvana@qualitec.ind.br"===a.email_corporativo?.toLowerCase();return"Ativo"===a.status&&!o&&!t})}),closeModal=()=>{C.value=!1,A.value=!1,T.value={...I}},handleSubmit=async()=>{if(!T.value.nome||!T.value.email)return void alert("‚ùå Nome e email s√£o obrigat√≥rios!");if(!T.value.password||T.value.password.length<6)return void alert("‚ùå Senha deve ter no m√≠nimo 6 caracteres!");if(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(T.value.email)){V.value=!0;try{const e=await g({nome:T.value.nome,email:T.value.email.toLowerCase().trim(),password:T.value.password,role:T.value.role,colaborador_id:T.value.colaborador_id||void 0});e.success?(alert("‚úÖ Usu√°rio criado com sucesso!\n\nO usu√°rio j√° pode fazer login no sistema."),closeModal()):alert(`‚ùå Erro ao criar usu√°rio:\n\n${e.error}`)}catch(e){alert(`‚ùå Erro ao criar usu√°rio:\n\n${e.message||"Erro desconhecido"}`)}finally{V.value=!1}}else alert("‚ùå Email inv√°lido! Use um formato v√°lido como: usuario@empresa.com")},closeEditModal=()=>{A.value=!1,j.value=null},handleSaveEdit=async e=>{if(j.value){V.value=!0;try{const a=await f(j.value.id,e);a.success?(alert("‚úÖ Usu√°rio atualizado com sucesso!"),closeEditModal()):alert(`‚ùå Erro ao atualizar usu√°rio:\n\n${a.error}`)}catch(e){alert(`‚ùå Erro ao atualizar usu√°rio:\n\n${e.message||"Erro desconhecido"}`)}finally{V.value=!1}}},handleCriarAcessoColaborador=e=>{q.value=e,E.value=!0},closeCreateFromColaboradorModal=()=>{E.value=!1,q.value=null},handleSaveCreateFromColaborador=async e=>{V.value=!0;try{const o=await g(e);o.success?(alert("‚úÖ Acesso criado com sucesso!\n\nO colaborador j√° pode fazer login no sistema."),closeCreateFromColaboradorModal(),await(async()=>{const e=a(),{data:o}=await e.from("colaboradores").select("id, nome, email_corporativo").eq("status","Ativo").order("nome");N.value=o||[];const{data:t}=await e.from("colaboradores").select("id, nome, cpf, email_corporativo, status, cargo:cargo_id(id, nome)").eq("status","Ativo").order("nome");B.value=t||[]})()):alert(`‚ùå Erro ao criar acesso:\n\n${o.error}`)}catch(e){alert(`‚ùå Erro ao criar acesso:\n\n${e.message||"Erro desconhecido"}`)}finally{V.value=!1}};return(a,t,s,r)=>{const u=e,b=l("Icon"),g=o,f=z,I=S,B=k,L=F,G=M,H=R,X=P,J=Q;t(`<div${y(i({class:"min-h-screen bg-gray-50"},r))}><header class="bg-white border-b border-gray-200 sticky top-0 z-40"><div class="max-w-7xl mx-auto px-8 py-4"><div class="flex items-center justify-between"><div class="flex items-center gap-4">`),t(h(u,{to:"/admin",class:"w-10 h-10 bg-red-700 rounded-lg flex items-center justify-center hover:bg-red-800 transition-colors"},{default:n((e,a,o,t)=>{if(!a)return[d(b,{name:"heroicons:arrow-left",class:"text-white",size:"20"})];a(h(b,{name:"heroicons:arrow-left",class:"text-white",size:"20"},null,o,t))}),_:1},s)),t('<div><h1 class="text-xl font-bold text-gray-800">Gest√£o de Usu√°rios</h1><p class="text-sm text-gray-500">Gerenciar usu√°rios do sistema</p></div></div>'),t(h(g,{theme:"admin"},null,s)),t('</div></div></header><div class="max-w-7xl mx-auto p-8">'),c(D).length>0?t(h(f,{"colaboradores-sem-acesso":c(D),onCriarAcesso:handleCriarAcessoColaborador,class:"mb-8"},null,s)):t("\x3c!----\x3e"),t('<div class="grid md:grid-cols-4 gap-6 mb-8"><div class="card bg-red-50 border-2 border-red-200"><div class="flex items-center gap-4"><div class="w-12 h-12 bg-red-700 rounded-lg flex items-center justify-center">'),t(h(b,{name:"heroicons:users",class:"text-white",size:"24"},null,s)),t(`</div><div><p class="text-sm text-gray-600">Total</p><p class="text-2xl font-bold text-gray-800">${w(c(v).total)}</p></div></div></div><div class="card"><div class="flex items-center gap-4"><div class="w-12 h-12 bg-red-600 rounded-lg flex items-center justify-center">`),t(h(b,{name:"heroicons:shield-check",class:"text-white",size:"24"},null,s)),t(`</div><div><p class="text-sm text-gray-600">Admins</p><p class="text-2xl font-bold text-gray-800">${w(c(v).admin)}</p></div></div></div><div class="card"><div class="flex items-center gap-4"><div class="w-12 h-12 bg-blue-600 rounded-lg flex items-center justify-center">`),t(h(b,{name:"heroicons:user-group",class:"text-white",size:"24"},null,s)),t(`</div><div><p class="text-sm text-gray-600">Funcion√°rios</p><p class="text-2xl font-bold text-gray-800">${w(c(v).funcionario)}</p></div></div></div><div class="card"><div class="flex items-center gap-4"><div class="w-12 h-12 bg-green-600 rounded-lg flex items-center justify-center">`),t(h(b,{name:"heroicons:check-circle",class:"text-white",size:"24"},null,s)),t(`</div><div><p class="text-sm text-gray-600">Ativos</p><p class="text-2xl font-bold text-gray-800">${w(c(p).ativo)}</p></div></div></div></div><div class="card mb-8"><div class="flex flex-col md:flex-row gap-4 items-start md:items-center justify-between"><div class="flex flex-col md:flex-row gap-4 flex-1"><div class="flex-1">`),t(h(I,{modelValue:c(U).search,"onUpdate:modelValue":e=>c(U).search=e,type:"text",placeholder:"Buscar por nome ou email...","icon-left":"heroicons:magnifying-glass"},null,s)),t("</div>"),t(h(B,{modelValue:c(U).role,"onUpdate:modelValue":e=>c(U).role=e,"icon-left":"heroicons:user-circle",class:"w-full md:w-48"},{default:n((e,a,o,t)=>{if(!a)return[d("option",{value:"all"},"Todos os roles"),d("option",{value:"admin"},"Admin"),d("option",{value:"funcionario"},"Funcion√°rio")];a(`<option value="all"${t}>Todos os roles</option><option value="admin"${t}>Admin</option><option value="funcionario"${t}>Funcion√°rio</option>`)}),_:1},s)),t(h(B,{modelValue:c(U).status,"onUpdate:modelValue":e=>c(U).status=e,"icon-left":"heroicons:check-badge",class:"w-full md:w-48"},{default:n((e,a,o,t)=>{if(!a)return[d("option",{value:"all"},"Todos os status"),d("option",{value:"ativo"},"Ativos"),d("option",{value:"inativo"},"Inativos")];a(`<option value="all"${t}>Todos os status</option><option value="ativo"${t}>Ativos</option><option value="inativo"${t}>Inativos</option>`)}),_:1},s)),t("</div>"),t(h(L,{onClick:e=>C.value=!0},null,s)),t("</div></div>"),c(m)?(t('<div class="card text-center py-12">'),t(h(b,{name:"heroicons:arrow-path",class:"animate-spin text-gray-400 mx-auto mb-4",size:"48"},null,s)),t('<p class="text-gray-600">Carregando usu√°rios...</p></div>')):c(O).length>0?(t('<div class="card overflow-hidden"><div class="overflow-x-auto"><table class="w-full"><thead class="bg-gray-50 border-b border-gray-200"><tr><th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Usu√°rio</th><th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Email</th><th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Role</th><th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Status</th><th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Criado em</th><th class="px-6 py-3 text-right text-xs font-semibold text-gray-600 uppercase">A√ß√µes</th></tr></thead><tbody class="divide-y divide-gray-200">\x3c!--[--\x3e'),_(c(O),e=>{var a;t(`<tr class="hover:bg-gray-50"><td class="px-6 py-4"><div class="flex items-center gap-3"><div class="${$(["admin"===e.role?"bg-red-700":"bg-blue-900","w-10 h-10 rounded-full flex items-center justify-center text-white font-semibold"])}">${w((e=>{const a=e.split(" ");return 1===a.length?a[0].substring(0,2).toUpperCase():(a[0][0]+a[a.length-1][0]).toUpperCase()})(e.nome))}</div><div class="flex items-center gap-2"><p class="font-medium text-gray-800">${w(e.nome)}</p>`),"admin"===e.role?t('<span class="text-xl" title="Administradora"> üëë </span>'):t('<span class="text-lg" title="Funcion√°rio"> üë§ </span>'),t(`</div></div></td><td class="px-6 py-4 text-sm text-gray-600">${w(e.email)}</td><td class="px-6 py-4"><span class="${$(["admin"===e.role?"badge-error":"badge-info","badge"])}">${w(e.role)}</span></td><td class="px-6 py-4"><span class="${$([e.ativo?"badge-success":"badge-warning","badge"])}">${w(e.ativo?"Ativo":"Inativo")}</span></td><td class="px-6 py-4 text-sm text-gray-600">${w((a=e.created_at,new Date(a).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric"})))}</td><td class="px-6 py-4">`),t(h(G,{"is-active":e.ativo,onToggleStatus:a=>(async e=>{const a=e.ativo?"desativar":"ativar";if(confirm(`Deseja ${a} o usu√°rio ${e.nome}?`)){const o=await x(e.id,!e.ativo);o.success?alert(`Usu√°rio ${a}do com sucesso!`):alert(`Erro ao ${a} usu√°rio: ${o.error}`)}})(e),onEdit:a=>(e=>{j.value=e,A.value=!0})(e)},null,s)),t("</td></tr>")}),t("\x3c!--]--\x3e</tbody></table></div></div>")):(t('<div class="card text-center py-12">'),t(h(b,{name:"heroicons:users",class:"text-gray-300 mx-auto mb-4",size:"64"},null,s)),t('<h3 class="text-lg font-semibold text-gray-800 mb-2">Nenhum usu√°rio encontrado</h3><p class="text-gray-600 mb-6">Ajuste os filtros ou crie um novo usu√°rio</p>'),t(h(L,{onClick:e=>C.value=!0},null,s)),t("</div>")),t("</div>"),c(C)?t(h(H,{"is-editing":!1,form:c(T),saving:c(V),colaboradores:c(N),onClose:closeModal,onSubmit:handleSubmit,"onUpdate:form":e=>T.value=e},null,s)):t("\x3c!----\x3e"),c(A)&&c(j)?t(h(X,{user:c(j),colaboradores:c(N),onClose:closeEditModal,onSave:handleSaveEdit},null,s)):t("\x3c!----\x3e"),c(E)&&c(q)?t(h(J,{colaborador:c(q),onClose:closeCreateFromColaboradorModal,onSave:handleSaveCreateFromColaborador},null,s)):t("\x3c!----\x3e"),t("</div>")}}}),J=X.setup;X.setup=(e,a)=>{const o=f();return(o.modules||(o.modules=new Set)).add("pages/users.vue"),J?J(e,a):void 0};export{X as default};
