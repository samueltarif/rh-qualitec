import{_ as e}from"./server.mjs";import{_ as a}from"./UserProfileDropdown-D7V90wtd.mjs";import{_ as o}from"./UIStatsCard-JOYac-_Z.mjs";import{_ as t}from"./UISearchInput-c9hD8k5T.mjs";import{_ as r}from"./UISelect-C9tnEbh5.mjs";import{_ as s}from"./UIEmptyState-DSGrV1Ch.mjs";import{_ as l}from"./UIModal-PwEumyFL.mjs";import{defineComponent as i,ref as n,computed as d,watch as c,resolveComponent as u,mergeProps as p,withCtx as m,createVNode as v,unref as g,isRef as b,createBlock as x,createCommentVNode as f,openBlock as h,createTextVNode as y,toDisplayString as $,withDirectives as w,vModelText as j,useSSRContext as _}from"vue";import{ssrRenderAttrs as A,ssrRenderComponent as C,ssrRenderList as R,ssrRenderClass as U,ssrInterpolate as E,ssrRenderAttr as S,ssrIncludeBooleanAttr as k}from"vue/server-renderer";import"../_/nitro.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"../routes/renderer.mjs";import"vue-bundle-renderer/runtime";import"unhead/server";import"devalue";import"pinia";import"vue-router";import"@supabase/ssr";import"./UIButton-BfdUCxqX.mjs";const P=i({__name:"solicitacoes",__ssrInlineRender:!0,setup(i){const _=n([]),P=n({total:0,pendentes:0,em_analise:0,aprovadas:0,rejeitadas:0,concluidas:0}),I=n(!1),V=n(""),D=n("todos"),z=n(""),L=n(!1),O=n(null),T=n("aprovar"),F=n({texto:""}),q=d(()=>"aprovar"===T.value?"Aprovar Solicitação":"Rejeitar Solicitação"),B=d(()=>{let e=_.value;if(V.value){const a=V.value.toLowerCase();e=e.filter(e=>e.colaborador_nome?.toLowerCase().includes(a)||e.titulo?.toLowerCase().includes(a))}return e}),fetchSolicitacoes=async()=>{I.value=!0;try{const e=new URLSearchParams;"todos"!==D.value&&e.append("status",D.value),z.value&&e.append("tipo",z.value);const a=await $fetch(`/api/admin/solicitacoes?${e}`);_.value=a}catch(e){console.error("Erro ao buscar solicitações:",e)}finally{I.value=!1}},confirmarResposta=async()=>{if(O.value)try{await $fetch(`/api/admin/solicitacoes/${O.value.id}`,{method:"PUT",body:{status:"aprovar"===T.value?"Aprovada":"Rejeitada",resposta:"aprovar"===T.value?F.value.texto:null,motivo_rejeicao:"rejeitar"===T.value?F.value.texto:null}}),L.value=!1,await fetchSolicitacoes(),await(async()=>{try{const e=await $fetch("/api/admin/solicitacoes/stats");P.value=e}catch(e){console.error("Erro ao buscar stats:",e)}})(),alert(`Solicitação ${"aprovar"===T.value?"aprovada":"rejeitada"} com sucesso!`)}catch(e){alert(e.message||"Erro ao processar solicitação")}};return c([D,z],()=>fetchSolicitacoes()),(i,n,d,c)=>{const _=e,H=u("Icon"),M=a,G=o,N=t,J=r,X=s,Y=l;n(`<div${A(p({class:"min-h-screen bg-gray-50"},c))}><header class="bg-white border-b border-gray-200 sticky top-0 z-40"><div class="max-w-7xl mx-auto px-8 py-4"><div class="flex items-center justify-between"><div class="flex items-center gap-4">`),n(C(_,{to:"/admin",class:"w-10 h-10 bg-red-700 rounded-lg flex items-center justify-center hover:bg-red-800 transition-colors"},{default:m((e,a,o,t)=>{if(!a)return[v(H,{name:"heroicons:arrow-left",class:"text-white",size:"20"})];a(C(H,{name:"heroicons:arrow-left",class:"text-white",size:"20"},null,o,t))}),_:1},d)),n('<div><h1 class="text-xl font-bold text-gray-800">Solicitações de Funcionários</h1><p class="text-sm text-gray-500">Gerencie as solicitações dos colaboradores</p></div></div>'),n(C(M,{theme:"admin"},null,d)),n('</div></div></header><div class="max-w-7xl mx-auto p-8"><div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-8">'),n(C(G,{label:"Pendentes",value:g(P).pendentes,icon:"heroicons:clock",color:"amber"},null,d)),n(C(G,{label:"Em Análise",value:g(P).em_analise,icon:"heroicons:magnifying-glass",color:"blue"},null,d)),n(C(G,{label:"Aprovadas",value:g(P).aprovadas,icon:"heroicons:check-circle",color:"green"},null,d)),n(C(G,{label:"Rejeitadas",value:g(P).rejeitadas,icon:"heroicons:x-circle",color:"red"},null,d)),n(C(G,{label:"Concluídas",value:g(P).concluidas,icon:"heroicons:check-badge",color:"gray"},null,d)),n('</div><div class="bg-white rounded-xl border border-gray-200 p-4 mb-6"><div class="flex flex-wrap items-center gap-4">'),n(C(N,{modelValue:g(V),"onUpdate:modelValue":e=>b(V)?V.value=e:null,placeholder:"Buscar por colaborador...",class:"w-64"},null,d)),n(C(J,{modelValue:g(D),"onUpdate:modelValue":e=>b(D)?D.value=e:null,class:"w-48"},{default:m((e,a,o,t)=>{if(!a)return[v("option",{value:"todos"},"Todos os status"),v("option",{value:"Pendente"},"Pendentes"),v("option",{value:"Em_Analise"},"Em Análise"),v("option",{value:"Aprovada"},"Aprovadas"),v("option",{value:"Rejeitada"},"Rejeitadas"),v("option",{value:"Concluida"},"Concluídas")];a(`<option value="todos"${t}>Todos os status</option><option value="Pendente"${t}>Pendentes</option><option value="Em_Analise"${t}>Em Análise</option><option value="Aprovada"${t}>Aprovadas</option><option value="Rejeitada"${t}>Rejeitadas</option><option value="Concluida"${t}>Concluídas</option>`)}),_:1},d)),n(C(J,{modelValue:g(z),"onUpdate:modelValue":e=>b(z)?z.value=e:null,class:"w-48"},{default:m((e,a,o,t)=>{if(!a)return[v("option",{value:""},"Todos os tipos"),v("option",{value:"ferias"},"Férias"),v("option",{value:"abono"},"Abono"),v("option",{value:"atestado"},"Atestado"),v("option",{value:"declaracao"},"Declaração"),v("option",{value:"holerite"},"Holerite"),v("option",{value:"outros"},"Outros")];a(`<option value=""${t}>Todos os tipos</option><option value="ferias"${t}>Férias</option><option value="abono"${t}>Abono</option><option value="atestado"${t}>Atestado</option><option value="declaracao"${t}>Declaração</option><option value="holerite"${t}>Holerite</option><option value="outros"${t}>Outros</option>`)}),_:1},d)),n("</div></div>"),g(I)?(n('<div class="text-center py-12">'),n(C(H,{name:"heroicons:arrow-path",class:"animate-spin text-gray-400",size:"40"},null,d)),n('<p class="text-gray-500 mt-2">Carregando...</p></div>')):0===g(B).length?(n("<div>"),n(C(X,{icon:"heroicons:document-text",title:"Nenhuma solicitação encontrada",description:"Não há solicitações com os filtros selecionados.",color:"gray"},null,d)),n("</div>")):(n('<div class="space-y-4">\x3c!--[--\x3e'),R(g(B),e=>{var a,o,t;n(`<div class="bg-white border border-gray-200 rounded-xl p-6 hover:shadow-md transition-shadow"><div class="flex items-start justify-between gap-4"><div class="flex-1"><div class="flex items-center gap-2 mb-2"><span class="${U([(o=e.tipo,{ferias:"bg-amber-100 text-amber-700",abono:"bg-blue-100 text-blue-700",atestado:"bg-purple-100 text-purple-700",declaracao:"bg-green-100 text-green-700"}[o]||"bg-gray-100 text-gray-700"),"px-2 py-1 text-xs font-medium rounded-full"])}">${E((e=>({ferias:"Férias",abono:"Abono",atestado:"Atestado",declaracao:"Declaração",alteracao_dados:"Alteração de Dados",holerite:"Holerite",informe_rendimentos:"Informe de Rendimentos",carta_referencia:"Carta de Referência",outros:"Outros"}[e]||e))(e.tipo))}</span><span class="${U([(a=e.status,{Pendente:"bg-yellow-100 text-yellow-700",Em_Analise:"bg-blue-100 text-blue-700",Aprovada:"bg-green-100 text-green-700",Rejeitada:"bg-red-100 text-red-700",Cancelada:"bg-gray-100 text-gray-700",Concluida:"bg-green-100 text-green-700"}[a]||"bg-gray-100 text-gray-700"),"px-2 py-1 text-xs font-medium rounded-full"])}">${E((e=>({Pendente:"Pendente",Em_Analise:"Em Análise",Aprovada:"Aprovada",Rejeitada:"Rejeitada",Cancelada:"Cancelada",Concluida:"Concluída"}[e]||e))(e.status))}</span>`),"Urgente"===e.prioridade?n('<span class="px-2 py-1 text-xs font-medium rounded-full bg-red-100 text-red-700"> Urgente </span>'):n("\x3c!----\x3e"),n(`</div><h4 class="font-semibold text-gray-800">${E(e.titulo)}</h4><p class="text-sm text-gray-600 mt-1"><span class="font-medium">${E(e.colaborador_nome)}</span>`),e.cargo?n(`<span class="text-gray-400"> • ${E(e.cargo)}</span>`):n("\x3c!----\x3e"),e.departamento?n(`<span class="text-gray-400"> • ${E(e.departamento)}</span>`):n("\x3c!----\x3e"),n("</p>"),e.descricao?n(`<p class="text-sm text-gray-500 mt-2">${E(e.descricao)}</p>`):n("\x3c!----\x3e"),n(`<p class="text-xs text-gray-400 mt-2"> Solicitado em ${E((t=e.data_solicitacao,t?new Date(t).toLocaleDateString("pt-BR"):"-"))}</p></div>`),"Pendente"===e.status||"Em_Analise"===e.status?(n('<div class="flex gap-2"><button class="px-3 py-2 bg-green-600 text-white text-sm font-medium rounded-lg hover:bg-green-700">'),n(C(H,{name:"heroicons:check",size:"16",class:"mr-1"},null,d)),n(' Aprovar </button><button class="px-3 py-2 bg-red-600 text-white text-sm font-medium rounded-lg hover:bg-red-700">'),n(C(H,{name:"heroicons:x-mark",size:"16",class:"mr-1"},null,d)),n(" Rejeitar </button></div>")):n("\x3c!----\x3e"),n("</div></div>")}),n("\x3c!--]--\x3e</div>")),n("</div>"),n(C(Y,{modelValue:g(L),"onUpdate:modelValue":e=>b(L)?L.value=e:null,title:g(q),size:"md"},{footer:m((e,a,o,t)=>{if(!a)return[v("div",{class:"flex gap-3"},[v("button",{onClick:e=>L.value=!1,class:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300"}," Cancelar ",8,["onClick"]),v("button",{onClick:confirmarResposta,disabled:"rejeitar"===g(T)&&!g(F).texto,class:["aprovar"===g(T)?"bg-green-600 hover:bg-green-700":"bg-red-600 hover:bg-red-700","px-4 py-2 text-white font-medium rounded-lg disabled:opacity-50"]},$("aprovar"===g(T)?"Confirmar Aprovação":"Confirmar Rejeição"),11,["disabled"])])];a(`<div class="flex gap-3"${t}><button class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300"${t}> Cancelar </button><button${k("rejeitar"===g(T)&&!g(F).texto)?" disabled":""} class="${U(["aprovar"===g(T)?"bg-green-600 hover:bg-green-700":"bg-red-600 hover:bg-red-700","px-4 py-2 text-white font-medium rounded-lg disabled:opacity-50"])}"${t}>${E("aprovar"===g(T)?"Confirmar Aprovação":"Confirmar Rejeição")}</button></div>`)}),default:m((e,a,o,t)=>{if(!a)return[v("div",{class:"space-y-4"},[g(O)?(h(),x("div",{key:0},[v("p",{class:"text-sm text-gray-600 mb-4"},[y(" Solicitação de "),v("strong",null,$(g(O).colaborador_nome),1),y(": "),v("br"),y($(g(O).titulo),1)])])):f("",!0),v("div",null,[v("label",{class:"block text-sm font-medium text-gray-700 mb-1"},$("aprovar"===g(T)?"Observações (opcional)":"Motivo da Rejeição *"),1),w(v("textarea",{"onUpdate:modelValue":e=>g(F).texto=e,rows:"4",required:"rejeitar"===g(T),class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent resize-none",placeholder:"aprovar"===g(T)?"Adicione observações se necessário...":"Informe o motivo da rejeição..."},null,8,["onUpdate:modelValue","required","placeholder"]),[[j,g(F).texto]])])])];a(`<div class="space-y-4"${t}>`),g(O)?a(`<div${t}><p class="text-sm text-gray-600 mb-4"${t}> Solicitação de <strong${t}>${E(g(O).colaborador_nome)}</strong>: <br${t}>${E(g(O).titulo)}</p></div>`):a("\x3c!----\x3e"),a(`<div${t}><label class="block text-sm font-medium text-gray-700 mb-1"${t}>${E("aprovar"===g(T)?"Observações (opcional)":"Motivo da Rejeição *")}</label><textarea rows="4"${k("rejeitar"===g(T))?" required":""} class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent resize-none"${S("placeholder","aprovar"===g(T)?"Adicione observações se necessário...":"Informe o motivo da rejeição...")}${t}>${E(g(F).texto)}</textarea></div></div>`)}),_:1},d)),n("</div>")}}}),I=P.setup;P.setup=(e,a)=>{const o=_();return(o.modules||(o.modules=new Set)).add("pages/admin/solicitacoes.vue"),I?I(e,a):void 0};export{P as default};
