import{_ as e}from"./server.mjs";import{_ as o}from"./UIButton-BfdUCxqX.mjs";import{_ as t}from"./UserProfileDropdown-D7V90wtd.mjs";import{_ as a}from"./UIEmptyState-DSGrV1Ch.mjs";import{_ as r}from"./UIModal-PwEumyFL.mjs";import{defineComponent as i,ref as l,resolveComponent as n,mergeProps as d,withCtx as s,createVNode as u,createTextVNode as c,unref as p,isRef as m,withModifiers as v,createBlock as g,createCommentVNode as x,withDirectives as b,vModelText as y,vModelSelect as f,openBlock as $,vModelCheckbox as h,toDisplayString as w,useSSRContext as C}from"vue";import{ssrRenderAttrs as U,ssrRenderComponent as _,ssrRenderList as I,ssrRenderClass as k,ssrInterpolate as A,ssrRenderAttr as V,ssrIncludeBooleanAttr as E,ssrLooseContain as P,ssrLooseEqual as z}from"vue/server-renderer";import"../_/nitro.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"../routes/renderer.mjs";import"vue-bundle-renderer/runtime";import"unhead/server";import"devalue";import"pinia";import"vue-router";import"@supabase/ssr";const j=i({__name:"comunicados",__ssrInlineRender:!0,setup(i){const C=l([]),j=l(!1),B=l(!1),D=l(!1),T=l(null),S=l({titulo:"",conteudo:"",tipo:"Informativo",destino:"todos",destino_ids:[],data_expiracao:"",ativo:!0}),abrirModal=e=>{D.value=!1,T.value=null,S.value={titulo:"",conteudo:"",tipo:"Informativo",destino:"todos",destino_ids:[],data_expiracao:"",ativo:!0},B.value=!0},salvar=async()=>{try{D.value&&T.value?await $fetch(`/api/admin/comunicados/${T.value}`,{method:"PUT",body:S.value}):await $fetch("/api/admin/comunicados",{method:"POST",body:S.value}),B.value=!1,await(async()=>{j.value=!0;try{const e=await $fetch("/api/admin/comunicados");C.value=e}catch(e){console.error("Erro:",e)}finally{j.value=!1}})(),alert("Comunicado salvo com sucesso!")}catch(e){alert(e.message||"Erro ao salvar")}},formatDate=e=>e?new Date(e).toLocaleDateString("pt-BR"):"-";return(i,l,T,q)=>{const N=e,L=n("Icon"),R=o,F=t,G=a,M=r;l(`<div${U(d({class:"min-h-screen bg-gray-50"},q))}><header class="bg-white border-b border-gray-200 sticky top-0 z-40"><div class="max-w-7xl mx-auto px-8 py-4"><div class="flex items-center justify-between"><div class="flex items-center gap-4">`),l(_(N,{to:"/admin",class:"w-10 h-10 bg-red-700 rounded-lg flex items-center justify-center hover:bg-red-800 transition-colors"},{default:s((e,o,t,a)=>{if(!o)return[u(L,{name:"heroicons:arrow-left",class:"text-white",size:"20"})];o(_(L,{name:"heroicons:arrow-left",class:"text-white",size:"20"},null,t,a))}),_:1},T)),l('<div><h1 class="text-xl font-bold text-gray-800">Comunicados</h1><p class="text-sm text-gray-500">Publique comunicados para os funcionários</p></div></div><div class="flex items-center gap-3">'),l(_(R,{theme:"admin",variant:"primary",onClick:e=>abrirModal()},{default:s((e,o,t,a)=>{if(!o)return[u(L,{name:"heroicons:plus",size:"20",class:"mr-1"}),c(" Novo Comunicado ")];o(_(L,{name:"heroicons:plus",size:"20",class:"mr-1"},null,t,a)),o(" Novo Comunicado ")}),_:1},T)),l(_(F,{theme:"admin"},null,T)),l('</div></div></div></header><div class="max-w-7xl mx-auto p-8">'),p(j)?(l('<div class="text-center py-12">'),l(_(L,{name:"heroicons:arrow-path",class:"animate-spin text-gray-400",size:"40"},null,T)),l("</div>")):0===p(C).length?(l("<div>"),l(_(G,{icon:"heroicons:megaphone",title:"Nenhum comunicado",description:"Crie o primeiro comunicado para seus funcionários.",color:"amber"},{action:s((e,o,t,a)=>{if(!o)return[u(R,{theme:"admin",variant:"primary",onClick:e=>abrirModal()},{default:s(()=>[c(" Criar Comunicado ")]),_:1},8,["onClick"])];o(_(R,{theme:"admin",variant:"primary",onClick:e=>abrirModal()},{default:s((e,o,t,a)=>{if(!o)return[c(" Criar Comunicado ")];o(" Criar Comunicado ")}),_:1},t,a))}),_:1},T)),l("</div>")):(l('<div class="space-y-4">\x3c!--[--\x3e'),I(p(C),e=>{var o,t;l(`<div class="bg-white border border-gray-200 rounded-xl p-6 hover:shadow-md transition-shadow"><div class="flex items-start justify-between gap-4"><div class="flex-1"><div class="flex items-center gap-2 mb-2"><span class="${k([(t=e.tipo,{Informativo:"bg-blue-100 text-blue-700",Importante:"bg-amber-100 text-amber-700",Urgente:"bg-red-100 text-red-700",Evento:"bg-purple-100 text-purple-700",Beneficio:"bg-green-100 text-green-700"}[t]||"bg-gray-100 text-gray-700"),"px-2 py-1 text-xs font-medium rounded-full"])}">${A(e.tipo)}</span><span class="${k([e.ativo?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700","px-2 py-1 text-xs font-medium rounded-full"])}">${A(e.ativo?"Ativo":"Inativo")}</span><span class="px-2 py-1 text-xs font-medium rounded-full bg-gray-100 text-gray-600">${A((o=e.destino,{todos:"Todos",departamento:"Por Departamento",cargo:"Por Cargo",individual:"Individual"}[o]||o))}</span></div><h4 class="font-semibold text-gray-800">${A(e.titulo)}</h4><p class="text-sm text-gray-600 mt-1 line-clamp-2">${A(e.conteudo)}</p><p class="text-xs text-gray-400 mt-2"> Publicado por ${A(e.publicado?.nome||"Admin")} em ${A(formatDate(e.data_publicacao))} `),e.data_expiracao?l(`<span> • Expira em ${A(formatDate(e.data_expiracao))}</span>`):l("\x3c!----\x3e"),l('</p></div><div class="flex gap-2"><button class="p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg">'),l(_(L,{name:"heroicons:pencil",size:"18"},null,T)),l('</button><button class="p-2 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-lg">'),l(_(L,{name:"heroicons:trash",size:"18"},null,T)),l("</button></div></div></div>")}),l("\x3c!--]--\x3e</div>")),l("</div>"),l(_(M,{modelValue:p(B),"onUpdate:modelValue":e=>m(B)?B.value=e:null,title:p(D)?"Editar Comunicado":"Novo Comunicado",size:"lg"},{footer:s((e,o,t,a)=>{if(!o)return[u("div",{class:"flex gap-3"},[u("button",{onClick:e=>B.value=!1,class:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300"},"Cancelar",8,["onClick"]),u("button",{onClick:salvar,class:"px-4 py-2 bg-red-700 text-white font-medium rounded-lg hover:bg-red-800"},w(p(D)?"Salvar":"Publicar"),1)])];o(`<div class="flex gap-3"${a}><button class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300"${a}>Cancelar</button><button class="px-4 py-2 bg-red-700 text-white font-medium rounded-lg hover:bg-red-800"${a}>${A(p(D)?"Salvar":"Publicar")}</button></div>`)}),default:s((e,o,t,a)=>{if(!o)return[u("form",{onSubmit:v(salvar,["prevent"]),class:"space-y-4"},[u("div",null,[u("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Título *"),b(u("input",{"onUpdate:modelValue":e=>p(S).titulo=e,type:"text",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500"},null,8,["onUpdate:modelValue"]),[[y,p(S).titulo]])]),u("div",null,[u("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Conteúdo *"),b(u("textarea",{"onUpdate:modelValue":e=>p(S).conteudo=e,rows:"6",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 resize-none"},null,8,["onUpdate:modelValue"]),[[y,p(S).conteudo]])]),u("div",{class:"grid grid-cols-2 gap-4"},[u("div",null,[u("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Tipo"),b(u("select",{"onUpdate:modelValue":e=>p(S).tipo=e,class:"w-full px-3 py-2 border border-gray-300 rounded-lg"},[u("option",{value:"Informativo"},"Informativo"),u("option",{value:"Importante"},"Importante"),u("option",{value:"Urgente"},"Urgente"),u("option",{value:"Evento"},"Evento"),u("option",{value:"Beneficio"},"Benefício")],8,["onUpdate:modelValue"]),[[f,p(S).tipo]])]),u("div",null,[u("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Destino"),b(u("select",{"onUpdate:modelValue":e=>p(S).destino=e,class:"w-full px-3 py-2 border border-gray-300 rounded-lg"},[u("option",{value:"todos"},"Todos os funcionários"),u("option",{value:"departamento"},"Por departamento"),u("option",{value:"cargo"},"Por cargo")],8,["onUpdate:modelValue"]),[[f,p(S).destino]])])]),u("div",null,[u("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Data de Expiração (opcional)"),b(u("input",{"onUpdate:modelValue":e=>p(S).data_expiracao=e,type:"date",class:"w-full px-3 py-2 border border-gray-300 rounded-lg"},null,8,["onUpdate:modelValue"]),[[y,p(S).data_expiracao]])]),p(D)?($(),g("div",{key:0,class:"flex items-center gap-2"},[b(u("input",{type:"checkbox","onUpdate:modelValue":e=>p(S).ativo=e,id:"ativo",class:"rounded text-red-600"},null,8,["onUpdate:modelValue"]),[[h,p(S).ativo]]),u("label",{for:"ativo",class:"text-sm text-gray-700"},"Comunicado ativo")])):x("",!0)],32)];o(`<form class="space-y-4"${a}><div${a}><label class="block text-sm font-medium text-gray-700 mb-1"${a}>Título *</label><input${V("value",p(S).titulo)} type="text" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500"${a}></div><div${a}><label class="block text-sm font-medium text-gray-700 mb-1"${a}>Conteúdo *</label><textarea rows="6" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 resize-none"${a}>${A(p(S).conteudo)}</textarea></div><div class="grid grid-cols-2 gap-4"${a}><div${a}><label class="block text-sm font-medium text-gray-700 mb-1"${a}>Tipo</label><select class="w-full px-3 py-2 border border-gray-300 rounded-lg"${a}><option value="Informativo"${E(Array.isArray(p(S).tipo)?P(p(S).tipo,"Informativo"):z(p(S).tipo,"Informativo"))?" selected":""}${a}>Informativo</option><option value="Importante"${E(Array.isArray(p(S).tipo)?P(p(S).tipo,"Importante"):z(p(S).tipo,"Importante"))?" selected":""}${a}>Importante</option><option value="Urgente"${E(Array.isArray(p(S).tipo)?P(p(S).tipo,"Urgente"):z(p(S).tipo,"Urgente"))?" selected":""}${a}>Urgente</option><option value="Evento"${E(Array.isArray(p(S).tipo)?P(p(S).tipo,"Evento"):z(p(S).tipo,"Evento"))?" selected":""}${a}>Evento</option><option value="Beneficio"${E(Array.isArray(p(S).tipo)?P(p(S).tipo,"Beneficio"):z(p(S).tipo,"Beneficio"))?" selected":""}${a}>Benefício</option></select></div><div${a}><label class="block text-sm font-medium text-gray-700 mb-1"${a}>Destino</label><select class="w-full px-3 py-2 border border-gray-300 rounded-lg"${a}><option value="todos"${E(Array.isArray(p(S).destino)?P(p(S).destino,"todos"):z(p(S).destino,"todos"))?" selected":""}${a}>Todos os funcionários</option><option value="departamento"${E(Array.isArray(p(S).destino)?P(p(S).destino,"departamento"):z(p(S).destino,"departamento"))?" selected":""}${a}>Por departamento</option><option value="cargo"${E(Array.isArray(p(S).destino)?P(p(S).destino,"cargo"):z(p(S).destino,"cargo"))?" selected":""}${a}>Por cargo</option></select></div></div><div${a}><label class="block text-sm font-medium text-gray-700 mb-1"${a}>Data de Expiração (opcional)</label><input${V("value",p(S).data_expiracao)} type="date" class="w-full px-3 py-2 border border-gray-300 rounded-lg"${a}></div>`),p(D)?o(`<div class="flex items-center gap-2"${a}><input type="checkbox"${E(Array.isArray(p(S).ativo)?P(p(S).ativo,null):p(S).ativo)?" checked":""} id="ativo" class="rounded text-red-600"${a}><label for="ativo" class="text-sm text-gray-700"${a}>Comunicado ativo</label></div>`):o("\x3c!----\x3e"),o("</form>")}),_:1},T)),l("</div>")}}}),B=j.setup;j.setup=(e,o)=>{const t=C();return(t.modules||(t.modules=new Set)).add("pages/admin/comunicados.vue"),B?B(e,o):void 0};export{j as default};
