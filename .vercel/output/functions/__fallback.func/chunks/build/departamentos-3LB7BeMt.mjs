import{_ as e,b as t}from"./server.mjs";import{_ as a}from"./UserProfileDropdown-D7V90wtd.mjs";import{_ as s}from"./UIInput-CnioD5-Q.mjs";import{_ as r}from"./UISelect-C9tnEbh5.mjs";import{_ as o}from"./UIButton-BfdUCxqX.mjs";import{defineComponent as i,ref as l,computed as n,resolveComponent as d,mergeProps as c,withCtx as u,createVNode as m,unref as v,createTextVNode as p,createBlock as g,openBlock as f,Fragment as x,renderList as h,toDisplayString as b,useSSRContext as y}from"vue";import{ssrRenderAttrs as w,ssrRenderComponent as _,ssrInterpolate as C,ssrRenderList as D,ssrRenderClass as $,ssrRenderAttr as j}from"vue/server-renderer";import"../_/nitro.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"../routes/renderer.mjs";import"vue-bundle-renderer/runtime";import"unhead/server";import"devalue";import"pinia";import"vue-router";import"@supabase/ssr";const useDepartamentos=()=>{const e=t(),a=l([]),s=l(!1),r=l(null),fetchDepartamentos=async()=>{s.value=!0,r.value=null;try{const{data:t,error:s}=await e.from("departamentos").select("*").order("nome",{ascending:!0});if(s)throw s;return a.value=t,{success:!0,data:t}}catch(e){return r.value=e.message,{success:!1,error:e.message}}finally{s.value=!1}},updateDepartamento=async(t,a)=>{s.value=!0,r.value=null;try{const s={...a,updated_at:(new Date).toISOString()},{data:r,error:o}=await e.from("departamentos").update(s).eq("id",t).select().single();if(o)throw o;return await fetchDepartamentos(),{success:!0,data:r}}catch(e){return r.value=e.message,{success:!1,error:e.message}}finally{s.value=!1}},toggleDepartamentoStatus=async(e,t)=>await updateDepartamento(e,{ativo:t}),o=n(()=>({ativo:a.value.filter(e=>e.ativo).length,inativo:a.value.filter(e=>!e.ativo).length,total:a.value.length}));return{departamentos:a,loading:s,error:r,countByStatus:o,fetchDepartamentos:fetchDepartamentos,fetchDepartamentoById:async t=>{s.value=!0,r.value=null;try{const{data:a,error:s}=await e.from("departamentos").select("*").eq("id",t).single();if(s)throw s;return{success:!0,data:a}}catch(e){return r.value=e.message,{success:!1,error:e.message}}finally{s.value=!1}},createDepartamento:async t=>{s.value=!0,r.value=null;try{let a=await(async()=>{try{const{data:t}=await e.from("empresas").select("id").limit(1).single();return t?.id||null}catch{return null}})();const s={empresa_id:a,nome:t.nome,ativo:!0};t.descricao&&(s.descricao=t.descricao),t.centro_custo&&(s.centro_custo=t.centro_custo),t.gestor_id&&(s.gestor_id=t.gestor_id);const{data:r,error:o}=await e.from("departamentos").insert(s).select().single();if(o)throw o;return await fetchDepartamentos(),{success:!0,data:r}}catch(e){return r.value=e.message,{success:!1,error:e.message}}finally{s.value=!1}},updateDepartamento:updateDepartamento,toggleDepartamentoStatus:toggleDepartamentoStatus,deleteDepartamento:async e=>await toggleDepartamentoStatus(e,!1),fetchColaboradoresParaGestor:async()=>{try{const{data:t,error:a}=await e.from("colaboradores").select("id, nome, cargo_id").eq("status","Ativo").order("nome",{ascending:!0});if(a)throw a;return{success:!0,data:t}}catch(e){return{success:!1,error:e.message}}},filterDepartamentos:e=>{let t=[...a.value];if(e.search){const a=e.search.toLowerCase();t=t.filter(e=>e.nome.toLowerCase().includes(a)||e.descricao?.toLowerCase().includes(a)||e.centro_custo?.toLowerCase().includes(a))}if(e.status&&"all"!==e.status){const a="ativo"===e.status;t=t.filter(e=>e.ativo===a)}return t}}},S=i({__name:"departamentos",__ssrInlineRender:!0,setup(t){const{loading:i,countByStatus:y,filterDepartamentos:S}=useDepartamentos(),z=l({search:"",status:"all"}),I=l(!1),k=l(!1),V=l(null),U=l(!1),N=l({nome:"",descricao:"",centro_custo:"",gestor_id:""}),A=l([]),B=n(()=>S(z.value)),openCreateModal=()=>{k.value=!1,V.value=null,N.value={nome:"",descricao:"",centro_custo:"",gestor_id:""},I.value=!0},closeModal=()=>{I.value=!1,N.value={nome:"",descricao:"",centro_custo:"",gestor_id:""}};return(t,l,n,S)=>{const V=e,q=d("Icon"),E=a,L=s,G=r,T=o;l(`<div${w(c({class:"min-h-screen bg-gray-50"},S))}><header class="bg-white border-b border-gray-200 sticky top-0 z-40"><div class="max-w-7xl mx-auto px-8 py-4"><div class="flex items-center justify-between"><div class="flex items-center gap-4">`),l(_(V,{to:"/admin",class:"w-10 h-10 bg-red-700 rounded-lg flex items-center justify-center hover:bg-red-800 transition-colors"},{default:u((e,t,a,s)=>{if(!t)return[m(q,{name:"heroicons:arrow-left",class:"text-white",size:"20"})];t(_(q,{name:"heroicons:arrow-left",class:"text-white",size:"20"},null,a,s))}),_:1},n)),l('<div><h1 class="text-xl font-bold text-gray-800">Gestão de Departamentos</h1><p class="text-sm text-gray-500">Organizar setores e áreas da empresa</p></div></div>'),l(_(E,{theme:"admin"},null,n)),l('</div></div></header><div class="max-w-7xl mx-auto p-8"><div class="grid md:grid-cols-3 gap-6 mb-8"><div class="card bg-red-50 border-2 border-red-200"><div class="flex items-center gap-4"><div class="w-12 h-12 bg-red-700 rounded-lg flex items-center justify-center">'),l(_(q,{name:"heroicons:building-office",class:"text-white",size:"24"},null,n)),l(`</div><div><p class="text-sm text-gray-600">Total</p><p class="text-2xl font-bold text-gray-800">${C(v(y).total)}</p></div></div></div><div class="card"><div class="flex items-center gap-4"><div class="w-12 h-12 bg-green-600 rounded-lg flex items-center justify-center">`),l(_(q,{name:"heroicons:check-circle",class:"text-white",size:"24"},null,n)),l(`</div><div><p class="text-sm text-gray-600">Ativos</p><p class="text-2xl font-bold text-gray-800">${C(v(y).ativo)}</p></div></div></div><div class="card"><div class="flex items-center gap-4"><div class="w-12 h-12 bg-gray-600 rounded-lg flex items-center justify-center">`),l(_(q,{name:"heroicons:x-circle",class:"text-white",size:"24"},null,n)),l(`</div><div><p class="text-sm text-gray-600">Inativos</p><p class="text-2xl font-bold text-gray-800">${C(v(y).inativo)}</p></div></div></div></div><div class="card mb-8"><div class="flex flex-col md:flex-row gap-4 items-start md:items-center justify-between"><div class="flex flex-col md:flex-row gap-4 flex-1"><div class="flex-1">`),l(_(L,{modelValue:v(z).search,"onUpdate:modelValue":e=>v(z).search=e,type:"text",placeholder:"Buscar por nome, descrição...","icon-left":"heroicons:magnifying-glass"},null,n)),l("</div>"),l(_(G,{modelValue:v(z).status,"onUpdate:modelValue":e=>v(z).status=e,class:"w-full md:w-40"},{default:u((e,t,a,s)=>{if(!t)return[m("option",{value:"all"},"Todos Status"),m("option",{value:"ativo"},"Ativos"),m("option",{value:"inativo"},"Inativos")];t(`<option value="all"${s}>Todos Status</option><option value="ativo"${s}>Ativos</option><option value="inativo"${s}>Inativos</option>`)}),_:1},n)),l("</div>"),l(_(T,{theme:"admin",variant:"primary","icon-left":"heroicons:plus",onClick:openCreateModal},{default:u((e,t,a,s)=>{if(!t)return[p(" Novo Departamento ")];t(" Novo Departamento ")}),_:1},n)),l("</div></div>"),v(i)?(l('<div class="card text-center py-12">'),l(_(q,{name:"heroicons:arrow-path",class:"animate-spin text-gray-400 mx-auto mb-4",size:"48"},null,n)),l('<p class="text-gray-600">Carregando departamentos...</p></div>')):v(B).length>0?(l('<div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">\x3c!--[--\x3e'),D(v(B),e=>{l('<div class="card hover:shadow-lg transition-shadow"><div class="flex items-start justify-between mb-4"><div class="flex items-center gap-3"><div class="w-12 h-12 bg-blue-600 rounded-lg flex items-center justify-center">'),l(_(q,{name:"heroicons:building-office",class:"text-white",size:"24"},null,n)),l(`</div><div><h3 class="font-bold text-gray-800">${C(e.nome)}</h3>`),e.centro_custo?l(`<p class="text-xs text-gray-500">CC: ${C(e.centro_custo)}</p>`):l("\x3c!----\x3e"),l(`</div></div><span class="${$([e.ativo?"badge-success":"badge-warning","badge"])}">${C(e.ativo?"Ativo":"Inativo")}</span></div>`),e.descricao?l(`<p class="text-sm text-gray-600 mb-4 line-clamp-2">${C(e.descricao)}</p>`):l('<p class="text-sm text-gray-400 italic mb-4">Sem descrição</p>'),l('<div class="flex items-center justify-between pt-4 border-t border-gray-200"><div class="flex gap-2"><button class="p-2 text-gray-500 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors" title="Editar">'),l(_(q,{name:"heroicons:pencil",size:"18"},null,n)),l(`</button><button class="${$([e.ativo?"text-gray-500 hover:text-orange-600 hover:bg-orange-50":"text-gray-500 hover:text-green-600 hover:bg-green-50","p-2 rounded-lg transition-colors"])}"${j("title",e.ativo?"Desativar":"Ativar")}>`),l(_(q,{name:e.ativo?"heroicons:pause":"heroicons:play",size:"18"},null,n)),l("</button></div></div></div>")}),l("\x3c!--]--\x3e</div>")):(l('<div class="card text-center py-12">'),l(_(q,{name:"heroicons:building-office",class:"text-gray-300 mx-auto mb-4",size:"64"},null,n)),l('<h3 class="text-lg font-semibold text-gray-800 mb-2">Nenhum departamento encontrado</h3><p class="text-gray-600 mb-6">Ajuste os filtros ou crie um novo departamento</p>'),l(_(T,{theme:"admin",variant:"primary","icon-left":"heroicons:plus",onClick:openCreateModal},{default:u((e,t,a,s)=>{if(!t)return[p(" Novo Departamento ")];t(" Novo Departamento ")}),_:1},n)),l("</div>")),l("</div>"),v(I)?(l(`<div class="fixed inset-0 z-50 flex items-center justify-center"><div class="absolute inset-0 bg-black/50"></div><div class="relative bg-white rounded-xl shadow-xl w-full max-w-md mx-4 p-6"><h3 class="text-xl font-bold text-gray-800 mb-6">${C(v(k)?"Editar Departamento":"Novo Departamento")}</h3><form><div class="mb-4"><label class="block text-sm font-medium text-gray-700 mb-2">Nome *</label>`),l(_(L,{modelValue:v(N).nome,"onUpdate:modelValue":e=>v(N).nome=e,type:"text",placeholder:"Ex: Recursos Humanos",required:""},null,n)),l('</div><div class="mb-4"><label class="block text-sm font-medium text-gray-700 mb-2">Centro de Custo</label>'),l(_(L,{modelValue:v(N).centro_custo,"onUpdate:modelValue":e=>v(N).centro_custo=e,type:"text",placeholder:"Ex: CC-001"},null,n)),l('</div><div class="mb-4"><label class="block text-sm font-medium text-gray-700 mb-2">Gestor</label>'),l(_(G,{modelValue:v(N).gestor_id,"onUpdate:modelValue":e=>v(N).gestor_id=e},{default:u((e,t,a,s)=>{if(!t)return[m("option",{value:""},"Nenhum gestor"),(f(!0),g(x,null,h(v(A),e=>(f(),g("option",{key:e.id,value:e.id},b(e.nome),9,["value"]))),128))];t(`<option value=""${s}>Nenhum gestor</option>\x3c!--[--\x3e`),D(v(A),e=>{t(`<option${j("value",e.id)}${s}>${C(e.nome)}</option>`)}),t("\x3c!--]--\x3e")}),_:1},n)),l(`</div><div class="mb-6"><label class="block text-sm font-medium text-gray-700 mb-2">Descrição</label><textarea rows="3" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500" placeholder="Descrição do departamento...">${C(v(N).descricao)}</textarea></div><div class="flex gap-3">`),l(_(T,{type:"button",theme:"admin",variant:"secondary","full-width":"",onClick:closeModal},{default:u((e,t,a,s)=>{if(!t)return[p(" Cancelar ")];t(" Cancelar ")}),_:1},n)),l(_(T,{type:"submit",theme:"admin",variant:"primary","full-width":"",disabled:v(U)},{default:u((e,t,a,s)=>{if(!t)return[p(b(v(U)?"Salvando...":v(k)?"Salvar":"Criar"),1)];t(`${C(v(U)?"Salvando...":v(k)?"Salvar":"Criar")}`)}),_:1},n)),l("</div></form></div></div>")):l("\x3c!----\x3e"),l("</div>")}}}),z=S.setup;S.setup=(e,t)=>{const a=y();return(a.modules||(a.modules=new Set)).add("pages/departamentos.vue"),z?z(e,t):void 0};export{S as default};
