import{_ as e}from"./server.mjs";import{_ as t}from"./UIButton-BfdUCxqX.mjs";import{_ as a}from"./UserProfileDropdown-D7V90wtd.mjs";import{defineComponent as s,ref as r,resolveComponent as o,mergeProps as l,withCtx as d,createVNode as i,createTextVNode as n,unref as c,isRef as u,createBlock as p,createCommentVNode as x,openBlock as m,withDirectives as b,Fragment as v,renderList as g,toDisplayString as y,vModelSelect as f,vModelText as $,useSSRContext as h}from"vue";import{ssrRenderAttrs as w,ssrRenderComponent as _,ssrInterpolate as A,ssrRenderList as j,ssrRenderAttr as k,ssrIncludeBooleanAttr as C,ssrLooseContain as z,ssrLooseEqual as E,ssrRenderClass as S}from"vue/server-renderer";import{_ as I}from"./UIModal-PwEumyFL.mjs";import{u as N,f as U,r as V,c as F}from"./usePontoTempoReal-Y35tVY8b.mjs";import"../_/nitro.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"../routes/renderer.mjs";import"vue-bundle-renderer/runtime";import"unhead/server";import"devalue";import"pinia";import"vue-router";import"@supabase/ssr";const T=s({__name:"PontoActionButtons",__ssrInlineRender:!0,props:{registro:{},disabled:{type:Boolean,default:!1},editTooltip:{default:"Editar registro"},deleteTooltip:{default:"Excluir registro"},showExtraAction:{type:Boolean,default:!1},extraActionIcon:{default:"heroicons:eye"},extraActionTooltip:{default:"Ação adicional"}},emits:["edit","delete","extraAction"],setup:e=>(t,a,s,r)=>{const d=o("Icon");a(`<div${w(l({class:"flex items-center justify-center gap-1"},r))}><button${k("title",e.editTooltip)}${C(e.disabled)?" disabled":""} class="${S([{"opacity-50 cursor-not-allowed":e.disabled},"p-1.5 text-gray-500 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors"])}">`),a(_(d,{name:"heroicons:pencil-square",size:"18"},null,s)),a(`</button><button${k("title",e.deleteTooltip)}${C(e.disabled)?" disabled":""} class="${S([{"opacity-50 cursor-not-allowed":e.disabled},"p-1.5 text-gray-500 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors"])}">`),a(_(d,{name:"heroicons:trash",size:"18"},null,s)),a("</button>"),e.showExtraAction?(a(`<button${k("title",e.extraActionTooltip)}${C(e.disabled)?" disabled":""} class="${S([{"opacity-50 cursor-not-allowed":e.disabled},"p-1.5 text-gray-500 hover:text-purple-600 hover:bg-purple-50 rounded-lg transition-colors"])}">`),a(_(d,{name:e.extraActionIcon,size:"18"},null,s)),a("</button>")):a("\x3c!----\x3e"),a("</div>")}}),D=T.setup;T.setup=(e,t)=>{const a=h();return(a.modules||(a.modules=new Set)).add("components/PontoActionButtons.vue"),D?D(e,t):void 0};const P=Object.assign(T,{__name:"PontoActionButtons"}),R=s({__name:"ponto",__ssrInlineRender:!0,setup(s){const h=["Janeiro","Fevereiro","Marco","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],T=["Domingo","Segunda","Terca","Quarta","Quinta","Sexta","Sabado"],D=(new Date).getFullYear(),R=[D-1,D,D+1],H=r(!1),M=r(!1),B=r(!1),O=r(!1),q=r(!1),L=r(""),J=r([]),Z=r([]),Y=r([]),G=r(null),Q=r({totalHoje:0,totalMes:0,pendentes:0,faltas:0}),X=r({mes:(new Date).getMonth()+1,ano:D,colaboradorId:"",status:""}),K=r({colaborador_id:"",data:(new Date).toISOString().split("T")[0],entrada_1:"",saida_1:"",entrada_2:"",saida_2:"",status:"Normal",justificativa:""}),W=r(null),{calcularHoras:ee}=N(J),abrirModalAssinaturas=async()=>{await buscarAssinaturas(),O.value=!0},buscarAssinaturas=async()=>{try{Y.value=await $fetch("/api/admin/assinaturas-ponto")}catch(e){console.error("Erro ao buscar assinaturas:",e)}},buscarRegistros=async()=>{H.value=!0;try{const e=new URLSearchParams({mes:X.value.mes.toString(),ano:X.value.ano.toString()});X.value.colaboradorId&&e.append("colaborador_id",X.value.colaboradorId),X.value.status&&e.append("status",X.value.status),J.value=await $fetch(`/api/ponto?${e}`)}catch(e){console.error("Erro:",e)}finally{H.value=!1}},buscarStats=async()=>{try{Q.value=await $fetch("/api/ponto/stats")}catch(e){console.error("Erro:",e)}},abrirModalNovo=()=>{q.value=!1,G.value=null,K.value={colaborador_id:"",data:(new Date).toISOString().split("T")[0],entrada_1:"",saida_1:"",entrada_2:"",saida_2:"",status:"Normal",justificativa:""},W.value=null,B.value=!0},editarRegistro=e=>{q.value=!0,G.value=e,K.value={colaborador_id:e.colaborador_id,data:e.data,entrada_1:e.entrada_1||"",saida_1:e.saida_1||"",entrada_2:e.entrada_2||"",saida_2:e.saida_2||"",status:e.status||"Normal",justificativa:e.justificativa||""},validarFormulario(),B.value=!0},validarFormulario=()=>{W.value=F(K.value)},salvarRegistro=async()=>{M.value=!0;try{q.value&&G.value?await $fetch(`/api/ponto/${G.value.id}`,{method:"PUT",body:K.value}):await $fetch("/api/ponto",{method:"POST",body:K.value}),B.value=!1,await buscarRegistros(),await buscarStats()}catch(e){alert(e.data?.message||e.message||"Erro ao salvar")}finally{M.value=!1}},excluirRegistro=async e=>{if(confirm(`Excluir registro de ${e.colaborador?.nome}?`))try{await $fetch(`/api/ponto/${e.id}`,{method:"DELETE"});const t=J.value.findIndex(t=>t.id===e.id);t>-1&&J.value.splice(t,1),await Promise.all([buscarRegistros(),buscarStats()]),alert("Registro excluído com sucesso!")}catch(e){console.error("Erro ao excluir registro:",e),alert(e.data?.message||e.message||"Erro ao excluir registro"),await buscarRegistros()}},exportarRelatorio=()=>{const e=J.value.map(e=>[e.colaborador?.nome||"",formatarData(e.data),e.entrada_1||"",e.saida_1||"",e.entrada_2||"",e.saida_2||"",calcularHorasFormatado(e),e.status||"Normal"]),t=[["Colaborador","Data","Entrada","Saida Int.","Retorno","Saida","Horas","Status"].join(";"),...e.map(e=>e.join(";"))].join("\n"),a=new Blob(["\ufeff"+t],{type:"text/csv;charset=utf-8;"}),s=(void 0).createElement("a");s.href=URL.createObjectURL(a),s.download=`ponto_${h[X.value.mes-1]}_${X.value.ano}.csv`,s.click()},calcularHoras=e=>ee(e).totalMinutos/60,calcularHorasFormatado=e=>ee(e).horasFormatadas,obterAvisos=e=>ee(e).avisos,estaEmAndamento=e=>V(e),formatarData=e=>e?new Date(e+"T00:00:00").toLocaleDateString("pt-BR"):"-";return(s,r,N,V)=>{const F=e,D=o("Icon"),te=t,ae=a,se=P,re=I;r(`<div${w(l({class:"min-h-screen bg-gray-50"},V))}><header class="bg-white border-b border-gray-200 sticky top-0 z-40"><div class="max-w-7xl mx-auto px-8 py-4"><div class="flex items-center justify-between"><div class="flex items-center gap-4">`),r(_(F,{to:"/admin",class:"w-10 h-10 bg-red-700 rounded-lg flex items-center justify-center hover:bg-red-800 transition-colors"},{default:d((e,t,a,s)=>{if(!t)return[i(D,{name:"heroicons:arrow-left",class:"text-white",size:"20"})];t(_(D,{name:"heroicons:arrow-left",class:"text-white",size:"20"},null,a,s))}),_:1},N)),r('<div><h1 class="text-xl font-bold text-gray-800">Ponto Eletronico</h1><p class="text-sm text-gray-500">Gestao de registros de ponto</p></div></div><div class="flex items-center gap-3">'),r(_(te,{variant:"outline","icon-left":"heroicons:arrow-down-tray",size:"sm",onClick:exportarRelatorio},{default:d((e,t,a,s)=>{if(!t)return[n("Exportar")];t("Exportar")}),_:1},N)),r(_(te,{variant:"outline","icon-left":"heroicons:document-text",size:"sm",onClick:abrirModalAssinaturas},{default:d((e,t,a,s)=>{if(!t)return[n("Assinaturas")];t("Assinaturas")}),_:1},N)),r(_(te,{"icon-left":"heroicons:plus",size:"sm",onClick:abrirModalNovo},{default:d((e,t,a,s)=>{if(!t)return[n("Novo Registro")];t("Novo Registro")}),_:1},N)),r(_(ae,{theme:"admin"},null,N)),r('</div></div></div></header><div class="max-w-7xl mx-auto p-8"><div class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-6"><div class="bg-white rounded-xl p-4 border border-gray-200 shadow-sm"><div class="flex items-center gap-3"><div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">'),r(_(D,{name:"heroicons:users",class:"text-blue-600",size:"20"},null,N)),r(`</div><div><p class="text-xs text-gray-500">Registros Hoje</p><p class="text-xl font-bold text-gray-800">${A(c(Q).totalHoje)}</p></div></div></div><div class="bg-white rounded-xl p-4 border border-gray-200 shadow-sm"><div class="flex items-center gap-3"><div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center">`),r(_(D,{name:"heroicons:calendar",class:"text-green-600",size:"20"},null,N)),r(`</div><div><p class="text-xs text-gray-500">Total do Mes</p><p class="text-xl font-bold text-gray-800">${A(c(Q).totalMes)}</p></div></div></div><div class="bg-white rounded-xl p-4 border border-gray-200 shadow-sm"><div class="flex items-center gap-3"><div class="w-10 h-10 bg-amber-100 rounded-lg flex items-center justify-center">`),r(_(D,{name:"heroicons:exclamation-triangle",class:"text-amber-600",size:"20"},null,N)),r(`</div><div><p class="text-xs text-gray-500">Pendentes</p><p class="text-xl font-bold text-gray-800">${A(c(Q).pendentes)}</p></div></div></div><div class="bg-white rounded-xl p-4 border border-gray-200 shadow-sm"><div class="flex items-center gap-3"><div class="w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center">`),r(_(D,{name:"heroicons:x-circle",class:"text-red-600",size:"20"},null,N)),r(`</div><div><p class="text-xs text-gray-500">Faltas</p><p class="text-xl font-bold text-gray-800">${A(c(Q).faltas||0)}</p></div></div></div><div class="bg-white rounded-xl p-4 border border-gray-200 shadow-sm"><div class="flex items-center gap-3"><div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center">`),r(_(D,{name:"heroicons:clock",class:"text-purple-600",size:"20"},null,N)),r(`</div><div><p class="text-xs text-gray-500">Hora Atual</p><p class="text-xl font-bold text-gray-800 font-mono">${A(c(L))}</p></div></div></div></div><div class="bg-white rounded-xl border border-gray-200 shadow-sm p-4 mb-6"><div class="flex flex-wrap items-center gap-4"><div class="flex items-center gap-2"><label class="text-sm text-gray-600">Mes:</label><select class="border border-gray-300 rounded-lg px-3 py-2 text-sm">\x3c!--[--\x3e`),j(12,e=>{r(`<option${k("value",e)}${C(Array.isArray(c(X).mes)?z(c(X).mes,e):E(c(X).mes,e))?" selected":""}>${A(h[e-1])}</option>`)}),r('\x3c!--]--\x3e</select></div><div class="flex items-center gap-2"><label class="text-sm text-gray-600">Ano:</label><select class="border border-gray-300 rounded-lg px-3 py-2 text-sm">\x3c!--[--\x3e'),j(R,e=>{r(`<option${k("value",e)}${C(Array.isArray(c(X).ano)?z(c(X).ano,e):E(c(X).ano,e))?" selected":""}>${A(e)}</option>`)}),r(`\x3c!--]--\x3e</select></div><div class="flex items-center gap-2"><label class="text-sm text-gray-600">Colaborador:</label><select class="border border-gray-300 rounded-lg px-3 py-2 text-sm min-w-[200px]"><option value=""${C(Array.isArray(c(X).colaboradorId)?z(c(X).colaboradorId,""):E(c(X).colaboradorId,""))?" selected":""}>Todos</option>\x3c!--[--\x3e`),j(c(Z),e=>{r(`<option${k("value",e.id)}${C(Array.isArray(c(X).colaboradorId)?z(c(X).colaboradorId,e.id):E(c(X).colaboradorId,e.id))?" selected":""}>${A(e.nome)}</option>`)}),r(`\x3c!--]--\x3e</select></div><div class="flex items-center gap-2"><label class="text-sm text-gray-600">Status:</label><select class="border border-gray-300 rounded-lg px-3 py-2 text-sm"><option value=""${C(Array.isArray(c(X).status)?z(c(X).status,""):E(c(X).status,""))?" selected":""}>Todos</option><option value="Normal"${C(Array.isArray(c(X).status)?z(c(X).status,"Normal"):E(c(X).status,"Normal"))?" selected":""}>Normal</option><option value="Falta"${C(Array.isArray(c(X).status)?z(c(X).status,"Falta"):E(c(X).status,"Falta"))?" selected":""}>Falta</option><option value="Atestado"${C(Array.isArray(c(X).status)?z(c(X).status,"Atestado"):E(c(X).status,"Atestado"))?" selected":""}>Atestado</option></select></div></div></div><div class="bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden"><div class="overflow-x-auto"><table class="w-full"><thead class="bg-gray-50 border-b border-gray-200"><tr><th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Colaborador</th><th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Data</th><th class="px-4 py-3 text-center text-xs font-semibold text-gray-600 uppercase">Entrada</th><th class="px-4 py-3 text-center text-xs font-semibold text-gray-600 uppercase">Intervalo Entrada</th><th class="px-4 py-3 text-center text-xs font-semibold text-gray-600 uppercase">Intervalo Saida</th><th class="px-4 py-3 text-center text-xs font-semibold text-gray-600 uppercase">Saida</th><th class="px-4 py-3 text-center text-xs font-semibold text-gray-600 uppercase">Horas</th><th class="px-4 py-3 text-center text-xs font-semibold text-gray-600 uppercase">Status</th><th class="px-4 py-3 text-center text-xs font-semibold text-gray-600 uppercase">Acoes</th></tr></thead><tbody class="divide-y divide-gray-100">`),c(H)?(r('<tr class="text-center"><td colspan="9" class="px-4 py-12">'),r(_(D,{name:"heroicons:arrow-path",class:"animate-spin text-gray-400 mx-auto",size:"32"},null,N)),r('<p class="text-gray-500 mt-2">Carregando...</p></td></tr>')):0===c(J).length?(r('<tr class="text-center"><td colspan="9" class="px-4 py-12">'),r(_(D,{name:"heroicons:clock",class:"text-gray-300 mx-auto",size:"48"},null,N)),r('<p class="text-gray-500 mt-2">Nenhum registro encontrado</p></td></tr>')):r("\x3c!----\x3e"),r("\x3c!--[--\x3e"),j(c(J),e=>{var t,a;r('<tr class="hover:bg-gray-50"><td class="px-4 py-3"><div class="flex items-center gap-3"><div class="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center">'),r(_(D,{name:"heroicons:user",class:"text-gray-500",size:"16"},null,N)),r(`</div><div><p class="text-sm font-medium text-gray-800">${A(e.colaborador?.nome||"N/A")}</p><p class="text-xs text-gray-500">${A(e.colaborador?.departamento?.nome||"")}</p></div></div></td><td class="px-4 py-3"><p class="text-sm text-gray-800">${A(formatarData(e.data))}</p><p class="text-xs text-gray-500">${A((t=e.data,t?T[new Date(t+"T00:00:00").getDay()]:""))}</p></td><td class="${S([e.entrada_1?"text-green-600 font-medium":"text-gray-300","px-4 py-3 text-center text-sm font-mono"])}">${A(c(U)(e.entrada_1))}</td><td class="${S([e.saida_1?"text-amber-600":"text-gray-300","px-4 py-3 text-center text-sm font-mono"])}">${A(c(U)(e.saida_1))}</td><td class="${S([e.entrada_2?"text-blue-600":"text-gray-300","px-4 py-3 text-center text-sm font-mono"])}">${A(c(U)(e.entrada_2))}</td><td class="${S([e.saida_2?"text-red-600 font-medium":"text-gray-300","px-4 py-3 text-center text-sm font-mono"])}">${A(c(U)(e.saida_2))}</td><td class="px-4 py-3 text-center"><div class="flex flex-col items-center gap-1"><span class="${S([{"text-green-600 animate-pulse":estaEmAndamento(e),"text-green-600":!estaEmAndamento(e)&&calcularHoras(e)>=8,"text-gray-600":!estaEmAndamento(e)&&calcularHoras(e)<8},"text-sm font-mono font-medium"])}">${A(calcularHorasFormatado(e))}</span>`),obterAvisos(e).length>0?(r('<div class="flex flex-wrap gap-1 justify-center max-w-[200px]">\x3c!--[--\x3e'),j(obterAvisos(e),(t,a)=>{r(`<span class="${S([{"bg-green-100 text-green-700":t.includes("⏱️"),"bg-amber-100 text-amber-700":t.includes("⚠️"),"bg-blue-100 text-blue-700":t.includes("ℹ️"),"bg-red-100 text-red-700":t.includes("❌")},"text-xs px-2 py-0.5 rounded-full cursor-help"])}"${k("title",(e=>ee(e).detalhes)(e))}>${A(t)}</span>`)}),r("\x3c!--]--\x3e</div>")):r("\x3c!----\x3e"),r(`</div></td><td class="px-4 py-3 text-center"><span class="${S([(a=e.status,{Normal:"bg-green-100 text-green-700",Falta:"bg-red-100 text-red-700",Atestado:"bg-blue-100 text-blue-700",Ferias:"bg-amber-100 text-amber-700",Folga:"bg-purple-100 text-purple-700",Ajustado:"bg-gray-100 text-gray-700"}[a]||"bg-gray-100 text-gray-700"),"px-2 py-1 text-xs font-medium rounded-full"])}">${A(e.status||"Normal")}</span></td><td class="px-4 py-3 text-center">`),r(_(se,{registro:e,onEdit:editarRegistro,onDelete:excluirRegistro},null,N)),r("</td></tr>")}),r("\x3c!--]--\x3e</tbody></table></div>"),c(J).length>0?r(`<div class="p-4 border-t border-gray-100 flex items-center justify-between text-sm text-gray-600"><span>${A(c(J).length)} registro(s)</span><span>Total: <strong>${A((()=>{let e=0;return J.value.forEach(t=>{const a=ee(t);e+=a.totalMinutos}),`${Math.floor(e/60)}h ${e%60}min`})())}</strong></span></div>`):r("\x3c!----\x3e"),r("</div></div>"),r(_(re,{modelValue:c(B),"onUpdate:modelValue":e=>u(B)?B.value=e:null,title:c(q)?"Editar Registro":"Novo Registro",size:"md"},{footer:d((e,t,a,s)=>{if(!t)return[i("div",{class:"flex justify-end gap-3"},[i(te,{variant:"outline",onClick:e=>B.value=!1},{default:d(()=>[n("Cancelar")]),_:1},8,["onClick"]),i(te,{onClick:salvarRegistro,loading:c(M)},{default:d(()=>[n(y(c(q)?"Salvar":"Criar"),1)]),_:1},8,["loading"])])];t(`<div class="flex justify-end gap-3"${s}>`),t(_(te,{variant:"outline",onClick:e=>B.value=!1},{default:d((e,t,a,s)=>{if(!t)return[n("Cancelar")];t("Cancelar")}),_:1},a,s)),t(_(te,{onClick:salvarRegistro,loading:c(M)},{default:d((e,t,a,s)=>{if(!t)return[n(y(c(q)?"Salvar":"Criar"),1)];t(`${A(c(q)?"Salvar":"Criar")}`)}),_:1},a,s)),t("</div>")}),default:d((e,t,a,s)=>{if(!t)return[i("div",{class:"space-y-4"},[c(q)?(m(),p("div",{key:1,class:"bg-gray-50 rounded-lg p-4"},[i("p",{class:"font-medium text-gray-800"},y(c(G)?.colaborador?.nome),1),i("p",{class:"text-sm text-gray-500"},y(formatarData(c(G)?.data)),1)])):(m(),p("div",{key:0},[i("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Colaborador *"),b(i("select",{"onUpdate:modelValue":e=>c(K).colaborador_id=e,class:"w-full border border-gray-300 rounded-lg px-3 py-2"},[i("option",{value:""},"Selecione..."),(m(!0),p(v,null,g(c(Z),e=>(m(),p("option",{key:e.id,value:e.id},y(e.nome),9,["value"]))),128))],8,["onUpdate:modelValue"]),[[f,c(K).colaborador_id]])])),c(q)?x("",!0):(m(),p("div",{key:2},[i("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Data *"),b(i("input",{type:"date","onUpdate:modelValue":e=>c(K).data=e,class:"w-full border border-gray-300 rounded-lg px-3 py-2"},null,8,["onUpdate:modelValue"]),[[$,c(K).data]])])),i("div",{class:"grid grid-cols-2 gap-4"},[i("div",null,[i("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Entrada"),b(i("input",{type:"time","onUpdate:modelValue":e=>c(K).entrada_1=e,onChange:validarFormulario,class:"w-full border border-gray-300 rounded-lg px-3 py-2"},null,40,["onUpdate:modelValue"]),[[$,c(K).entrada_1]])]),i("div",null,[i("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Saida Int."),b(i("input",{type:"time","onUpdate:modelValue":e=>c(K).saida_1=e,onChange:validarFormulario,class:"w-full border border-gray-300 rounded-lg px-3 py-2"},null,40,["onUpdate:modelValue"]),[[$,c(K).saida_1]]),i("p",{class:"text-xs text-gray-500 mt-1"},"Horário de saída para intervalo")]),i("div",null,[i("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Retorno"),b(i("input",{type:"time","onUpdate:modelValue":e=>c(K).entrada_2=e,onChange:validarFormulario,class:"w-full border border-gray-300 rounded-lg px-3 py-2"},null,40,["onUpdate:modelValue"]),[[$,c(K).entrada_2]]),i("p",{class:"text-xs text-gray-500 mt-1"},"Horário de retorno do intervalo")]),i("div",null,[i("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Saida"),b(i("input",{type:"time","onUpdate:modelValue":e=>c(K).saida_2=e,onChange:validarFormulario,class:"w-full border border-gray-300 rounded-lg px-3 py-2"},null,40,["onUpdate:modelValue"]),[[$,c(K).saida_2]])])]),c(W)?(m(),p("div",{key:3,class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},[i("div",{class:"flex items-start gap-2"},[i(D,{name:"heroicons:information-circle",class:"text-blue-600 mt-0.5",size:"20"}),i("div",{class:"flex-1"},[i("p",{class:"text-sm font-medium text-blue-900 mb-2"},"Preview do Cálculo:"),i("p",{class:"text-sm text-blue-800 font-mono mb-1"},[i("strong",null,"Horas Trabalhadas:"),n(" "+y(c(W).horasFormatadas),1)]),i("p",{class:"text-sm text-blue-800 mb-2"},[i("strong",null,"Intervalo:"),n(" "+y(c(W).intervaloFormatado),1)]),c(W).avisos.length>0?(m(),p("div",{key:0,class:"space-y-1"},[(m(!0),p(v,null,g(c(W).avisos,(e,t)=>(m(),p("p",{key:t,class:["text-xs px-2 py-1 rounded",{"bg-amber-100 text-amber-800":e.includes("⚠️"),"bg-blue-100 text-blue-800":e.includes("ℹ️"),"bg-red-100 text-red-800":e.includes("❌")}]},y(e),3))),128))])):x("",!0),i("details",{class:"mt-2"},[i("summary",{class:"text-xs text-blue-700 cursor-pointer hover:text-blue-800"},"Ver detalhes do cálculo"),i("pre",{class:"text-xs text-blue-800 mt-2 whitespace-pre-wrap"},y(c(W).detalhes),1)])])])])):x("",!0),i("div",null,[i("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Status"),b(i("select",{"onUpdate:modelValue":e=>c(K).status=e,class:"w-full border border-gray-300 rounded-lg px-3 py-2"},[i("option",{value:"Normal"},"Normal"),i("option",{value:"Falta"},"Falta"),i("option",{value:"Atestado"},"Atestado"),i("option",{value:"Ajustado"},"Ajustado")],8,["onUpdate:modelValue"]),[[f,c(K).status]])]),i("div",null,[i("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Justificativa"),b(i("textarea",{"onUpdate:modelValue":e=>c(K).justificativa=e,rows:"2",class:"w-full border border-gray-300 rounded-lg px-3 py-2"},null,8,["onUpdate:modelValue"]),[[$,c(K).justificativa]])])])];t(`<div class="space-y-4"${s}>`),c(q)?t(`<div class="bg-gray-50 rounded-lg p-4"${s}><p class="font-medium text-gray-800"${s}>${A(c(G)?.colaborador?.nome)}</p><p class="text-sm text-gray-500"${s}>${A(formatarData(c(G)?.data))}</p></div>`):(t(`<div${s}><label class="block text-sm font-medium text-gray-700 mb-1"${s}>Colaborador *</label><select class="w-full border border-gray-300 rounded-lg px-3 py-2"${s}><option value=""${C(Array.isArray(c(K).colaborador_id)?z(c(K).colaborador_id,""):E(c(K).colaborador_id,""))?" selected":""}${s}>Selecione...</option>\x3c!--[--\x3e`),j(c(Z),e=>{t(`<option${k("value",e.id)}${C(Array.isArray(c(K).colaborador_id)?z(c(K).colaborador_id,e.id):E(c(K).colaborador_id,e.id))?" selected":""}${s}>${A(e.nome)}</option>`)}),t("\x3c!--]--\x3e</select></div>")),c(q)?t("\x3c!----\x3e"):t(`<div${s}><label class="block text-sm font-medium text-gray-700 mb-1"${s}>Data *</label><input type="date"${k("value",c(K).data)} class="w-full border border-gray-300 rounded-lg px-3 py-2"${s}></div>`),t(`<div class="grid grid-cols-2 gap-4"${s}><div${s}><label class="block text-sm font-medium text-gray-700 mb-1"${s}>Entrada</label><input type="time"${k("value",c(K).entrada_1)} class="w-full border border-gray-300 rounded-lg px-3 py-2"${s}></div><div${s}><label class="block text-sm font-medium text-gray-700 mb-1"${s}>Saida Int.</label><input type="time"${k("value",c(K).saida_1)} class="w-full border border-gray-300 rounded-lg px-3 py-2"${s}><p class="text-xs text-gray-500 mt-1"${s}>Horário de saída para intervalo</p></div><div${s}><label class="block text-sm font-medium text-gray-700 mb-1"${s}>Retorno</label><input type="time"${k("value",c(K).entrada_2)} class="w-full border border-gray-300 rounded-lg px-3 py-2"${s}><p class="text-xs text-gray-500 mt-1"${s}>Horário de retorno do intervalo</p></div><div${s}><label class="block text-sm font-medium text-gray-700 mb-1"${s}>Saida</label><input type="time"${k("value",c(K).saida_2)} class="w-full border border-gray-300 rounded-lg px-3 py-2"${s}></div></div>`),c(W)?(t(`<div class="bg-blue-50 border border-blue-200 rounded-lg p-4"${s}><div class="flex items-start gap-2"${s}>`),t(_(D,{name:"heroicons:information-circle",class:"text-blue-600 mt-0.5",size:"20"},null,a,s)),t(`<div class="flex-1"${s}><p class="text-sm font-medium text-blue-900 mb-2"${s}>Preview do Cálculo:</p><p class="text-sm text-blue-800 font-mono mb-1"${s}><strong${s}>Horas Trabalhadas:</strong> ${A(c(W).horasFormatadas)}</p><p class="text-sm text-blue-800 mb-2"${s}><strong${s}>Intervalo:</strong> ${A(c(W).intervaloFormatado)}</p>`),c(W).avisos.length>0?(t(`<div class="space-y-1"${s}>\x3c!--[--\x3e`),j(c(W).avisos,(e,a)=>{t(`<p class="${S([{"bg-amber-100 text-amber-800":e.includes("⚠️"),"bg-blue-100 text-blue-800":e.includes("ℹ️"),"bg-red-100 text-red-800":e.includes("❌")},"text-xs px-2 py-1 rounded"])}"${s}>${A(e)}</p>`)}),t("\x3c!--]--\x3e</div>")):t("\x3c!----\x3e"),t(`<details class="mt-2"${s}><summary class="text-xs text-blue-700 cursor-pointer hover:text-blue-800"${s}>Ver detalhes do cálculo</summary><pre class="text-xs text-blue-800 mt-2 whitespace-pre-wrap"${s}>${A(c(W).detalhes)}</pre></details></div></div></div>`)):t("\x3c!----\x3e"),t(`<div${s}><label class="block text-sm font-medium text-gray-700 mb-1"${s}>Status</label><select class="w-full border border-gray-300 rounded-lg px-3 py-2"${s}><option value="Normal"${C(Array.isArray(c(K).status)?z(c(K).status,"Normal"):E(c(K).status,"Normal"))?" selected":""}${s}>Normal</option><option value="Falta"${C(Array.isArray(c(K).status)?z(c(K).status,"Falta"):E(c(K).status,"Falta"))?" selected":""}${s}>Falta</option><option value="Atestado"${C(Array.isArray(c(K).status)?z(c(K).status,"Atestado"):E(c(K).status,"Atestado"))?" selected":""}${s}>Atestado</option><option value="Ajustado"${C(Array.isArray(c(K).status)?z(c(K).status,"Ajustado"):E(c(K).status,"Ajustado"))?" selected":""}${s}>Ajustado</option></select></div><div${s}><label class="block text-sm font-medium text-gray-700 mb-1"${s}>Justificativa</label><textarea rows="2" class="w-full border border-gray-300 rounded-lg px-3 py-2"${s}>${A(c(K).justificativa)}</textarea></div></div>`)}),_:1},N)),r(_(re,{modelValue:c(O),"onUpdate:modelValue":e=>u(O)?O.value=e:null,title:"Gerenciar Assinaturas de Ponto",size:"lg"},{footer:d((e,t,a,s)=>{if(!t)return[i("div",{class:"flex justify-end"},[i(te,{variant:"outline",onClick:e=>O.value=!1},{default:d(()=>[n("Fechar")]),_:1},8,["onClick"])])];t(`<div class="flex justify-end"${s}>`),t(_(te,{variant:"outline",onClick:e=>O.value=!1},{default:d((e,t,a,s)=>{if(!t)return[n("Fechar")];t("Fechar")}),_:1},a,s)),t("</div>")}),default:d((e,t,a,s)=>{if(!t)return[i("div",{class:"space-y-4"},[i("div",{class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},[i("div",{class:"flex items-start gap-2"},[i(D,{name:"heroicons:information-circle",class:"text-blue-600 mt-0.5",size:"20"}),i("div",null,[i("p",{class:"text-sm font-medium text-blue-900 mb-1"},"Como funciona:"),i("ul",{class:"text-sm text-blue-800 space-y-1"},[i("li",null,"• Colaboradores podem baixar ponto dos últimos 30 dias"),i("li",null,"• Após assinar, o histórico fica bloqueado até o próximo período"),i("li",null,"• Você pode zerar a assinatura para liberar novo download"),i("li",null,"• Útil quando colaborador assina antes do prazo (ex: dia 20 ao invés do dia 5)")])])])]),0===c(Y).length?(m(),p("div",{key:0,class:"text-center py-8"},[i(D,{name:"heroicons:document-text",class:"text-gray-300 mx-auto mb-2",size:"48"}),i("p",{class:"text-gray-500"},"Nenhuma assinatura encontrada")])):(m(),p("div",{key:1,class:"space-y-3"},[(m(!0),p(v,null,g(c(Y),e=>(m(),p("div",{key:e.id,class:"border border-gray-200 rounded-lg p-4"},[i("div",{class:"flex items-center justify-between"},[i("div",{class:"flex-1"},[i("div",{class:"flex items-center gap-3 mb-2"},[i("div",{class:"w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center"},[i(D,{name:"heroicons:user",class:"text-gray-500",size:"20"})]),i("div",null,[i("p",{class:"font-medium text-gray-800"},y(e.colaborador?.nome||"N/A"),1),i("p",{class:"text-sm text-gray-500"},y(e.colaborador?.departamento?.nome||""),1)])]),i("div",{class:"grid grid-cols-2 gap-4 text-sm"},[i("div",null,[i("span",{class:"text-gray-500"},"Data da Assinatura:"),i("p",{class:"font-medium"},y(formatarData(e.data_assinatura)),1)]),i("div",null,[i("span",{class:"text-gray-500"},"Período:"),i("p",{class:"font-medium"},y(h[e.mes-1])+"/"+y(e.ano),1)]),i("div",null,[i("span",{class:"text-gray-500"},"IP:"),i("p",{class:"font-medium font-mono text-xs"},y(e.ip_assinatura||"N/A"),1)]),i("div",null,[i("span",{class:"text-gray-500"},"Criado em:"),i("p",{class:"font-medium"},y(formatarData(e.created_at)),1)])]),e.hash_assinatura?(m(),p("div",{key:0,class:"mt-2"},[i("span",{class:"text-gray-500 text-sm"},"Hash:"),i("p",{class:"font-mono text-xs text-gray-600 break-all"},y(e.hash_assinatura),1)])):x("",!0)]),i("div",{class:"flex flex-col gap-2 ml-4"},[i("button",{onClick:t=>(async e=>{if(confirm(`Zerar assinatura de ${e.colaborador?.nome}?\n\nIsso permitirá que o colaborador baixe novamente os últimos 30 dias de ponto.`))try{await $fetch(`/api/admin/assinaturas-ponto/${e.id}/zerar`,{method:"POST"}),await buscarAssinaturas(),alert("Assinatura zerada com sucesso! O colaborador pode baixar o ponto novamente.")}catch(e){alert(e.data?.message||"Erro ao zerar assinatura")}})(e),class:"px-3 py-1.5 text-sm bg-amber-100 text-amber-700 hover:bg-amber-200 rounded-lg transition-colors",title:"Zerar assinatura - permite novo download"},[i(D,{name:"heroicons:arrow-path",size:"16",class:"inline mr-1"}),n(" Zerar ")],8,["onClick"]),i("button",{onClick:t=>(async e=>{if(confirm(`Excluir permanentemente a assinatura de ${e.colaborador?.nome}?`))try{await $fetch(`/api/admin/assinaturas-ponto/${e.id}`,{method:"DELETE"}),await buscarAssinaturas(),alert("Assinatura excluída com sucesso!")}catch(e){alert(e.data?.message||"Erro ao excluir assinatura")}})(e),class:"px-3 py-1.5 text-sm bg-red-100 text-red-700 hover:bg-red-200 rounded-lg transition-colors",title:"Excluir assinatura permanentemente"},[i(D,{name:"heroicons:trash",size:"16",class:"inline mr-1"}),n(" Excluir ")],8,["onClick"])])])]))),128))]))])];t(`<div class="space-y-4"${s}><div class="bg-blue-50 border border-blue-200 rounded-lg p-4"${s}><div class="flex items-start gap-2"${s}>`),t(_(D,{name:"heroicons:information-circle",class:"text-blue-600 mt-0.5",size:"20"},null,a,s)),t(`<div${s}><p class="text-sm font-medium text-blue-900 mb-1"${s}>Como funciona:</p><ul class="text-sm text-blue-800 space-y-1"${s}><li${s}>• Colaboradores podem baixar ponto dos últimos 30 dias</li><li${s}>• Após assinar, o histórico fica bloqueado até o próximo período</li><li${s}>• Você pode zerar a assinatura para liberar novo download</li><li${s}>• Útil quando colaborador assina antes do prazo (ex: dia 20 ao invés do dia 5)</li></ul></div></div></div>`),0===c(Y).length?(t(`<div class="text-center py-8"${s}>`),t(_(D,{name:"heroicons:document-text",class:"text-gray-300 mx-auto mb-2",size:"48"},null,a,s)),t(`<p class="text-gray-500"${s}>Nenhuma assinatura encontrada</p></div>`)):(t(`<div class="space-y-3"${s}>\x3c!--[--\x3e`),j(c(Y),e=>{t(`<div class="border border-gray-200 rounded-lg p-4"${s}><div class="flex items-center justify-between"${s}><div class="flex-1"${s}><div class="flex items-center gap-3 mb-2"${s}><div class="w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center"${s}>`),t(_(D,{name:"heroicons:user",class:"text-gray-500",size:"20"},null,a,s)),t(`</div><div${s}><p class="font-medium text-gray-800"${s}>${A(e.colaborador?.nome||"N/A")}</p><p class="text-sm text-gray-500"${s}>${A(e.colaborador?.departamento?.nome||"")}</p></div></div><div class="grid grid-cols-2 gap-4 text-sm"${s}><div${s}><span class="text-gray-500"${s}>Data da Assinatura:</span><p class="font-medium"${s}>${A(formatarData(e.data_assinatura))}</p></div><div${s}><span class="text-gray-500"${s}>Período:</span><p class="font-medium"${s}>${A(h[e.mes-1])}/${A(e.ano)}</p></div><div${s}><span class="text-gray-500"${s}>IP:</span><p class="font-medium font-mono text-xs"${s}>${A(e.ip_assinatura||"N/A")}</p></div><div${s}><span class="text-gray-500"${s}>Criado em:</span><p class="font-medium"${s}>${A(formatarData(e.created_at))}</p></div></div>`),e.hash_assinatura?t(`<div class="mt-2"${s}><span class="text-gray-500 text-sm"${s}>Hash:</span><p class="font-mono text-xs text-gray-600 break-all"${s}>${A(e.hash_assinatura)}</p></div>`):t("\x3c!----\x3e"),t(`</div><div class="flex flex-col gap-2 ml-4"${s}><button class="px-3 py-1.5 text-sm bg-amber-100 text-amber-700 hover:bg-amber-200 rounded-lg transition-colors" title="Zerar assinatura - permite novo download"${s}>`),t(_(D,{name:"heroicons:arrow-path",size:"16",class:"inline mr-1"},null,a,s)),t(` Zerar </button><button class="px-3 py-1.5 text-sm bg-red-100 text-red-700 hover:bg-red-200 rounded-lg transition-colors" title="Excluir assinatura permanentemente"${s}>`),t(_(D,{name:"heroicons:trash",size:"16",class:"inline mr-1"},null,a,s)),t(" Excluir </button></div></div></div>")}),t("\x3c!--]--\x3e</div>")),t("</div>")}),_:1},N)),r("</div>")}}}),H=R.setup;R.setup=(e,t)=>{const a=h();return(a.modules||(a.modules=new Set)).add("pages/ponto.vue"),H?H(e,t):void 0};export{R as default};
