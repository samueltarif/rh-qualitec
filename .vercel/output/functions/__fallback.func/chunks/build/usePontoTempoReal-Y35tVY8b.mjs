import{ref as a,computed as r,watch as o}from"vue";function horaParaMinutos(a){if(!a)return 0;const r=a.split(":").map(Number);return 60*(r[0]||0)+(r[1]||0)}function formatarMinutos(a){if(0===a)return"0h00";return`${Math.floor(a/60)}h${(a%60).toString().padStart(2,"0")}`}function intervaloCompleto(a,r){return!(!a||!r)}function intervaloParcial(a,r){return!(!a||r)||!(a||!r)}function registroEmAndamento(a){return!(!a.entrada_1||a.saida_2)}function calcularHorasTempoReal(a,r){const o=r||new Date,t=`${o.getHours().toString().padStart(2,"0")}:${o.getMinutes().toString().padStart(2,"0")}`,n={...a};n.saida_2||(n.saida_2=t);const e=calcularHorasTrabalhadas(n);return a.saida_2||e.avisos.unshift("⏱️ Contagem em tempo real"),e}function calcularHorasTrabalhadas(a){const r=[];let o=0,t=0;const n=[];if(!a.entrada_1)return{totalMinutos:0,horasFormatadas:"--:--",intervaloMinutos:0,intervaloFormatado:"não registrado",avisos:["Entrada não registrada"],detalhes:"Sem entrada registrada"};const e=horaParaMinutos(a.entrada_1),s=horaParaMinutos(a.saida_1),i=horaParaMinutos(a.entrada_2),d=horaParaMinutos(a.saida_2),u=horaParaMinutos(a.entrada_3),l=horaParaMinutos(a.saida_3),m=intervaloCompleto(a.saida_1,a.entrada_2),_=intervaloParcial(a.saida_1,a.entrada_2),c=!!(a.entrada_1&&a.saida_1&&a.entrada_2&&a.saida_2),h=!(!a.entrada_3&&!a.saida_3),p=c&&h&&intervaloCompleto(a.saida_2,a.entrada_3),f=c&&h&&intervaloParcial(a.saida_2,a.entrada_3);if(_&&(a.saida_1&&!a.entrada_2?r.push("⚠️ Intervalo incompleto — falta horário de retorno"):!a.saida_1&&a.entrada_2&&r.push("⚠️ Intervalo incompleto — falta horário de início do intervalo")),f&&(a.saida_2&&a.entrada_3&&!a.saida_3?r.push("⚠️ Hora extra iniciada — falta horário de saída"):!a.saida_2&&a.entrada_3&&r.push("⚠️ Registro inconsistente — entrada extra sem saída da jornada")),a.entrada_1&&a.saida_2&&!a.saida_1&&!a.entrada_2)o=d-e,n.push(`Entrada (${a.entrada_1}) → Saída (${a.saida_2})`),n.push(`Cálculo: ${a.saida_2} - ${a.entrada_1} = ${formatarMinutos(o)}`),r.push("ℹ️ Nenhum intervalo registrado");else if(m){const r=s-e;if(o+=r,n.push(`Período 1: ${a.entrada_1} → ${a.saida_1} = ${formatarMinutos(r)}`),t=i-s,n.push(`Intervalo: ${a.saida_1} → ${a.entrada_2} = ${formatarMinutos(t)}`),a.saida_2){const r=d-i;o+=r,n.push(`Período 2: ${a.entrada_2} → ${a.saida_2} = ${formatarMinutos(r)}`)}if(p&&a.saida_3){const r=l-u;o+=r;const e=u-d;t+=e,n.push(`Intervalo 2: ${a.saida_2} → ${a.entrada_3} = ${formatarMinutos(e)}`),n.push(`Período 3: ${a.entrada_3} → ${a.saida_3} = ${formatarMinutos(r)}`)}n.push(`Total: ${formatarMinutos(o)} (descontado ${formatarMinutos(t)} de intervalo)`)}else if(_){let r=e;a.saida_2?r=d:a.entrada_2?r=i:a.saida_1&&(r=s),o=r-e,n.push(`Entrada (${a.entrada_1}) → Último registro`),n.push(`Cálculo sem desconto de intervalo: ${formatarMinutos(o)}`),n.push("⚠️ Intervalo não descontado (incompleto)")}else a.entrada_1&&a.saida_1&&!a.entrada_2&&!a.saida_2?(o=s-e,n.push(`Entrada (${a.entrada_1}) → Saída (${a.saida_1})`),n.push(`Cálculo: ${formatarMinutos(o)}`)):!a.entrada_1||a.saida_1||a.entrada_2||a.saida_2||(r.push("⏱️ Registro em andamento ou incompleto"),n.push("Apenas entrada registrada"),o=0);return o<0&&(r.push("❌ ERRO: Horários inválidos (duração negativa)"),o=0),t<0&&(r.push("❌ ERRO: Intervalo com duração negativa"),t=0),t>180&&r.push("⚠️ Intervalo muito longo (mais de 3 horas)"),o>720&&r.push("⚠️ Jornada muito longa (mais de 12 horas)"),{totalMinutos:o,horasFormatadas:o>0?formatarMinutos(o):"--:--",intervaloMinutos:t,intervaloFormatado:t>0?formatarMinutos(t):"não registrado",avisos:r,detalhes:n.join("\n")}}function formatarHora(a){return a?a.substring(0,5):"--:--"}function usePontoTempoReal(t){const n=a(new Date);let e=null;const s=r(()=>t.value.some(a=>registroEmAndamento(a))),iniciarTimer=()=>{e||(e=void console.error("[nuxt] `setInterval` should not be used on the server. Consider wrapping it with an `onNuxtReady`, `onBeforeMount` or `onMounted` lifecycle hook, or ensure you only call it in the browser by checking `false`."),n.value=new Date)},pararTimer=()=>{e&&(clearInterval(e),e=null)};return o(s,a=>{a?iniciarTimer():pararTimer()},{immediate:!0}),{horaAtual:n,calcularHoras:a=>registroEmAndamento(a)?calcularHorasTempoReal(a,n.value):calcularHorasTrabalhadas(a),temRegistroEmAndamento:s,registroEmAndamento:registroEmAndamento,iniciarTimer:iniciarTimer,pararTimer:pararTimer,verificarTimer:()=>{s.value?iniciarTimer():pararTimer()}}}export{calcularHorasTempoReal as a,calcularHorasTrabalhadas as c,formatarHora as f,registroEmAndamento as r,usePontoTempoReal as u};
