import{_ as e}from"./BasePageHeader-D1TyVd9P.mjs";import{defineComponent as t,ref as a,computed as o,resolveComponent as s,mergeProps as l,unref as r,withCtx as d,createVNode as i,createBlock as n,openBlock as c,Fragment as u,renderList as m,toDisplayString as p,createTextVNode as v,isRef as x,watch as b,useSSRContext as g}from"vue";import{ssrRenderAttrs as f,ssrRenderComponent as h,ssrRenderList as y,ssrRenderAttr as _,ssrInterpolate as w,ssrRenderClass as D}from"vue/server-renderer";import{_ as $}from"./UISelect-C9tnEbh5.mjs";import{_ as j}from"./UIButton-BfdUCxqX.mjs";import{_ as A}from"./UIInput-CnioD5-Q.mjs";import{b as C}from"./server.mjs";import"./UserProfileDropdown-D7V90wtd.mjs";import"../_/nitro.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"../routes/renderer.mjs";import"vue-bundle-renderer/runtime";import"unhead/server";import"devalue";import"pinia";import"vue-router";import"@supabase/ssr";const V=t({__name:"CardDocumentosStats",__ssrInlineRender:!0,props:{stats:{}},setup:e=>(t,a,o,r)=>{const d=s("Icon");a(`<div${f(l({class:"grid md:grid-cols-4 gap-6 mb-8"},r))}><div class="card bg-red-50 border-2 border-red-200"><div class="flex items-center gap-4"><div class="w-12 h-12 bg-red-700 rounded-lg flex items-center justify-center">`),a(h(d,{name:"heroicons:document-text",class:"text-white",size:"24"},null,o)),a(`</div><div><p class="text-sm text-gray-600">Total</p><p class="text-2xl font-bold text-gray-800">${w(e.stats.total)}</p></div></div></div><div class="card"><div class="flex items-center gap-4"><div class="w-12 h-12 bg-yellow-600 rounded-lg flex items-center justify-center">`),a(h(d,{name:"heroicons:clock",class:"text-white",size:"24"},null,o)),a(`</div><div><p class="text-sm text-gray-600">Pendentes</p><p class="text-2xl font-bold text-gray-800">${w(e.stats.pendente)}</p></div></div></div><div class="card"><div class="flex items-center gap-4"><div class="w-12 h-12 bg-green-600 rounded-lg flex items-center justify-center">`),a(h(d,{name:"heroicons:check-circle",class:"text-white",size:"24"},null,o)),a(`</div><div><p class="text-sm text-gray-600">Aprovados</p><p class="text-2xl font-bold text-gray-800">${w(e.stats.aprovado)}</p></div></div></div><div class="card"><div class="flex items-center gap-4"><div class="w-12 h-12 bg-blue-600 rounded-lg flex items-center justify-center">`),a(h(d,{name:"heroicons:calendar",class:"text-white",size:"24"},null,o)),a(`</div><div><p class="text-sm text-gray-600">Este Mês</p><p class="text-2xl font-bold text-gray-800">${w(e.stats.esteMes)}</p></div></div></div></div>`)}}),k=V.setup;V.setup=(e,t)=>{const a=g();return(a.modules||(a.modules=new Set)).add("components/CardDocumentosStats.vue"),k?k(e,t):void 0};const S=Object.assign(V,{__name:"CardDocumentosStats"}),R=t({__name:"TableDocumentosRH",__ssrInlineRender:!0,props:{documentos:{}},emits:["aprovar","rejeitar","excluir"],setup(e){const formatDate=e=>e?new Date(e).toLocaleDateString("pt-BR"):"-";return(t,a,o,r)=>{const d=s("Icon");a(`<div${f(l({class:"card overflow-hidden"},r))}><div class="overflow-x-auto"><table class="w-full"><thead class="bg-gray-50 border-b border-gray-200"><tr><th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Colaborador</th><th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Tipo</th><th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Período</th><th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Data Envio</th><th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Status</th><th class="px-6 py-3 text-right text-xs font-semibold text-gray-600 uppercase">Ações</th></tr></thead><tbody class="divide-y divide-gray-200">\x3c!--[--\x3e`),y(e.documentos,e=>{var t,s;a(`<tr class="hover:bg-gray-50"><td class="px-6 py-4"><div class="flex items-center gap-3"><div class="w-10 h-10 bg-blue-900 rounded-full flex items-center justify-center text-white font-semibold text-sm">${w((e=>{const t=e.split(" ");return 1===t.length?t[0].substring(0,2).toUpperCase():(t[0][0]+t[t.length-1][0]).toUpperCase()})(e.colaborador?.nome||"NN"))}</div><div><p class="font-medium text-gray-800">${w(e.colaborador?.nome||"N/A")}</p><p class="text-xs text-gray-500">${w(e.colaborador?.cargo?.nome||"")}</p></div></div></td><td class="px-6 py-4"><div class="flex items-center gap-2">`),a(h(d,{name:(t=e.tipo,{Atestado:"heroicons:heart",Declaracao_Horas:"heroicons:clock",Declaracao_Comparecimento:"heroicons:building-office",Licenca:"heroicons:calendar-days",Ferias:"heroicons:sun",Advertencia:"heroicons:exclamation-triangle",Outros:"heroicons:document"}[t]||"heroicons:document"),class:"text-gray-400",size:"18"},null,o)),a(`<span class="text-sm text-gray-700">${w((e=>({Atestado:"Atestado Médico",Declaracao_Horas:"Declaração de Horas",Declaracao_Comparecimento:"Declaração de Comparecimento",Licenca:"Licença",Ferias:"Férias",Advertencia:"Advertência",Outros:"Outros"}[e]||e))(e.tipo))}</span></div></td><td class="px-6 py-4 text-sm text-gray-600">`),e.data_inicio?a(`<span>${w(formatDate(e.data_inicio))}</span>`):a("\x3c!----\x3e"),e.data_inicio&&e.data_fim?a(`<span> - ${w(formatDate(e.data_fim))}</span>`):a("\x3c!----\x3e"),e.horas?a(`<span class="block text-xs text-gray-500">${w(e.horas)}h</span>`):a("\x3c!----\x3e"),a(`</td><td class="px-6 py-4 text-sm text-gray-600">${w(formatDate(e.created_at))}</td><td class="px-6 py-4"><span class="${D([(s=e.status,{Pendente:"badge-warning",Aprovado:"badge-success",Rejeitado:"badge-error"}[s]||"badge-info"),"badge"])}">${w(e.status)}</span></td><td class="px-6 py-4"><div class="flex items-center justify-end gap-2">`),e.arquivo_url?(a(`<a${_("href",e.arquivo_url)} target="_blank" class="p-2 text-gray-500 hover:text-blue-600 hover:bg-blue-50 rounded-lg" title="Ver Arquivo">`),a(h(d,{name:"heroicons:eye",size:"18"},null,o)),a("</a>")):a("\x3c!----\x3e"),"Pendente"===e.status?(a('<button class="p-2 text-gray-500 hover:text-green-600 hover:bg-green-50 rounded-lg" title="Aprovar">'),a(h(d,{name:"heroicons:check",size:"18"},null,o)),a("</button>")):a("\x3c!----\x3e"),"Pendente"===e.status?(a('<button class="p-2 text-gray-500 hover:text-red-600 hover:bg-red-50 rounded-lg" title="Rejeitar">'),a(h(d,{name:"heroicons:x-mark",size:"18"},null,o)),a("</button>")):a("\x3c!----\x3e"),a('<button class="p-2 text-gray-500 hover:text-red-600 hover:bg-red-50 rounded-lg" title="Excluir">'),a(h(d,{name:"heroicons:trash",size:"18"},null,o)),a("</button></div></td></tr>")}),a("\x3c!--]--\x3e</tbody></table></div></div>")}}}),T=R.setup;R.setup=(e,t)=>{const a=g();return(a.modules||(a.modules=new Set)).add("components/TableDocumentosRH.vue"),T?T(e,t):void 0};const P=Object.assign(R,{__name:"TableDocumentosRH"}),U=t({__name:"ModalDocumentoRH",__ssrInlineRender:!0,props:{modelValue:{type:Boolean},colaboradores:{},saving:{type:Boolean}},emits:["update:modelValue","submit"],setup(e,{emit:t}){const o=e,x=[{value:"Atestado",label:"Atestado Médico"},{value:"Declaracao_Horas",label:"Declaração de Horas"},{value:"Declaracao_Comparecimento",label:"Declaração de Comparecimento"},{value:"Licenca",label:"Licença"},{value:"Ferias",label:"Férias"},{value:"Advertencia",label:"Advertência"},{value:"Outros",label:"Outros"}],g=a({colaborador_id:"",tipo:"",data_inicio:"",data_fim:"",horas:null,observacoes:""}),D=a(null);return b(()=>o.modelValue,e=>{e&&(g.value={colaborador_id:"",tipo:"",data_inicio:"",data_fim:"",horas:null,observacoes:""},D.value=null)}),(t,a,o,b)=>{const D=s("Icon"),C=$,V=A,k=j;e.modelValue?(a(`<div${f(l({class:"fixed inset-0 z-50 flex items-center justify-center"},b))}><div class="absolute inset-0 bg-black/50"></div><div class="relative bg-white rounded-xl shadow-xl w-full max-w-lg mx-4 max-h-[90vh] overflow-y-auto"><div class="sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between"><h3 class="text-xl font-bold text-gray-800">Novo Documento</h3><button class="p-2 hover:bg-gray-100 rounded-lg">`),a(h(D,{name:"heroicons:x-mark",size:"24"},null,o)),a('</button></div><form class="p-6 space-y-4"><div><label class="block text-sm font-medium text-gray-700 mb-1">Colaborador *</label>'),a(h(C,{modelValue:r(g).colaborador_id,"onUpdate:modelValue":e=>r(g).colaborador_id=e,required:""},{default:d((t,a,o,s)=>{if(!a)return[i("option",{value:""},"Selecione"),(c(!0),n(u,null,m(e.colaboradores,e=>(c(),n("option",{key:e.id,value:e.id},p(e.nome),9,["value"]))),128))];a(`<option value=""${s}>Selecione</option>\x3c!--[--\x3e`),y(e.colaboradores,e=>{a(`<option${_("value",e.id)}${s}>${w(e.nome)}</option>`)}),a("\x3c!--]--\x3e")}),_:1},o)),a('</div><div><label class="block text-sm font-medium text-gray-700 mb-1">Tipo de Documento *</label>'),a(h(C,{modelValue:r(g).tipo,"onUpdate:modelValue":e=>r(g).tipo=e,required:""},{default:d((e,t,a,o)=>{if(!t)return[i("option",{value:""},"Selecione"),(c(),n(u,null,m(x,e=>i("option",{key:e.value,value:e.value},p(e.label),9,["value"])),64))];t(`<option value=""${o}>Selecione</option>\x3c!--[--\x3e`),y(x,e=>{t(`<option${_("value",e.value)}${o}>${w(e.label)}</option>`)}),t("\x3c!--]--\x3e")}),_:1},o)),a('</div><div class="grid grid-cols-2 gap-4"><div><label class="block text-sm font-medium text-gray-700 mb-1">Data Início</label>'),a(h(V,{modelValue:r(g).data_inicio,"onUpdate:modelValue":e=>r(g).data_inicio=e,type:"date"},null,o)),a('</div><div><label class="block text-sm font-medium text-gray-700 mb-1">Data Fim</label>'),a(h(V,{modelValue:r(g).data_fim,"onUpdate:modelValue":e=>r(g).data_fim=e,type:"date"},null,o)),a("</div></div>"),"Declaracao_Horas"===r(g).tipo?(a('<div><label class="block text-sm font-medium text-gray-700 mb-1">Quantidade de Horas</label>'),a(h(V,{modelValue:r(g).horas,"onUpdate:modelValue":e=>r(g).horas=e,modelModifiers:{number:!0},type:"number",step:"0.5",min:"0",placeholder:"Ex: 2.5"},null,o)),a("</div>")):a("\x3c!----\x3e"),a(`<div><label class="block text-sm font-medium text-gray-700 mb-1">Observações</label><textarea rows="3" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500" placeholder="Detalhes adicionais...">${w(r(g).observacoes)}</textarea></div><div><label class="block text-sm font-medium text-gray-700 mb-1">Anexar Arquivo</label><div class="border-2 border-dashed border-gray-300 rounded-lg p-4"><input type="file" accept=".pdf,.jpg,.jpeg,.png,.doc,.docx" class="w-full"><p class="text-xs text-gray-500 mt-2">PDF, JPG, PNG ou DOC (máx. 10MB)</p></div></div><div class="flex gap-3 pt-4">`),a(h(k,{type:"button",theme:"admin",variant:"secondary","full-width":"",onClick:e=>t.$emit("update:modelValue",!1)},{default:d((e,t,a,o)=>{if(!t)return[v("Cancelar")];t("Cancelar")}),_:1},o)),a(h(k,{type:"submit",theme:"admin",variant:"primary","full-width":"",disabled:e.saving},{default:d((t,a,o,s)=>{if(!a)return[v(p(e.saving?"Salvando...":"Cadastrar"),1)];a(`${w(e.saving?"Salvando...":"Cadastrar")}`)}),_:1},o)),a("</div></form></div></div>")):a("\x3c!----\x3e")}}}),H=U.setup;U.setup=(e,t)=>{const a=g();return(a.modules||(a.modules=new Set)).add("components/ModalDocumentoRH.vue"),H?H(e,t):void 0};const I=Object.assign(U,{__name:"ModalDocumentoRH"}),O=t({__name:"documentos-rh",__ssrInlineRender:!0,setup(t){const b=C(),g=a(!1),D=a(!1),A=a(!1),V=a([]),k=a([]),R=a({colaborador:"",tipo:"",status:""}),T=[{value:"Atestado",label:"Atestado Médico"},{value:"Declaracao_Horas",label:"Declaração de Horas"},{value:"Declaracao_Comparecimento",label:"Declaração de Comparecimento"},{value:"Licenca",label:"Licença"},{value:"Ferias",label:"Férias"},{value:"Advertencia",label:"Advertência"},{value:"Outros",label:"Outros"}],U=o(()=>{const e=new Date,t=new Date(e.getFullYear(),e.getMonth(),1);return{total:V.value.length,pendente:V.value.filter(e=>"Pendente"===e.status).length,aprovado:V.value.filter(e=>"Aprovado"===e.status).length,esteMes:V.value.filter(e=>new Date(e.created_at)>=t).length}}),H=o(()=>{let e=[...V.value];return R.value.colaborador&&(e=e.filter(e=>e.colaborador_id===R.value.colaborador)),R.value.tipo&&(e=e.filter(e=>e.tipo===R.value.tipo)),R.value.status&&(e=e.filter(e=>e.status===R.value.status)),e.sort((e,t)=>new Date(t.created_at).getTime()-new Date(e.created_at).getTime())}),fetchDocumentos=async()=>{g.value=!0;try{const{data:e}=await b.from("documentos_rh").select("*, colaborador:colaboradores(id, nome, cargo:cargos(nome))").order("created_at",{ascending:!1});V.value=e||[]}catch(e){console.error(e)}finally{g.value=!1}},handleSubmit=async(e,t)=>{D.value=!0;try{let a=null;if(t){const o=`${Date.now()}_${t.name}`,s=`${e.colaborador_id}/rh/${o}`,{error:l}=await b.storage.from("colaboradores-medicos").upload(s,t);if(l)throw l;const{data:{publicUrl:r}}=b.storage.from("colaboradores-medicos").getPublicUrl(s);a=r}const{error:o}=await b.from("documentos_rh").insert({...e,arquivo_url:a,status:"Pendente"});if(o)throw o;alert("Documento cadastrado com sucesso!"),A.value=!1,await fetchDocumentos()}catch(e){alert(`Erro: ${e.message}`)}finally{D.value=!1}},handleAprovar=async e=>{if(confirm("Aprovar este documento?"))try{const{error:t}=await b.from("documentos_rh").update({status:"Aprovado",updated_at:(new Date).toISOString()}).eq("id",e.id);if(t)throw t;await fetchDocumentos()}catch(e){alert(`Erro: ${e.message}`)}},handleRejeitar=async e=>{const t=prompt("Motivo da rejeição:");if(t)try{const{error:a}=await b.from("documentos_rh").update({status:"Rejeitado",observacoes:`${e.observacoes||""}\n[REJEITADO] ${t}`.trim(),updated_at:(new Date).toISOString()}).eq("id",e.id);if(a)throw a;await fetchDocumentos()}catch(e){alert(`Erro: ${e.message}`)}},handleDelete=async e=>{if(confirm("Excluir este documento?"))try{const{error:t}=await b.from("documentos_rh").delete().eq("id",e.id);if(t)throw t;await fetchDocumentos()}catch(e){alert(`Erro: ${e.message}`)}};return(t,a,o,b)=>{const C=e,V=S,O=$,z=j,E=s("Icon"),M=P,q=I;a(`<div${f(l({class:"min-h-screen bg-gray-50"},b))}>`),a(h(C,{title:"Documentos RH",subtitle:"Atestados, declarações e documentos diversos",backTo:"/admin",theme:"admin"},null,o)),a('<div class="max-w-7xl mx-auto p-8">'),a(h(V,{stats:r(U)},null,o)),a('<div class="card mb-8"><div class="flex flex-col md:flex-row gap-4 items-start md:items-center justify-between"><div class="flex flex-col md:flex-row gap-4 flex-1">'),a(h(O,{modelValue:r(R).colaborador,"onUpdate:modelValue":e=>r(R).colaborador=e,class:"w-full md:w-64"},{default:d((e,t,a,o)=>{if(!t)return[i("option",{value:""},"Todos os Colaboradores"),(c(!0),n(u,null,m(r(k),e=>(c(),n("option",{key:e.id,value:e.id},p(e.nome),9,["value"]))),128))];t(`<option value=""${o}>Todos os Colaboradores</option>\x3c!--[--\x3e`),y(r(k),e=>{t(`<option${_("value",e.id)}${o}>${w(e.nome)}</option>`)}),t("\x3c!--]--\x3e")}),_:1},o)),a(h(O,{modelValue:r(R).tipo,"onUpdate:modelValue":e=>r(R).tipo=e,class:"w-full md:w-48"},{default:d((e,t,a,o)=>{if(!t)return[i("option",{value:""},"Todos os Tipos"),(c(),n(u,null,m(T,e=>i("option",{key:e.value,value:e.value},p(e.label),9,["value"])),64))];t(`<option value=""${o}>Todos os Tipos</option>\x3c!--[--\x3e`),y(T,e=>{t(`<option${_("value",e.value)}${o}>${w(e.label)}</option>`)}),t("\x3c!--]--\x3e")}),_:1},o)),a(h(O,{modelValue:r(R).status,"onUpdate:modelValue":e=>r(R).status=e,class:"w-full md:w-40"},{default:d((e,t,a,o)=>{if(!t)return[i("option",{value:""},"Todos Status"),i("option",{value:"Pendente"},"Pendente"),i("option",{value:"Aprovado"},"Aprovado"),i("option",{value:"Rejeitado"},"Rejeitado")];t(`<option value=""${o}>Todos Status</option><option value="Pendente"${o}>Pendente</option><option value="Aprovado"${o}>Aprovado</option><option value="Rejeitado"${o}>Rejeitado</option>`)}),_:1},o)),a("</div>"),a(h(z,{theme:"admin",variant:"primary","icon-left":"heroicons:plus",onClick:e=>A.value=!0},{default:d((e,t,a,o)=>{if(!t)return[v("Novo Documento")];t("Novo Documento")}),_:1},o)),a("</div></div>"),r(g)?(a('<div class="card text-center py-12">'),a(h(E,{name:"heroicons:arrow-path",class:"animate-spin text-gray-400 mx-auto mb-4",size:"48"},null,o)),a('<p class="text-gray-600">Carregando documentos...</p></div>')):r(H).length>0?a(h(M,{documentos:r(H),onAprovar:handleAprovar,onRejeitar:handleRejeitar,onExcluir:handleDelete},null,o)):(a('<div class="card text-center py-12">'),a(h(E,{name:"heroicons:document-text",class:"text-gray-300 mx-auto mb-4",size:"64"},null,o)),a('<h3 class="text-lg font-semibold text-gray-800 mb-2">Nenhum documento encontrado</h3><p class="text-gray-600 mb-6">Cadastre atestados, declarações e outros documentos</p>'),a(h(z,{theme:"admin",variant:"primary","icon-left":"heroicons:plus",onClick:e=>A.value=!0},{default:d((e,t,a,o)=>{if(!t)return[v("Novo Documento")];t("Novo Documento")}),_:1},o)),a("</div>")),a("</div>"),a(h(q,{modelValue:r(A),"onUpdate:modelValue":e=>x(A)?A.value=e:null,colaboradores:r(k),saving:r(D),onSubmit:handleSubmit},null,o)),a("</div>")}}}),z=O.setup;O.setup=(e,t)=>{const a=g();return(a.modules||(a.modules=new Set)).add("pages/documentos-rh.vue"),z?z(e,t):void 0};export{O as default};
