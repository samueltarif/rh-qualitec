import{createServerClient as e,parseCookieHeader as o}from"@supabase/ssr";import{j as t,u as s,b as a}from"./nitro.mjs";import{f as n}from"./fetch-retry.mjs";const serverSupabaseClient=async i=>{if(!i.context._supabaseClient){const{url:r,key:c,cookiePrefix:l,cookieOptions:p,clientOptions:{auth:f={},global:u={}}}=s(i).public.supabase;i.context._supabaseClient=e(r,c,{auth:f,cookies:{getAll:()=>o(a(i,"Cookie")??""),setAll:e=>function(e,o){const s=e.node.res,headersWritable=()=>!s.headersSent&&!s.writableEnded;if(headersWritable())for(const{name:s,value:a,options:n}of o){if(!headersWritable())break;t(e,s,a,n)}}(i,e)},cookieOptions:{...p,name:l},global:{fetch:n,...u}})}return i.context._supabaseClient};export{serverSupabaseClient as s};
