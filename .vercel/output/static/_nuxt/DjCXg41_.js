import{E as R,r as _,s as q,d as J,x as K,f as m,b as e,l as A,e as l,a as w,t as g,g as r,F as L,k as M,y as Q,h as W,z as X,_ as Y,j as Z,o as v,p as I,n as T}from"./Cx4dxf1F.js";import{_ as ee}from"./CYmwnrxE.js";import{_ as te}from"./LFDSo-VX.js";import{_ as se}from"./CL2Zebya.js";import{_ as oe}from"./Cu_3WJXs.js";const ae=()=>{const h=R(),p=_([]),c=_(!1),f=_(null),j=async()=>{try{const{data:t}=await h.from("empresas").select("id").limit(1).single();return t?.id||null}catch{return null}},V=async()=>{c.value=!0,f.value=null;try{const{data:t,error:a}=await h.from("departamentos").select("*").order("nome",{ascending:!0});if(a)throw a;return p.value=t,{success:!0,data:t}}catch(t){return f.value=t.message,{success:!1,error:t.message}}finally{c.value=!1}},N=async t=>{c.value=!0,f.value=null;try{const{data:a,error:n}=await h.from("departamentos").select("*").eq("id",t).single();if(n)throw n;return{success:!0,data:a}}catch(a){return f.value=a.message,{success:!1,error:a.message}}finally{c.value=!1}},U=async t=>{c.value=!0,f.value=null;try{const n={empresa_id:await j(),nome:t.nome,ativo:!0};t.descricao&&(n.descricao=t.descricao),t.centro_custo&&(n.centro_custo=t.centro_custo),t.gestor_id&&(n.gestor_id=t.gestor_id);const{data:d,error:b}=await h.from("departamentos").insert(n).select().single();if(b)throw b;return await V(),{success:!0,data:d}}catch(a){return f.value=a.message,{success:!1,error:a.message}}finally{c.value=!1}},E=async(t,a)=>{c.value=!0,f.value=null;try{const n={...a,updated_at:new Date().toISOString()},{data:d,error:b}=await h.from("departamentos").update(n).eq("id",t).select().single();if(b)throw b;return await V(),{success:!0,data:d}}catch(n){return f.value=n.message,{success:!1,error:n.message}}finally{c.value=!1}},x=async(t,a)=>await E(t,{ativo:a}),C=async t=>await x(t,!1),y=async()=>{try{const{data:t,error:a}=await h.from("colaboradores").select("id, nome, cargo_id").eq("status","Ativo").order("nome",{ascending:!0});if(a)throw a;return{success:!0,data:t}}catch(t){return{success:!1,error:t.message}}},k=t=>{let a=[...p.value];if(t.search){const n=t.search.toLowerCase();a=a.filter(d=>d.nome.toLowerCase().includes(n)||d.descricao?.toLowerCase().includes(n)||d.centro_custo?.toLowerCase().includes(n))}if(t.status&&t.status!=="all"){const n=t.status==="ativo";a=a.filter(d=>d.ativo===n)}return a},D=q(()=>({ativo:p.value.filter(t=>t.ativo).length,inativo:p.value.filter(t=>!t.ativo).length,total:p.value.length}));return{departamentos:p,loading:c,error:f,countByStatus:D,fetchDepartamentos:V,fetchDepartamentoById:N,createDepartamento:U,updateDepartamento:E,toggleDepartamentoStatus:x,deleteDepartamento:C,fetchColaboradoresParaGestor:y,filterDepartamentos:k}},re={class:"min-h-screen bg-gray-50"},ne={class:"bg-white border-b border-gray-200 sticky top-0 z-40"},le={class:"max-w-7xl mx-auto px-8 py-4"},ie={class:"flex items-center justify-between"},ce={class:"flex items-center gap-4"},de={class:"max-w-7xl mx-auto p-8"},ue={class:"grid md:grid-cols-3 gap-6 mb-8"},me={class:"card bg-red-50 border-2 border-red-200"},ve={class:"flex items-center gap-4"},fe={class:"w-12 h-12 bg-red-700 rounded-lg flex items-center justify-center"},ge={class:"text-2xl font-bold text-gray-800"},_e={class:"card"},pe={class:"flex items-center gap-4"},xe={class:"w-12 h-12 bg-green-600 rounded-lg flex items-center justify-center"},he={class:"text-2xl font-bold text-gray-800"},ye={class:"card"},be={class:"flex items-center gap-4"},we={class:"w-12 h-12 bg-gray-600 rounded-lg flex items-center justify-center"},Ce={class:"text-2xl font-bold text-gray-800"},ke={class:"card mb-8"},De={class:"flex flex-col md:flex-row gap-4 items-start md:items-center justify-between"},Ve={class:"flex flex-col md:flex-row gap-4 flex-1"},Ee={class:"flex-1"},Se={key:0,class:"card text-center py-12"},ze={key:1,class:"grid md:grid-cols-2 lg:grid-cols-3 gap-6"},Ie={class:"flex items-start justify-between mb-4"},je={class:"flex items-center gap-3"},Ne={class:"w-12 h-12 bg-blue-600 rounded-lg flex items-center justify-center"},Ue={class:"font-bold text-gray-800"},$e={key:0,class:"text-xs text-gray-500"},Be={key:0,class:"text-sm text-gray-600 mb-4 line-clamp-2"},Ae={key:1,class:"text-sm text-gray-400 italic mb-4"},Le={class:"flex items-center justify-between pt-4 border-t border-gray-200"},Me={class:"flex gap-2"},Te=["onClick"],qe=["title","onClick"],Ge={key:2,class:"card text-center py-12"},Pe={key:0,class:"fixed inset-0 z-50 flex items-center justify-center"},Fe={class:"relative bg-white rounded-xl shadow-xl w-full max-w-md mx-4 p-6"},Oe={class:"text-xl font-bold text-gray-800 mb-6"},He={class:"mb-4"},Re={class:"mb-4"},Je={class:"mb-4"},Ke=["value"],Qe={class:"mb-6"},We={class:"flex gap-3"},st=J({__name:"departamentos",setup(h){const{loading:p,countByStatus:c,fetchDepartamentos:f,filterDepartamentos:j,createDepartamento:V,updateDepartamento:N,toggleDepartamentoStatus:U,fetchColaboradoresParaGestor:E}=ae(),x=_({search:"",status:"all"}),C=_(!1),y=_(!1),k=_(null),D=_(!1),t=_({nome:"",descricao:"",centro_custo:"",gestor_id:""}),a=_([]),n=q(()=>j(x.value));K(async()=>{await f();const i=await E();i.success&&(a.value=i.data||[])});const d=()=>{y.value=!1,k.value=null,t.value={nome:"",descricao:"",centro_custo:"",gestor_id:""},C.value=!0},b=i=>{y.value=!0,k.value=i.id,t.value={nome:i.nome,descricao:i.descricao||"",centro_custo:i.centro_custo||"",gestor_id:i.gestor_id||""},C.value=!0},S=()=>{C.value=!1,t.value={nome:"",descricao:"",centro_custo:"",gestor_id:""}},G=async()=>{if(!t.value.nome){alert("Nome é obrigatório!");return}D.value=!0;try{const i={nome:t.value.nome,descricao:t.value.descricao||void 0,centro_custo:t.value.centro_custo||void 0,gestor_id:t.value.gestor_id||void 0};if(y.value&&k.value){const s=await N(k.value,i);s.success?(alert("Departamento atualizado com sucesso!"),S()):alert(`Erro: ${s.error}`)}else{const s=await V(i);s.success?(alert("Departamento criado com sucesso!"),S()):alert(`Erro: ${s.error}`)}}finally{D.value=!1}},P=async i=>{const s=i.ativo?"desativar":"ativar";if(confirm(`Deseja ${s} o departamento "${i.nome}"?`)){const u=await U(i.id,!i.ativo);u.success?alert(`Departamento ${s}do com sucesso!`):alert(`Erro: ${u.error}`)}};return(i,s)=>{const u=Z("Icon"),F=Y,O=ee,$=te,B=se,z=oe;return v(),m("div",re,[e("header",ne,[e("div",le,[e("div",ie,[e("div",ce,[l(F,{to:"/admin",class:"w-10 h-10 bg-red-700 rounded-lg flex items-center justify-center hover:bg-red-800 transition-colors"},{default:w(()=>[l(u,{name:"heroicons:arrow-left",class:"text-white",size:"20"})]),_:1}),s[6]||(s[6]=e("div",null,[e("h1",{class:"text-xl font-bold text-gray-800"},"Gestão de Departamentos"),e("p",{class:"text-sm text-gray-500"},"Organizar setores e áreas da empresa")],-1))]),l(O,{theme:"admin"})])])]),e("div",de,[e("div",ue,[e("div",me,[e("div",ve,[e("div",fe,[l(u,{name:"heroicons:building-office",class:"text-white",size:"24"})]),e("div",null,[s[7]||(s[7]=e("p",{class:"text-sm text-gray-600"},"Total",-1)),e("p",ge,g(r(c).total),1)])])]),e("div",_e,[e("div",pe,[e("div",xe,[l(u,{name:"heroicons:check-circle",class:"text-white",size:"24"})]),e("div",null,[s[8]||(s[8]=e("p",{class:"text-sm text-gray-600"},"Ativos",-1)),e("p",he,g(r(c).ativo),1)])])]),e("div",ye,[e("div",be,[e("div",we,[l(u,{name:"heroicons:x-circle",class:"text-white",size:"24"})]),e("div",null,[s[9]||(s[9]=e("p",{class:"text-sm text-gray-600"},"Inativos",-1)),e("p",Ce,g(r(c).inativo),1)])])])]),e("div",ke,[e("div",De,[e("div",Ve,[e("div",Ee,[l($,{modelValue:r(x).search,"onUpdate:modelValue":s[0]||(s[0]=o=>r(x).search=o),type:"text",placeholder:"Buscar por nome, descrição...","icon-left":"heroicons:magnifying-glass"},null,8,["modelValue"])]),l(B,{modelValue:r(x).status,"onUpdate:modelValue":s[1]||(s[1]=o=>r(x).status=o),class:"w-full md:w-40"},{default:w(()=>[...s[10]||(s[10]=[e("option",{value:"all"},"Todos Status",-1),e("option",{value:"ativo"},"Ativos",-1),e("option",{value:"inativo"},"Inativos",-1)])]),_:1},8,["modelValue"])]),l(z,{theme:"admin",variant:"primary","icon-left":"heroicons:plus",onClick:d},{default:w(()=>[...s[11]||(s[11]=[I(" Novo Departamento ",-1)])]),_:1})])]),r(p)?(v(),m("div",Se,[l(u,{name:"heroicons:arrow-path",class:"animate-spin text-gray-400 mx-auto mb-4",size:"48"}),s[12]||(s[12]=e("p",{class:"text-gray-600"},"Carregando departamentos...",-1))])):r(n).length>0?(v(),m("div",ze,[(v(!0),m(L,null,M(r(n),o=>(v(),m("div",{key:o.id,class:"card hover:shadow-lg transition-shadow"},[e("div",Ie,[e("div",je,[e("div",Ne,[l(u,{name:"heroicons:building-office",class:"text-white",size:"24"})]),e("div",null,[e("h3",Ue,g(o.nome),1),o.centro_custo?(v(),m("p",$e,"CC: "+g(o.centro_custo),1)):A("",!0)])]),e("span",{class:T(["badge",o.ativo?"badge-success":"badge-warning"])},g(o.ativo?"Ativo":"Inativo"),3)]),o.descricao?(v(),m("p",Be,g(o.descricao),1)):(v(),m("p",Ae,"Sem descrição")),e("div",Le,[e("div",Me,[e("button",{class:"p-2 text-gray-500 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"Editar",onClick:H=>b(o)},[l(u,{name:"heroicons:pencil",size:"18"})],8,Te),e("button",{class:T(["p-2 rounded-lg transition-colors",o.ativo?"text-gray-500 hover:text-orange-600 hover:bg-orange-50":"text-gray-500 hover:text-green-600 hover:bg-green-50"]),title:o.ativo?"Desativar":"Ativar",onClick:H=>P(o)},[l(u,{name:o.ativo?"heroicons:pause":"heroicons:play",size:"18"},null,8,["name"])],10,qe)])])]))),128))])):(v(),m("div",Ge,[l(u,{name:"heroicons:building-office",class:"text-gray-300 mx-auto mb-4",size:"64"}),s[14]||(s[14]=e("h3",{class:"text-lg font-semibold text-gray-800 mb-2"},"Nenhum departamento encontrado",-1)),s[15]||(s[15]=e("p",{class:"text-gray-600 mb-6"},"Ajuste os filtros ou crie um novo departamento",-1)),l(z,{theme:"admin",variant:"primary","icon-left":"heroicons:plus",onClick:d},{default:w(()=>[...s[13]||(s[13]=[I(" Novo Departamento ",-1)])]),_:1})]))]),r(C)?(v(),m("div",Pe,[e("div",{class:"absolute inset-0 bg-black/50",onClick:S}),e("div",Fe,[e("h3",Oe,g(r(y)?"Editar Departamento":"Novo Departamento"),1),e("form",{onSubmit:Q(G,["prevent"])},[e("div",He,[s[16]||(s[16]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Nome *",-1)),l($,{modelValue:r(t).nome,"onUpdate:modelValue":s[2]||(s[2]=o=>r(t).nome=o),type:"text",placeholder:"Ex: Recursos Humanos",required:""},null,8,["modelValue"])]),e("div",Re,[s[17]||(s[17]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Centro de Custo",-1)),l($,{modelValue:r(t).centro_custo,"onUpdate:modelValue":s[3]||(s[3]=o=>r(t).centro_custo=o),type:"text",placeholder:"Ex: CC-001"},null,8,["modelValue"])]),e("div",Je,[s[19]||(s[19]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Gestor",-1)),l(B,{modelValue:r(t).gestor_id,"onUpdate:modelValue":s[4]||(s[4]=o=>r(t).gestor_id=o)},{default:w(()=>[s[18]||(s[18]=e("option",{value:""},"Nenhum gestor",-1)),(v(!0),m(L,null,M(r(a),o=>(v(),m("option",{key:o.id,value:o.id},g(o.nome),9,Ke))),128))]),_:1},8,["modelValue"])]),e("div",Qe,[s[20]||(s[20]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Descrição",-1)),W(e("textarea",{"onUpdate:modelValue":s[5]||(s[5]=o=>r(t).descricao=o),rows:"3",class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500",placeholder:"Descrição do departamento..."},null,512),[[X,r(t).descricao]])]),e("div",We,[l(z,{type:"button",theme:"admin",variant:"secondary","full-width":"",onClick:S},{default:w(()=>[...s[21]||(s[21]=[I(" Cancelar ",-1)])]),_:1}),l(z,{type:"submit",theme:"admin",variant:"primary","full-width":"",disabled:r(D)},{default:w(()=>[I(g(r(D)?"Salvando...":r(y)?"Salvar":"Criar"),1)]),_:1},8,["disabled"])])],32)])])):A("",!0)])}}});export{st as default};
