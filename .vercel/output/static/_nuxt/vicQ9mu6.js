import{_ as B}from"./C5L4yNwo.js";import{d as P,f as m,b as e,e as n,t as x,o as u,_ as I,F as S,j as U,k as $,n as L,r as D,w as G,y as J,a as w,g as l,h as Q,z as Y,l as T,H as K,s as z,x as W,c as X,i as Z}from"./DNqCZqpD.js";import{_ as E}from"./DuTwkaXX.js";import{_ as F}from"./DdnJSzYT.js";import{_ as ee}from"./CG8w0uCL.js";import"./BDJByVvn.js";const te={class:"grid md:grid-cols-4 gap-6 mb-8"},oe={class:"card bg-red-50 border-2 border-red-200"},ae={class:"flex items-center gap-4"},se={class:"w-12 h-12 bg-red-700 rounded-lg flex items-center justify-center"},le={class:"text-2xl font-bold text-gray-800"},ne={class:"card"},re={class:"flex items-center gap-4"},ie={class:"w-12 h-12 bg-yellow-600 rounded-lg flex items-center justify-center"},de={class:"text-2xl font-bold text-gray-800"},ce={class:"card"},ue={class:"flex items-center gap-4"},me={class:"w-12 h-12 bg-green-600 rounded-lg flex items-center justify-center"},pe={class:"text-2xl font-bold text-gray-800"},ve={class:"card"},xe={class:"flex items-center gap-4"},be={class:"w-12 h-12 bg-blue-600 rounded-lg flex items-center justify-center"},_e={class:"text-2xl font-bold text-gray-800"},fe=P({__name:"CardDocumentosStats",props:{stats:{}},setup(_){return(f,v)=>{const g=I;return u(),m("div",te,[e("div",oe,[e("div",ae,[e("div",se,[n(g,{name:"heroicons:document-text",class:"text-white",size:"24"})]),e("div",null,[v[0]||(v[0]=e("p",{class:"text-sm text-gray-600"},"Total",-1)),e("p",le,x(_.stats.total),1)])])]),e("div",ne,[e("div",re,[e("div",ie,[n(g,{name:"heroicons:clock",class:"text-white",size:"24"})]),e("div",null,[v[1]||(v[1]=e("p",{class:"text-sm text-gray-600"},"Pendentes",-1)),e("p",de,x(_.stats.pendente),1)])])]),e("div",ce,[e("div",ue,[e("div",me,[n(g,{name:"heroicons:check-circle",class:"text-white",size:"24"})]),e("div",null,[v[2]||(v[2]=e("p",{class:"text-sm text-gray-600"},"Aprovados",-1)),e("p",pe,x(_.stats.aprovado),1)])])]),e("div",ve,[e("div",xe,[e("div",be,[n(g,{name:"heroicons:calendar",class:"text-white",size:"24"})]),e("div",null,[v[3]||(v[3]=e("p",{class:"text-sm text-gray-600"},"Este Mês",-1)),e("p",_e,x(_.stats.esteMes),1)])])])])}}}),ge=Object.assign(fe,{__name:"CardDocumentosStats"}),ye={class:"card overflow-hidden"},he={class:"overflow-x-auto"},we={class:"w-full"},$e={class:"divide-y divide-gray-200"},De={class:"px-6 py-4"},ke={class:"flex items-center gap-3"},Ve={class:"w-10 h-10 bg-blue-900 rounded-full flex items-center justify-center text-white font-semibold text-sm"},Ce={class:"font-medium text-gray-800"},Ae={class:"text-xs text-gray-500"},je={class:"px-6 py-4"},Se={class:"flex items-center gap-2"},Ue={class:"text-sm text-gray-700"},He={class:"px-6 py-4 text-sm text-gray-600"},Me={key:0},Re={key:1},Te={key:2,class:"block text-xs text-gray-500"},Pe={class:"px-6 py-4 text-sm text-gray-600"},Ie={class:"px-6 py-4"},Oe={class:"px-6 py-4"},ze={class:"flex items-center justify-end gap-2"},Ee=["href"],Fe=["onClick"],Ne=["onClick"],qe=["onClick"],Be=P({__name:"TableDocumentosRH",props:{documentos:{}},emits:["aprovar","rejeitar","excluir"],setup(_){const f=c=>{const i=c.split(" ");return i.length===1?i[0].substring(0,2).toUpperCase():(i[0][0]+i[i.length-1][0]).toUpperCase()},v=c=>c?new Date(c).toLocaleDateString("pt-BR"):"-",g=c=>({Atestado:"Atestado Médico",Declaracao_Horas:"Declaração de Horas",Declaracao_Comparecimento:"Declaração de Comparecimento",Licenca:"Licença",Ferias:"Férias",Advertencia:"Advertência",Outros:"Outros"})[c]||c,y=c=>({Atestado:"heroicons:heart",Declaracao_Horas:"heroicons:clock",Declaracao_Comparecimento:"heroicons:building-office",Licenca:"heroicons:calendar-days",Ferias:"heroicons:sun",Advertencia:"heroicons:exclamation-triangle",Outros:"heroicons:document"})[c]||"heroicons:document",r=c=>({Pendente:"badge-warning",Aprovado:"badge-success",Rejeitado:"badge-error"})[c]||"badge-info";return(c,i)=>{const h=I;return u(),m("div",ye,[e("div",he,[e("table",we,[i[0]||(i[0]=e("thead",{class:"bg-gray-50 border-b border-gray-200"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase"},"Colaborador"),e("th",{class:"px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase"},"Tipo"),e("th",{class:"px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase"},"Período"),e("th",{class:"px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase"},"Data Envio"),e("th",{class:"px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase"},"Status"),e("th",{class:"px-6 py-3 text-right text-xs font-semibold text-gray-600 uppercase"},"Ações")])],-1)),e("tbody",$e,[(u(!0),m(S,null,U(_.documentos,a=>(u(),m("tr",{key:a.id,class:"hover:bg-gray-50"},[e("td",De,[e("div",ke,[e("div",Ve,x(f(a.colaborador?.nome||"NN")),1),e("div",null,[e("p",Ce,x(a.colaborador?.nome||"N/A"),1),e("p",Ae,x(a.colaborador?.cargo?.nome||""),1)])])]),e("td",je,[e("div",Se,[n(h,{name:y(a.tipo),class:"text-gray-400",size:"18"},null,8,["name"]),e("span",Ue,x(g(a.tipo)),1)])]),e("td",He,[a.data_inicio?(u(),m("span",Me,x(v(a.data_inicio)),1)):$("",!0),a.data_inicio&&a.data_fim?(u(),m("span",Re," - "+x(v(a.data_fim)),1)):$("",!0),a.horas?(u(),m("span",Te,x(a.horas)+"h",1)):$("",!0)]),e("td",Pe,x(v(a.created_at)),1),e("td",Ie,[e("span",{class:L(["badge",r(a.status)])},x(a.status),3)]),e("td",Oe,[e("div",ze,[a.arquivo_url?(u(),m("a",{key:0,href:a.arquivo_url,target:"_blank",class:"p-2 text-gray-500 hover:text-blue-600 hover:bg-blue-50 rounded-lg",title:"Ver Arquivo"},[n(h,{name:"heroicons:eye",size:"18"})],8,Ee)):$("",!0),a.status==="Pendente"?(u(),m("button",{key:1,class:"p-2 text-gray-500 hover:text-green-600 hover:bg-green-50 rounded-lg",title:"Aprovar",onClick:o=>c.$emit("aprovar",a)},[n(h,{name:"heroicons:check",size:"18"})],8,Fe)):$("",!0),a.status==="Pendente"?(u(),m("button",{key:2,class:"p-2 text-gray-500 hover:text-red-600 hover:bg-red-50 rounded-lg",title:"Rejeitar",onClick:o=>c.$emit("rejeitar",a)},[n(h,{name:"heroicons:x-mark",size:"18"})],8,Ne)):$("",!0),e("button",{class:"p-2 text-gray-500 hover:text-red-600 hover:bg-red-50 rounded-lg",title:"Excluir",onClick:o=>c.$emit("excluir",a)},[n(h,{name:"heroicons:trash",size:"18"})],8,qe)])])]))),128))])])])])}}}),Le=Object.assign(Be,{__name:"TableDocumentosRH"}),Ge={key:0,class:"fixed inset-0 z-50 flex items-center justify-center"},Je={class:"relative bg-white rounded-xl shadow-xl w-full max-w-lg mx-4 max-h-[90vh] overflow-y-auto"},Qe={class:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between"},Ye=["value"],Ke=["value"],We={class:"grid grid-cols-2 gap-4"},Xe={key:0},Ze={class:"border-2 border-dashed border-gray-300 rounded-lg p-4"},et={class:"flex gap-3 pt-4"},tt=P({__name:"ModalDocumentoRH",props:{modelValue:{type:Boolean},colaboradores:{},saving:{type:Boolean}},emits:["update:modelValue","submit"],setup(_,{emit:f}){const v=_,g=f,y=[{value:"Atestado",label:"Atestado Médico"},{value:"Declaracao_Horas",label:"Declaração de Horas"},{value:"Declaracao_Comparecimento",label:"Declaração de Comparecimento"},{value:"Licenca",label:"Licença"},{value:"Ferias",label:"Férias"},{value:"Advertencia",label:"Advertência"},{value:"Outros",label:"Outros"}],r=D({colaborador_id:"",tipo:"",data_inicio:"",data_fim:"",horas:null,observacoes:""}),c=D(null);G(()=>v.modelValue,a=>{a&&(r.value={colaborador_id:"",tipo:"",data_inicio:"",data_fim:"",horas:null,observacoes:""},c.value=null)});const i=a=>{const o=a.target;c.value=o.files?.[0]||null},h=()=>{if(!r.value.colaborador_id||!r.value.tipo){alert("Preencha os campos obrigatórios!");return}g("submit",{...r.value},c.value)};return(a,o)=>{const k=I,H=E,V=ee,M=F;return _.modelValue?(u(),m("div",Ge,[e("div",{class:"absolute inset-0 bg-black/50",onClick:o[0]||(o[0]=d=>a.$emit("update:modelValue",!1))}),e("div",Je,[e("div",Qe,[o[9]||(o[9]=e("h3",{class:"text-xl font-bold text-gray-800"},"Novo Documento",-1)),e("button",{class:"p-2 hover:bg-gray-100 rounded-lg",onClick:o[1]||(o[1]=d=>a.$emit("update:modelValue",!1))},[n(k,{name:"heroicons:x-mark",size:"24"})])]),e("form",{class:"p-6 space-y-4",onSubmit:J(h,["prevent"])},[e("div",null,[o[11]||(o[11]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Colaborador *",-1)),n(H,{modelValue:l(r).colaborador_id,"onUpdate:modelValue":o[2]||(o[2]=d=>l(r).colaborador_id=d),required:""},{default:w(()=>[o[10]||(o[10]=e("option",{value:""},"Selecione",-1)),(u(!0),m(S,null,U(_.colaboradores,d=>(u(),m("option",{key:d.id,value:d.id},x(d.nome),9,Ye))),128))]),_:1},8,["modelValue"])]),e("div",null,[o[13]||(o[13]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Tipo de Documento *",-1)),n(H,{modelValue:l(r).tipo,"onUpdate:modelValue":o[3]||(o[3]=d=>l(r).tipo=d),required:""},{default:w(()=>[o[12]||(o[12]=e("option",{value:""},"Selecione",-1)),(u(),m(S,null,U(y,d=>e("option",{key:d.value,value:d.value},x(d.label),9,Ke)),64))]),_:1},8,["modelValue"])]),e("div",We,[e("div",null,[o[14]||(o[14]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Data Início",-1)),n(V,{modelValue:l(r).data_inicio,"onUpdate:modelValue":o[4]||(o[4]=d=>l(r).data_inicio=d),type:"date"},null,8,["modelValue"])]),e("div",null,[o[15]||(o[15]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Data Fim",-1)),n(V,{modelValue:l(r).data_fim,"onUpdate:modelValue":o[5]||(o[5]=d=>l(r).data_fim=d),type:"date"},null,8,["modelValue"])])]),l(r).tipo==="Declaracao_Horas"?(u(),m("div",Xe,[o[16]||(o[16]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Quantidade de Horas",-1)),n(V,{modelValue:l(r).horas,"onUpdate:modelValue":o[6]||(o[6]=d=>l(r).horas=d),modelModifiers:{number:!0},type:"number",step:"0.5",min:"0",placeholder:"Ex: 2.5"},null,8,["modelValue"])])):$("",!0),e("div",null,[o[17]||(o[17]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Observações",-1)),Q(e("textarea",{"onUpdate:modelValue":o[7]||(o[7]=d=>l(r).observacoes=d),rows:"3",class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500",placeholder:"Detalhes adicionais..."},null,512),[[Y,l(r).observacoes]])]),e("div",null,[o[19]||(o[19]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Anexar Arquivo",-1)),e("div",Ze,[e("input",{type:"file",onChange:i,accept:".pdf,.jpg,.jpeg,.png,.doc,.docx",class:"w-full"},null,32),o[18]||(o[18]=e("p",{class:"text-xs text-gray-500 mt-2"},"PDF, JPG, PNG ou DOC (máx. 10MB)",-1))])]),e("div",et,[n(M,{type:"button",theme:"admin",variant:"secondary","full-width":"",onClick:o[8]||(o[8]=d=>a.$emit("update:modelValue",!1))},{default:w(()=>[...o[20]||(o[20]=[T("Cancelar",-1)])]),_:1}),n(M,{type:"submit",theme:"admin",variant:"primary","full-width":"",disabled:_.saving},{default:w(()=>[T(x(_.saving?"Salvando...":"Cadastrar"),1)]),_:1},8,["disabled"])])],32)])])):$("",!0)}}}),ot=Object.assign(tt,{__name:"ModalDocumentoRH"}),at={class:"min-h-screen bg-gray-50"},st={class:"max-w-7xl mx-auto p-8"},lt={class:"card mb-8"},nt={class:"flex flex-col md:flex-row gap-4 items-start md:items-center justify-between"},rt={class:"flex flex-col md:flex-row gap-4 flex-1"},it=["value"],dt=["value"],ct={key:0,class:"card text-center py-12"},ut={key:2,class:"card text-center py-12"},ft=P({__name:"documentos-rh",setup(_){const f=K(),v=D(!1),g=D(!1),y=D(!1),r=D([]),c=D([]),i=D({colaborador:"",tipo:"",status:""}),h=[{value:"Atestado",label:"Atestado Médico"},{value:"Declaracao_Horas",label:"Declaração de Horas"},{value:"Declaracao_Comparecimento",label:"Declaração de Comparecimento"},{value:"Licenca",label:"Licença"},{value:"Ferias",label:"Férias"},{value:"Advertencia",label:"Advertência"},{value:"Outros",label:"Outros"}],a=z(()=>{const s=new Date,t=new Date(s.getFullYear(),s.getMonth(),1);return{total:r.value.length,pendente:r.value.filter(p=>p.status==="Pendente").length,aprovado:r.value.filter(p=>p.status==="Aprovado").length,esteMes:r.value.filter(p=>new Date(p.created_at)>=t).length}}),o=z(()=>{let s=[...r.value];return i.value.colaborador&&(s=s.filter(t=>t.colaborador_id===i.value.colaborador)),i.value.tipo&&(s=s.filter(t=>t.tipo===i.value.tipo)),i.value.status&&(s=s.filter(t=>t.status===i.value.status)),s.sort((t,p)=>new Date(p.created_at).getTime()-new Date(t.created_at).getTime())}),k=async()=>{v.value=!0;try{const{data:s}=await f.from("documentos_rh").select("*, colaborador:colaboradores(id, nome, cargo:cargos(nome))").order("created_at",{ascending:!1});r.value=s||[]}catch(s){console.error(s)}finally{v.value=!1}},H=async()=>{const{data:s}=await f.from("colaboradores").select("id, nome").eq("status","Ativo").order("nome");c.value=s||[]},V=async(s,t)=>{g.value=!0;try{let p=null;if(t){const C=`${Date.now()}_${t.name}`,A=`${s.colaborador_id}/rh/${C}`,{error:j}=await f.storage.from("colaboradores-medicos").upload(A,t);if(j)throw j;const{data:{publicUrl:O}}=f.storage.from("colaboradores-medicos").getPublicUrl(A);p=O}const{error:R}=await f.from("documentos_rh").insert({...s,arquivo_url:p,status:"Pendente"});if(R)throw R;alert("Documento cadastrado com sucesso!"),y.value=!1,await k()}catch(p){alert(`Erro: ${p.message}`)}finally{g.value=!1}},M=async s=>{if(confirm("Aprovar este documento?"))try{const{error:t}=await f.from("documentos_rh").update({status:"Aprovado",updated_at:new Date().toISOString()}).eq("id",s.id);if(t)throw t;await k()}catch(t){alert(`Erro: ${t.message}`)}},d=async s=>{const t=prompt("Motivo da rejeição:");if(t)try{const{error:p}=await f.from("documentos_rh").update({status:"Rejeitado",observacoes:`${s.observacoes||""}
[REJEITADO] ${t}`.trim(),updated_at:new Date().toISOString()}).eq("id",s.id);if(p)throw p;await k()}catch(p){alert(`Erro: ${p.message}`)}},N=async s=>{if(confirm("Excluir este documento?"))try{const{error:t}=await f.from("documentos_rh").delete().eq("id",s.id);if(t)throw t;await k()}catch(t){alert(`Erro: ${t.message}`)}};return W(()=>Promise.all([k(),H()])),(s,t)=>{const p=B,R=ge,C=E,A=F,j=I,O=Le,q=ot;return u(),m("div",at,[n(p,{title:"Documentos RH",subtitle:"Atestados, declarações e documentos diversos",backTo:"/admin",theme:"admin"}),e("div",st,[n(R,{stats:l(a)},null,8,["stats"]),e("div",lt,[e("div",nt,[e("div",rt,[n(C,{modelValue:l(i).colaborador,"onUpdate:modelValue":t[0]||(t[0]=b=>l(i).colaborador=b),class:"w-full md:w-64"},{default:w(()=>[t[6]||(t[6]=e("option",{value:""},"Todos os Colaboradores",-1)),(u(!0),m(S,null,U(l(c),b=>(u(),m("option",{key:b.id,value:b.id},x(b.nome),9,it))),128))]),_:1},8,["modelValue"]),n(C,{modelValue:l(i).tipo,"onUpdate:modelValue":t[1]||(t[1]=b=>l(i).tipo=b),class:"w-full md:w-48"},{default:w(()=>[t[7]||(t[7]=e("option",{value:""},"Todos os Tipos",-1)),(u(),m(S,null,U(h,b=>e("option",{key:b.value,value:b.value},x(b.label),9,dt)),64))]),_:1},8,["modelValue"]),n(C,{modelValue:l(i).status,"onUpdate:modelValue":t[2]||(t[2]=b=>l(i).status=b),class:"w-full md:w-40"},{default:w(()=>[...t[8]||(t[8]=[e("option",{value:""},"Todos Status",-1),e("option",{value:"Pendente"},"Pendente",-1),e("option",{value:"Aprovado"},"Aprovado",-1),e("option",{value:"Rejeitado"},"Rejeitado",-1)])]),_:1},8,["modelValue"])]),n(A,{theme:"admin",variant:"primary","icon-left":"heroicons:plus",onClick:t[3]||(t[3]=b=>y.value=!0)},{default:w(()=>[...t[9]||(t[9]=[T("Novo Documento",-1)])]),_:1})])]),l(v)?(u(),m("div",ct,[n(j,{name:"heroicons:arrow-path",class:"animate-spin text-gray-400 mx-auto mb-4",size:"48"}),t[10]||(t[10]=e("p",{class:"text-gray-600"},"Carregando documentos...",-1))])):l(o).length>0?(u(),X(O,{key:1,documentos:l(o),onAprovar:M,onRejeitar:d,onExcluir:N},null,8,["documentos"])):(u(),m("div",ut,[n(j,{name:"heroicons:document-text",class:"text-gray-300 mx-auto mb-4",size:"64"}),t[12]||(t[12]=e("h3",{class:"text-lg font-semibold text-gray-800 mb-2"},"Nenhum documento encontrado",-1)),t[13]||(t[13]=e("p",{class:"text-gray-600 mb-6"},"Cadastre atestados, declarações e outros documentos",-1)),n(A,{theme:"admin",variant:"primary","icon-left":"heroicons:plus",onClick:t[4]||(t[4]=b=>y.value=!0)},{default:w(()=>[...t[11]||(t[11]=[T("Novo Documento",-1)])]),_:1})]))]),n(q,{modelValue:l(y),"onUpdate:modelValue":t[5]||(t[5]=b=>Z(y)?y.value=b:null),colaboradores:l(c),saving:l(g),onSubmit:V},null,8,["modelValue","colaboradores","saving"])])}}});export{ft as default};
