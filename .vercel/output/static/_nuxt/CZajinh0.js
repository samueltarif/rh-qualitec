import{H as b,r as d,s as g}from"./DNqCZqpD.js";const L=()=>{const c=b(),n=d([]),s=d(!1),t=d(null),u=async()=>{s.value=!0,t.value=null;try{const{data:e,error:r}=await c.from("cargos").select(`
          *,
          gestores:cargo_gestores(
            id,
            cargo_id,
            colaborador_id,
            created_at,
            colaborador:colaboradores(
              id,
              nome,
              email_corporativo
            )
          )
        `).order("nome",{ascending:!0});if(r)throw r;return n.value=e,{success:!0,data:e}}catch(e){return t.value=e.message,{success:!1,error:e.message}}finally{s.value=!1}},m=async e=>{s.value=!0,t.value=null;try{const{data:r,error:a}=await c.from("cargos").select("*").eq("id",e).single();if(a)throw a;return{success:!0,data:r}}catch(r){return t.value=r.message,{success:!1,error:r.message}}finally{s.value=!1}},h=async()=>{try{const{data:e}=await c.from("empresas").select("id").limit(1).single();return e?.id||null}catch{return null}},y=async e=>{s.value=!0,t.value=null;try{let r=e.empresa_id;r||(r=await h()||void 0);const a={nome:e.nome,nivel:e.nivel,descricao:e.descricao||null,ativo:!0};r&&(a.empresa_id=r);const{data:o,error:l}=await c.from("cargos").insert(a).select().single();if(l)throw l;return await u(),{success:!0,data:o}}catch(r){return t.value=r.message,{success:!1,error:r.message}}finally{s.value=!1}},f=async(e,r)=>{s.value=!0,t.value=null;try{const a={...r,updated_at:new Date().toISOString()},{data:o,error:l}=await c.from("cargos").update(a).eq("id",e).select().single();if(l)throw l;return await u(),{success:!0,data:o}}catch(a){return t.value=a.message,{success:!1,error:a.message}}finally{s.value=!1}},v=async(e,r)=>await f(e,{ativo:r}),w=async e=>await v(e,!1),p=e=>{let r=[...n.value];if(e.search){const a=e.search.toLowerCase();r=r.filter(o=>o.nome.toLowerCase().includes(a)||o.descricao&&o.descricao.toLowerCase().includes(a))}if(e.nivel&&e.nivel!=="all"&&(r=r.filter(a=>a.nivel===e.nivel)),e.status&&e.status!=="all"){const a=e.status==="ativo";r=r.filter(o=>o.ativo===a)}return r},_=g(()=>({operacional:n.value.filter(e=>e.nivel==="operacional").length,gestao:n.value.filter(e=>e.nivel==="gestao").length,total:n.value.length})),C=g(()=>({ativo:n.value.filter(e=>e.ativo).length,inativo:n.value.filter(e=>!e.ativo).length}));return{cargos:n,loading:s,error:t,countByNivel:_,countByStatus:C,fetchCargos:u,fetchCargoById:m,createCargo:y,updateCargo:f,toggleCargoStatus:v,deleteCargo:w,filterCargos:p,addGestor:async(e,r)=>{s.value=!0,t.value=null;try{const{data:a,error:o}=await c.from("cargo_gestores").insert({cargo_id:e,colaborador_id:r}).select().single();if(o)throw o;return await u(),{success:!0,data:a}}catch(a){return t.value=a.message,{success:!1,error:a.message}}finally{s.value=!1}},removeGestor:async e=>{s.value=!0,t.value=null;try{const{error:r}=await c.from("cargo_gestores").delete().eq("id",e);if(r)throw r;return await u(),{success:!0}}catch(r){return t.value=r.message,{success:!1,error:r.message}}finally{s.value=!1}},fetchColaboradoresDisponiveis:async e=>{try{const{data:r,error:a}=await c.from("colaboradores").select("id, nome, email_corporativo, cargo_id").eq("status","Ativo").order("nome",{ascending:!0});if(a)throw a;const l=n.value.find(i=>i.id===e)?.gestores?.map(i=>i.colaborador_id)||[];return{success:!0,data:r.filter(i=>!l.includes(i.id))}}catch(r){return{success:!1,error:r.message}}},fetchDepartamentos:async()=>{try{const{data:e,error:r}=await c.from("departamentos").select("id, nome").eq("ativo",!0).order("nome",{ascending:!0});if(r)throw r;return{success:!0,data:e}}catch(e){return{success:!1,error:e.message}}}}};export{L as u};
