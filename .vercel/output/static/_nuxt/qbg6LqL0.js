import{d as z,r as U,a as j,g as y,o as p,e,l as I,f as d,t as g,h as a,F as B,k as N,p as A,c as q,b as k,n as F,y as P,j as _e,i as oe,A as te,s as M,H as se,x as we,_ as he}from"./BSA_tgdP.js";import{_ as $e}from"./yUH5lwCE.js";import{_ as T}from"./yogEyCnZ.js";import{_ as L}from"./DUWoehAD.js";import{_ as R}from"./BBzIiODl.js";const Ce={class:"card"},Ue={class:"flex items-center justify-between mb-4"},ke={class:"flex items-center gap-3"},Se={class:"w-10 h-10 bg-amber-100 rounded-lg flex items-center justify-center"},Ee={class:"text-sm text-gray-600"},Ae={key:0,class:"space-y-2"},Ve={class:"flex items-center gap-3"},Ie={class:"w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center text-white text-sm font-semibold"},ze={class:"font-medium text-gray-800"},je={class:"text-xs text-gray-600"},qe={key:0,class:"ml-2"},Me=["onClick"],Fe={key:1,class:"text-center py-6 text-gray-500"},Be=z({__name:"ColaboradoresSemAcessoCard",props:{colaboradoresSemAcesso:{}},emits:["criar-acesso"],setup(m){const x=U(!0),b=u=>{const v=u.split(" ");return v.length===1?v[0].substring(0,2).toUpperCase():(v[0][0]+v[v.length-1][0]).toUpperCase()};return(u,v)=>{const _=j("Icon");return p(),y("div",Ce,[e("div",Ue,[e("div",ke,[e("div",Se,[d(_,{name:"heroicons:user-plus",class:"text-amber-600",size:"24"})]),e("div",null,[v[1]||(v[1]=e("h3",{class:"font-semibold text-gray-800"},"Colaboradores sem Acesso",-1)),e("p",Ee,g(m.colaboradoresSemAcesso.length)+" colaboradores sem usu√°rio",1)])]),e("button",{onClick:v[0]||(v[0]=r=>x.value=!a(x)),class:"p-2 hover:bg-gray-100 rounded-lg transition-colors"},[d(_,{name:a(x)?"heroicons:chevron-up":"heroicons:chevron-down",size:"20",class:"text-gray-600"},null,8,["name"])])]),a(x)&&m.colaboradoresSemAcesso.length>0?(p(),y("div",Ae,[(p(!0),y(B,null,N(m.colaboradoresSemAcesso,r=>(p(),y("div",{key:r.id,class:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors"},[e("div",Ve,[e("div",Ie,g(b(r.nome)),1),e("div",null,[e("p",ze,g(r.nome),1),e("p",je,[A(g(r.email_corporativo||"Sem email")+" ",1),r.cargo?(p(),y("span",qe,"‚Ä¢ "+g(r.cargo.nome),1)):I("",!0)])])]),e("button",{onClick:h=>u.$emit("criar-acesso",r),class:"px-3 py-1.5 bg-red-700 text-white text-sm font-medium rounded-lg hover:bg-red-800 transition-colors flex items-center gap-2"},[d(_,{name:"heroicons:key",size:"16"}),v[2]||(v[2]=A(" Criar Acesso ",-1))],8,Me)]))),128))])):a(x)?(p(),y("div",Fe,[d(_,{name:"heroicons:check-circle",class:"mx-auto mb-2 text-green-500",size:"32"}),v[3]||(v[3]=e("p",{class:"text-sm"},"Todos os colaboradores ativos t√™m acesso ao sistema",-1))])):I("",!0)])}}}),Ne=Object.assign(Be,{__name:"ColaboradoresSemAcessoCard"}),Te=z({__name:"NewUserButton",emits:["click"],setup(m){return(x,b)=>{const u=R;return p(),q(u,{theme:"admin",variant:"primary","icon-left":"heroicons:user-plus",onClick:b[0]||(b[0]=v=>x.$emit("click"))},{default:k(()=>[...b[1]||(b[1]=[A(" Novo Usu√°rio ",-1)])]),_:1})}}}),Le=Object.assign(Te,{__name:"NewUserButton"}),Re={class:"flex items-center justify-end gap-2"},Oe=["title"],De=z({__name:"UserTableActions",props:{isActive:{type:Boolean}},emits:["toggle-status","edit"],setup(m){return(x,b)=>{const u=j("Icon");return p(),y("div",Re,[e("button",{onClick:b[0]||(b[0]=v=>x.$emit("toggle-status")),class:"p-2 hover:bg-gray-100 rounded-lg transition-colors",title:m.isActive?"Desativar":"Ativar"},[d(u,{name:m.isActive?"heroicons:no-symbol":"heroicons:check-circle",class:F(m.isActive?"text-red-600":"text-green-600"),size:"20"},null,8,["name","class"])],8,Oe),e("button",{onClick:b[1]||(b[1]=v=>x.$emit("edit")),class:"p-2 hover:bg-gray-100 rounded-lg transition-colors",title:"Editar"},[d(u,{name:"heroicons:pencil",class:"text-blue-600",size:"20"})])])}}}),Pe=Object.assign(De,{__name:"UserTableActions"}),Ge={class:"fixed inset-0 z-50 flex items-center justify-center"},He={class:"relative bg-white rounded-xl shadow-xl w-full max-w-md mx-4"},Qe={class:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between rounded-t-xl"},Je={class:"text-xl font-bold text-gray-800"},Ke={class:"space-y-4"},We={key:0},Xe={class:"text-xs text-gray-500 mt-1"},Ye={key:0,class:"text-green-600 font-medium ml-2"},Ze={class:"space-y-2"},eo=["value"],oo={class:"mt-2 p-3 bg-blue-50 border border-blue-200 rounded-lg"},to={class:"text-xs text-blue-800"},so={class:"mt-2 p-3 bg-amber-50 border border-amber-200 rounded-lg"},ao={class:"text-xs text-amber-800"},ro={class:"flex items-center gap-2"},lo=["checked"],no={class:"flex gap-3 mt-6 pt-6 border-t border-gray-200"},io=z({__name:"UserFormModal",props:{isEditing:{type:Boolean},form:{},saving:{type:Boolean},colaboradores:{}},emits:["close","submit","update:form"],setup(m,{emit:x}){const b=m,u=x,v=U(""),_=(h,o)=>{u("update:form",{...b.form,[h]:o})},r=()=>{if(!v.value)return;const h=b.colaboradores.find(n=>n.id===v.value);if(!h)return;const o={...b.form};o.nome=h.nome,h.email_corporativo&&(o.email=h.email_corporativo),o.password="Qualitec@2025",o.colaborador_id=h.id,o.role||(o.role="funcionario"),u("update:form",o),alert(`‚úÖ Dados preenchidos automaticamente!

Senha padr√£o: Qualitec@2025

Revise os dados e clique em "Criar Usu√°rio".`)};return(h,o)=>{const n=j("Icon"),C=T,i=L,S=R;return p(),y("div",Ge,[e("div",{class:"absolute inset-0 bg-black/50",onClick:o[0]||(o[0]=t=>h.$emit("close"))}),e("div",He,[e("div",Qe,[e("h3",Je,g(m.isEditing?"Editar Usu√°rio":"Novo Usu√°rio"),1),e("button",{class:"p-2 hover:bg-gray-100 rounded-lg",onClick:o[1]||(o[1]=t=>h.$emit("close"))},[d(n,{name:"heroicons:x-mark",size:"24"})])]),e("form",{class:"p-6",onSubmit:o[9]||(o[9]=P(t=>h.$emit("submit"),["prevent"]))},[e("div",Ke,[e("div",null,[o[10]||(o[10]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Nome *",-1)),d(C,{"model-value":m.form.nome,"onUpdate:modelValue":o[2]||(o[2]=t=>_("nome",t)),type:"text",required:""},null,8,["model-value"])]),e("div",null,[o[11]||(o[11]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Email *",-1)),d(C,{"model-value":m.form.email,"onUpdate:modelValue":o[3]||(o[3]=t=>_("email",t)),type:"email",required:""},null,8,["model-value"])]),m.isEditing?I("",!0):(p(),y("div",We,[o[13]||(o[13]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Senha *",-1)),d(C,{"model-value":m.form.password,"onUpdate:modelValue":o[4]||(o[4]=t=>_("password",t)),type:"password",required:""},null,8,["model-value"]),e("p",Xe,[o[12]||(o[12]=A(" M√≠nimo 6 caracteres ",-1)),m.form.password==="Qualitec@2025"?(p(),y("span",Ye," ‚úì Senha padr√£o aplicada ")):I("",!0)])])),e("div",null,[o[15]||(o[15]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Tipo de Acesso *",-1)),d(i,{"model-value":m.form.role,"onUpdate:modelValue":o[5]||(o[5]=t=>_("role",t)),required:""},{default:k(()=>[...o[14]||(o[14]=[e("option",{value:""},"Selecione",-1),e("option",{value:"admin"},"Administrador",-1),e("option",{value:"funcionario"},"Funcion√°rio",-1)])]),_:1},8,["model-value"])]),e("div",null,[o[26]||(o[26]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," Este usu√°rio √â qual colaborador? (opcional) ",-1)),e("div",Ze,[d(i,{modelValue:a(v),"onUpdate:modelValue":o[6]||(o[6]=t=>_e(v)?v.value=t:null)},{default:k(()=>[o[16]||(o[16]=e("option",{value:""},"Nenhum - Criar usu√°rio sem v√≠nculo",-1)),(p(!0),y(B,null,N(m.colaboradores,t=>(p(),y("option",{key:t.id,value:t.id},g(t.nome)+g(t.email_corporativo?` (${t.email_corporativo})`:""),9,eo))),128))]),_:1},8,["modelValue"]),a(v)?(p(),y("button",{key:0,type:"button",onClick:r,class:"w-full px-4 py-2 bg-green-600 hover:bg-green-700 text-white text-sm font-medium rounded-lg transition-colors flex items-center justify-center gap-2"},[d(n,{name:"heroicons:sparkles",size:"18"}),o[17]||(o[17]=A(" Autopreencher com dados deste colaborador ",-1))])):I("",!0)]),e("div",oo,[e("p",to,[d(n,{name:"heroicons:information-circle",size:"14",class:"inline"}),o[18]||(o[18]=e("strong",null,"O que significa?",-1)),o[19]||(o[19]=e("br",null,null,-1)),o[20]||(o[20]=A(" Vincule se este usu√°rio do sistema √â um colaborador j√° cadastrado no RH.",-1)),o[21]||(o[21]=e("br",null,null,-1)),o[22]||(o[22]=A(' Exemplo: Criar login para "Silvana" ‚Üí Selecione o colaborador "Silvana" ',-1))])]),e("div",so,[e("p",ao,[d(n,{name:"heroicons:light-bulb",size:"14",class:"inline"}),o[23]||(o[23]=e("strong",null,"Hierarquia (quem responde a quem):",-1)),o[24]||(o[24]=e("br",null,null,-1)),o[25]||(o[25]=A(' Configure no cadastro do Colaborador, no campo "Gestor Direto" ',-1))])])]),e("div",ro,[e("input",{type:"checkbox",checked:m.form.ativo,onChange:o[7]||(o[7]=t=>_("ativo",t.target.checked)),class:"w-4 h-4 text-red-700 border-gray-300 rounded focus:ring-red-500"},null,40,lo),o[27]||(o[27]=e("label",{class:"text-sm font-medium text-gray-700"},"Usu√°rio ativo",-1))])]),e("div",no,[d(S,{type:"button",theme:"admin",variant:"secondary","full-width":"",onClick:o[8]||(o[8]=t=>h.$emit("close"))},{default:k(()=>[...o[28]||(o[28]=[A("Cancelar",-1)])]),_:1}),d(S,{type:"submit",theme:"admin",variant:"primary","full-width":"",disabled:m.saving},{default:k(()=>[A(g(m.saving?"Salvando...":m.isEditing?"Salvar":"Criar Usu√°rio"),1)]),_:1},8,["disabled"])])],32)])])}}}),uo=Object.assign(io,{__name:"UserFormModal"}),mo={class:"fixed inset-0 z-50 flex items-center justify-center"},co={class:"relative bg-white rounded-xl shadow-xl w-full max-w-md mx-4"},vo={class:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between rounded-t-xl"},po={class:"space-y-4"},bo=["disabled"],fo={key:0,class:"text-xs text-amber-600 mt-1"},go=["value"],xo={class:"flex items-center gap-2"},yo={class:"flex gap-3 mt-6 pt-6 border-t border-gray-200"},_o=z({__name:"UserEditModal",props:{user:{},colaboradores:{}},emits:["close","save"],setup(m,{expose:x,emit:b}){const u=m,v=b,_=U(!1),r=U({nome:u.user.nome,email:u.user.email,password:"",role:u.user.role,colaborador_id:u.user.colaborador_id||"",ativo:u.user.ativo}),h=async()=>{if(!r.value.nome||!r.value.email){alert("‚ùå Nome e email s√£o obrigat√≥rios!");return}if(r.value.password&&r.value.password.length<6){alert("‚ùå Senha deve ter no m√≠nimo 6 caracteres!");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r.value.email)){alert("‚ùå Email inv√°lido!");return}_.value=!0;const n={nome:r.value.nome,email:r.value.email.toLowerCase().trim(),role:r.value.role,colaborador_id:r.value.colaborador_id||null,ativo:r.value.ativo};r.value.password&&(n.password=r.value.password),v("save",n)};return x({saving:_}),(o,n)=>{const C=j("Icon"),i=T,S=L,t=R;return p(),y("div",mo,[e("div",{class:"absolute inset-0 bg-black/50",onClick:n[0]||(n[0]=l=>o.$emit("close"))}),e("div",co,[e("div",vo,[n[9]||(n[9]=e("h3",{class:"text-xl font-bold text-gray-800"},"Editar Usu√°rio",-1)),e("button",{class:"p-2 hover:bg-gray-100 rounded-lg",onClick:n[1]||(n[1]=l=>o.$emit("close"))},[d(C,{name:"heroicons:x-mark",size:"24"})])]),e("form",{class:"p-6",onSubmit:P(h,["prevent"])},[e("div",po,[e("div",null,[n[10]||(n[10]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Nome *",-1)),d(i,{modelValue:a(r).nome,"onUpdate:modelValue":n[2]||(n[2]=l=>a(r).nome=l),type:"text",required:""},null,8,["modelValue"])]),e("div",null,[n[11]||(n[11]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Email *",-1)),d(i,{modelValue:a(r).email,"onUpdate:modelValue":n[3]||(n[3]=l=>a(r).email=l),type:"email",required:""},null,8,["modelValue"])]),e("div",null,[n[12]||(n[12]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Nova Senha (deixe vazio para manter)",-1)),d(i,{modelValue:a(r).password,"onUpdate:modelValue":n[4]||(n[4]=l=>a(r).password=l),type:"password",placeholder:"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"},null,8,["modelValue"]),n[13]||(n[13]=e("p",{class:"text-xs text-gray-500 mt-1"},"M√≠nimo 6 caracteres",-1))]),e("div",null,[n[15]||(n[15]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"N√≠vel de Acesso *",-1)),d(S,{modelValue:a(r).role,"onUpdate:modelValue":n[5]||(n[5]=l=>a(r).role=l),required:""},{default:k(()=>[n[14]||(n[14]=e("option",{value:"funcionario"},"Funcion√°rio",-1)),e("option",{value:"admin",disabled:a(r).email!=="silvana@qualitec.ind.br"}," Administrador "+g(a(r).email!=="silvana@qualitec.ind.br"?"(apenas silvana@qualitec.ind.br)":""),9,bo)]),_:1},8,["modelValue"]),a(r).role==="admin"&&a(r).email!=="silvana@qualitec.ind.br"?(p(),y("p",fo," ‚ö†Ô∏è Apenas silvana@qualitec.ind.br pode ser admin ")):I("",!0)]),e("div",null,[n[17]||(n[17]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Vincular a Colaborador",-1)),d(S,{modelValue:a(r).colaborador_id,"onUpdate:modelValue":n[6]||(n[6]=l=>a(r).colaborador_id=l)},{default:k(()=>[n[16]||(n[16]=e("option",{value:""},"Nenhum v√≠nculo",-1)),(p(!0),y(B,null,N(m.colaboradores,l=>(p(),y("option",{key:l.id,value:l.id},g(l.nome)+g(l.email_corporativo?` (${l.email_corporativo})`:""),9,go))),128))]),_:1},8,["modelValue"])]),e("div",xo,[oe(e("input",{type:"checkbox","onUpdate:modelValue":n[7]||(n[7]=l=>a(r).ativo=l),class:"w-4 h-4 text-red-700 border-gray-300 rounded focus:ring-red-500"},null,512),[[te,a(r).ativo]]),n[18]||(n[18]=e("label",{class:"text-sm font-medium text-gray-700"},"Usu√°rio ativo",-1))])]),e("div",yo,[d(t,{type:"button",theme:"admin",variant:"secondary","full-width":"",onClick:n[8]||(n[8]=l=>o.$emit("close"))},{default:k(()=>[...n[19]||(n[19]=[A(" Cancelar ",-1)])]),_:1}),d(t,{type:"submit",theme:"admin",variant:"primary","full-width":"",disabled:a(_)},{default:k(()=>[A(g(a(_)?"Salvando...":"Salvar Altera√ß√µes"),1)]),_:1},8,["disabled"])])],32)])])}}}),wo=Object.assign(_o,{__name:"UserEditModal"}),ho={class:"fixed inset-0 z-50 flex items-center justify-center"},$o={class:"relative bg-white rounded-xl shadow-xl w-full max-w-md mx-4"},Co={class:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between rounded-t-xl"},Uo={class:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6"},ko={class:"flex items-center gap-3"},So={class:"w-12 h-12 bg-blue-600 rounded-full flex items-center justify-center text-white font-semibold"},Eo={class:"font-semibold text-gray-800"},Ao={class:"text-sm text-gray-600"},Vo={key:0,class:"text-xs text-gray-500"},Io={class:"space-y-4"},zo=["disabled"],jo={class:"flex items-center gap-2"},qo={class:"flex gap-3 mt-6 pt-6 border-t border-gray-200"},Mo=z({__name:"UserCreateFromColaboradorModal",props:{colaborador:{}},emits:["close","save"],setup(m,{expose:x,emit:b}){const u=m,v=b,_=U(!1),r=U({email:u.colaborador.email_corporativo||"",password:"",role:"funcionario",ativo:!0}),h=M(()=>r.value.email.toLowerCase()==="silvana@qualitec.ind.br"),o=C=>{const i=C.split(" ");return i.length===1?i[0].substring(0,2).toUpperCase():(i[0][0]+i[i.length-1][0]).toUpperCase()},n=async()=>{if(!r.value.email||!r.value.password){alert("‚ùå Email e senha s√£o obrigat√≥rios!");return}if(r.value.password.length<6){alert("‚ùå Senha deve ter no m√≠nimo 6 caracteres!");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r.value.email)){alert("‚ùå Email inv√°lido!");return}_.value=!0,v("save",{nome:u.colaborador.nome,email:r.value.email.toLowerCase().trim(),password:r.value.password,role:r.value.role,colaborador_id:u.colaborador.id,ativo:r.value.ativo})};return x({saving:_}),(C,i)=>{const S=j("Icon"),t=T,l=L,c=R;return p(),y("div",ho,[e("div",{class:"absolute inset-0 bg-black/50",onClick:i[0]||(i[0]=f=>C.$emit("close"))}),e("div",$o,[e("div",Co,[i[7]||(i[7]=e("h3",{class:"text-xl font-bold text-gray-800"},"Criar Acesso ao Sistema",-1)),e("button",{class:"p-2 hover:bg-gray-100 rounded-lg",onClick:i[1]||(i[1]=f=>C.$emit("close"))},[d(S,{name:"heroicons:x-mark",size:"24"})])]),e("form",{class:"p-6",onSubmit:P(n,["prevent"])},[e("div",Uo,[e("div",ko,[e("div",So,g(o(m.colaborador.nome)),1),e("div",null,[e("p",Eo,g(m.colaborador.nome),1),e("p",Ao,g(m.colaborador.cpf),1),m.colaborador.cargo?(p(),y("p",Vo,g(m.colaborador.cargo.nome),1)):I("",!0)])])]),e("div",Io,[e("div",null,[i[8]||(i[8]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Email de Login *",-1)),d(t,{modelValue:a(r).email,"onUpdate:modelValue":i[2]||(i[2]=f=>a(r).email=f),type:"email",required:"",placeholder:"usuario@qualitec.ind.br"},null,8,["modelValue"]),i[9]||(i[9]=e("p",{class:"text-xs text-gray-500 mt-1"}," Este email ser√° usado para fazer login no sistema ",-1))]),e("div",null,[i[10]||(i[10]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Senha Inicial *",-1)),d(t,{modelValue:a(r).password,"onUpdate:modelValue":i[3]||(i[3]=f=>a(r).password=f),type:"password",required:"",placeholder:"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"},null,8,["modelValue"]),i[11]||(i[11]=e("p",{class:"text-xs text-gray-500 mt-1"},"M√≠nimo 6 caracteres",-1))]),e("div",null,[i[13]||(i[13]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"N√≠vel de Acesso *",-1)),d(l,{modelValue:a(r).role,"onUpdate:modelValue":i[4]||(i[4]=f=>a(r).role=f),required:""},{default:k(()=>[i[12]||(i[12]=e("option",{value:"funcionario"},"üë§ Funcion√°rio (Portal do Funcion√°rio)",-1)),e("option",{value:"admin",disabled:!a(h)}," üëë Administrador (Acesso Total) "+g(a(h)?"":" - Apenas silvana@qualitec.ind.br"),9,zo)]),_:1},8,["modelValue"])]),e("div",jo,[oe(e("input",{type:"checkbox","onUpdate:modelValue":i[5]||(i[5]=f=>a(r).ativo=f),class:"w-4 h-4 text-red-700 border-gray-300 rounded focus:ring-red-500"},null,512),[[te,a(r).ativo]]),i[14]||(i[14]=e("label",{class:"text-sm font-medium text-gray-700"},"Usu√°rio ativo (pode fazer login)",-1))])]),e("div",qo,[d(c,{type:"button",theme:"admin",variant:"secondary","full-width":"",onClick:i[6]||(i[6]=f=>C.$emit("close"))},{default:k(()=>[...i[15]||(i[15]=[A(" Cancelar ",-1)])]),_:1}),d(c,{type:"submit",theme:"admin",variant:"primary","full-width":"",disabled:a(_)},{default:k(()=>[A(g(a(_)?"Criando...":"Criar Acesso"),1)]),_:1},8,["disabled"])])],32)])])}}}),Fo=Object.assign(Mo,{__name:"UserCreateFromColaboradorModal"}),Bo=()=>{const m=se(),x=U([]),b=U(!1),u=U(null),v=async()=>{b.value=!0,u.value=null;try{const t=await $fetch("/api/users/list");if(t.success)return x.value=t.data,{success:!0,data:t.data};throw new Error("Falha ao carregar usu√°rios")}catch(t){return console.error("Erro ao listar usu√°rios:",t),u.value=t.data?.message||t.message||"Erro ao carregar usu√°rios",{success:!1,error:u.value}}finally{b.value=!1}},_=async t=>{b.value=!0,u.value=null;try{const{data:l,error:c}=await m.from("app_users").select("*").eq("id",t).single();if(c)throw c;return{success:!0,data:l}}catch(l){return u.value=l.message,{success:!1,error:l.message}}finally{b.value=!1}},r=async t=>{b.value=!0,u.value=null;try{const l=await $fetch("/api/users/create",{method:"POST",body:{email:t.email,password:t.password,nome:t.nome,role:t.role||"funcionario",colaborador_id:t.colaborador_id}});return await v(),{success:!0,data:l.data}}catch(l){console.error("Erro ao criar usu√°rio:",l);let c="Erro ao criar usu√°rio";if(l.data?.message?c=l.data.message:l.data?.statusMessage?c=l.data.statusMessage:l.message&&!l.message.includes("[POST]")?c=l.message:l.statusMessage&&(c=l.statusMessage),c.includes("[POST]")||c.includes("[GET]")){const f=c.match(/\d{3}\s+(.+)$/);f&&(c=f[1])}return u.value=c,{success:!1,error:c}}finally{b.value=!1}},h=async(t,l)=>{b.value=!0,u.value=null;try{const c=await $fetch("/api/users/update",{method:"PUT",body:{id:t,...l}});if(c.success)return await v(),{success:!0,data:c.data};throw new Error("Falha ao atualizar usu√°rio")}catch(c){console.error("Erro ao atualizar usu√°rio:",c);const f=c.data?.message||c.message||"Erro ao atualizar usu√°rio";return u.value=f,{success:!1,error:f}}finally{b.value=!1}},o=async(t,l)=>await h(t,{ativo:l}),n=async t=>await o(t,!1),C=t=>{let l=[...x.value];if(t.search){const c=t.search.toLowerCase();l=l.filter(f=>f.nome.toLowerCase().includes(c)||f.email.toLowerCase().includes(c))}if(t.role&&t.role!=="all"&&(l=l.filter(c=>c.role===t.role)),t.status&&t.status!=="all"){const c=t.status==="ativo";l=l.filter(f=>f.ativo===c)}return l},i=M(()=>({admin:x.value.filter(t=>t.role==="admin").length,funcionario:x.value.filter(t=>t.role==="funcionario").length,total:x.value.length})),S=M(()=>({ativo:x.value.filter(t=>t.ativo).length,inativo:x.value.filter(t=>!t.ativo).length}));return{users:x,loading:b,error:u,countByRole:i,countByStatus:S,fetchUsers:v,fetchUserById:_,createUser:r,updateUser:h,toggleUserStatus:o,deleteUser:n,filterUsers:C}},No={class:"min-h-screen bg-gray-50"},To={class:"bg-white border-b border-gray-200 sticky top-0 z-40"},Lo={class:"max-w-7xl mx-auto px-8 py-4"},Ro={class:"flex items-center justify-between"},Oo={class:"flex items-center gap-4"},Do={class:"max-w-7xl mx-auto p-8"},Po={class:"grid md:grid-cols-4 gap-6 mb-8"},Go={class:"card bg-red-50 border-2 border-red-200"},Ho={class:"flex items-center gap-4"},Qo={class:"w-12 h-12 bg-red-700 rounded-lg flex items-center justify-center"},Jo={class:"text-2xl font-bold text-gray-800"},Ko={class:"card"},Wo={class:"flex items-center gap-4"},Xo={class:"w-12 h-12 bg-red-600 rounded-lg flex items-center justify-center"},Yo={class:"text-2xl font-bold text-gray-800"},Zo={class:"card"},et={class:"flex items-center gap-4"},ot={class:"w-12 h-12 bg-blue-600 rounded-lg flex items-center justify-center"},tt={class:"text-2xl font-bold text-gray-800"},st={class:"card"},at={class:"flex items-center gap-4"},rt={class:"w-12 h-12 bg-green-600 rounded-lg flex items-center justify-center"},lt={class:"text-2xl font-bold text-gray-800"},nt={class:"card mb-8"},it={class:"flex flex-col md:flex-row gap-4 items-start md:items-center justify-between"},dt={class:"flex flex-col md:flex-row gap-4 flex-1"},ut={class:"flex-1"},mt={key:1,class:"card text-center py-12"},ct={key:2,class:"card overflow-hidden"},vt={class:"overflow-x-auto"},pt={class:"w-full"},bt={class:"divide-y divide-gray-200"},ft={class:"px-6 py-4"},gt={class:"flex items-center gap-3"},xt={class:"flex items-center gap-2"},yt={class:"font-medium text-gray-800"},_t={key:0,class:"text-xl",title:"Administradora"},wt={key:1,class:"text-lg",title:"Funcion√°rio"},ht={class:"px-6 py-4 text-sm text-gray-600"},$t={class:"px-6 py-4"},Ct={class:"px-6 py-4"},Ut={class:"px-6 py-4 text-sm text-gray-600"},kt={class:"px-6 py-4"},St={key:3,class:"card text-center py-12"},jt=z({__name:"users",setup(m){const{users:x,loading:b,countByRole:u,countByStatus:v,fetchUsers:_,filterUsers:r,toggleUserStatus:h,createUser:o,updateUser:n}=Bo(),C=U({search:"",role:"all",status:"all"}),i=U(!1),S=U(!1),t=U(!1),l=U(null),c=U(null),f=U(!1),G={nome:"",email:"",password:"",role:"funcionario",colaborador_id:"",ativo:!0},V=U({...G}),O=U([]),H=U([]),Q=M(()=>r(C.value)),J=M(()=>{const $=x.value.filter(s=>s.colaborador_id).map(s=>s.colaborador_id);return H.value.filter(s=>{const E=$.includes(s.id),D=s.email_corporativo?.toLowerCase()==="silvana@qualitec.ind.br";return s.status==="Ativo"&&!E&&!D})});we(async()=>{await Promise.all([_(),K()])});const K=async()=>{const $=se(),{data:s}=await $.from("colaboradores").select("id, nome, email_corporativo").eq("status","Ativo").order("nome");O.value=s||[];const{data:E}=await $.from("colaboradores").select("id, nome, cpf, email_corporativo, status, cargo:cargo_id(id, nome)").eq("status","Ativo").order("nome");H.value=E||[]},ae=$=>{const s=$.split(" ");return s.length===1?s[0].substring(0,2).toUpperCase():(s[0][0]+s[s.length-1][0]).toUpperCase()},re=$=>new Date($).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric"}),W=()=>{i.value=!1,S.value=!1,V.value={...G}},le=async()=>{if(!V.value.nome||!V.value.email){alert("‚ùå Nome e email s√£o obrigat√≥rios!");return}if(!V.value.password||V.value.password.length<6){alert("‚ùå Senha deve ter no m√≠nimo 6 caracteres!");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(V.value.email)){alert("‚ùå Email inv√°lido! Use um formato v√°lido como: usuario@empresa.com");return}f.value=!0;try{const s=await o({nome:V.value.nome,email:V.value.email.toLowerCase().trim(),password:V.value.password,role:V.value.role,colaborador_id:V.value.colaborador_id||void 0});s.success?(alert(`‚úÖ Usu√°rio criado com sucesso!

O usu√°rio j√° pode fazer login no sistema.`),W()):alert(`‚ùå Erro ao criar usu√°rio:

${s.error}`)}catch(s){alert(`‚ùå Erro ao criar usu√°rio:

${s.message||"Erro desconhecido"}`)}finally{f.value=!1}},ne=async $=>{const s=$.ativo?"desativar":"ativar";if(confirm(`Deseja ${s} o usu√°rio ${$.nome}?`)){const E=await h($.id,!$.ativo);E.success?alert(`Usu√°rio ${s}do com sucesso!`):alert(`Erro ao ${s} usu√°rio: ${E.error}`)}},ie=$=>{l.value=$,S.value=!0},X=()=>{S.value=!1,l.value=null},de=async $=>{if(l.value){f.value=!0;try{const s=await n(l.value.id,$);s.success?(alert("‚úÖ Usu√°rio atualizado com sucesso!"),X()):alert(`‚ùå Erro ao atualizar usu√°rio:

${s.error}`)}catch(s){alert(`‚ùå Erro ao atualizar usu√°rio:

${s.message||"Erro desconhecido"}`)}finally{f.value=!1}}},ue=$=>{c.value=$,t.value=!0},Y=()=>{t.value=!1,c.value=null},me=async $=>{f.value=!0;try{const s=await o($);s.success?(alert(`‚úÖ Acesso criado com sucesso!

O colaborador j√° pode fazer login no sistema.`),Y(),await K()):alert(`‚ùå Erro ao criar acesso:

${s.error}`)}catch(s){alert(`‚ùå Erro ao criar acesso:

${s.message||"Erro desconhecido"}`)}finally{f.value=!1}};return($,s)=>{const E=j("Icon"),D=he,ce=$e,ve=Ne,pe=T,Z=L,ee=Le,be=Pe,fe=uo,ge=wo,xe=Fo;return p(),y("div",No,[e("header",To,[e("div",Lo,[e("div",Ro,[e("div",Oo,[d(D,{to:"/admin",class:"w-10 h-10 bg-red-700 rounded-lg flex items-center justify-center hover:bg-red-800 transition-colors"},{default:k(()=>[d(E,{name:"heroicons:arrow-left",class:"text-white",size:"20"})]),_:1}),s[6]||(s[6]=e("div",null,[e("h1",{class:"text-xl font-bold text-gray-800"},"Gest√£o de Usu√°rios"),e("p",{class:"text-sm text-gray-500"},"Gerenciar usu√°rios do sistema")],-1))]),d(ce,{theme:"admin"})])])]),e("div",Do,[a(J).length>0?(p(),q(ve,{key:0,"colaboradores-sem-acesso":a(J),onCriarAcesso:ue,class:"mb-8"},null,8,["colaboradores-sem-acesso"])):I("",!0),e("div",Po,[e("div",Go,[e("div",Ho,[e("div",Qo,[d(E,{name:"heroicons:users",class:"text-white",size:"24"})]),e("div",null,[s[7]||(s[7]=e("p",{class:"text-sm text-gray-600"},"Total",-1)),e("p",Jo,g(a(u).total),1)])])]),e("div",Ko,[e("div",Wo,[e("div",Xo,[d(E,{name:"heroicons:shield-check",class:"text-white",size:"24"})]),e("div",null,[s[8]||(s[8]=e("p",{class:"text-sm text-gray-600"},"Admins",-1)),e("p",Yo,g(a(u).admin),1)])])]),e("div",Zo,[e("div",et,[e("div",ot,[d(E,{name:"heroicons:user-group",class:"text-white",size:"24"})]),e("div",null,[s[9]||(s[9]=e("p",{class:"text-sm text-gray-600"},"Funcion√°rios",-1)),e("p",tt,g(a(u).funcionario),1)])])]),e("div",st,[e("div",at,[e("div",rt,[d(E,{name:"heroicons:check-circle",class:"text-white",size:"24"})]),e("div",null,[s[10]||(s[10]=e("p",{class:"text-sm text-gray-600"},"Ativos",-1)),e("p",lt,g(a(v).ativo),1)])])])]),e("div",nt,[e("div",it,[e("div",dt,[e("div",ut,[d(pe,{modelValue:a(C).search,"onUpdate:modelValue":s[0]||(s[0]=w=>a(C).search=w),type:"text",placeholder:"Buscar por nome ou email...","icon-left":"heroicons:magnifying-glass"},null,8,["modelValue"])]),d(Z,{modelValue:a(C).role,"onUpdate:modelValue":s[1]||(s[1]=w=>a(C).role=w),"icon-left":"heroicons:user-circle",class:"w-full md:w-48"},{default:k(()=>[...s[11]||(s[11]=[e("option",{value:"all"},"Todos os roles",-1),e("option",{value:"admin"},"Admin",-1),e("option",{value:"funcionario"},"Funcion√°rio",-1)])]),_:1},8,["modelValue"]),d(Z,{modelValue:a(C).status,"onUpdate:modelValue":s[2]||(s[2]=w=>a(C).status=w),"icon-left":"heroicons:check-badge",class:"w-full md:w-48"},{default:k(()=>[...s[12]||(s[12]=[e("option",{value:"all"},"Todos os status",-1),e("option",{value:"ativo"},"Ativos",-1),e("option",{value:"inativo"},"Inativos",-1)])]),_:1},8,["modelValue"])]),d(ee,{onClick:s[3]||(s[3]=w=>i.value=!0)})])]),a(b)?(p(),y("div",mt,[d(E,{name:"heroicons:arrow-path",class:"animate-spin text-gray-400 mx-auto mb-4",size:"48"}),s[13]||(s[13]=e("p",{class:"text-gray-600"},"Carregando usu√°rios...",-1))])):a(Q).length>0?(p(),y("div",ct,[e("div",vt,[e("table",pt,[s[14]||(s[14]=e("thead",{class:"bg-gray-50 border-b border-gray-200"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase"},"Usu√°rio"),e("th",{class:"px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase"},"Email"),e("th",{class:"px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase"},"Role"),e("th",{class:"px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase"},"Status"),e("th",{class:"px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase"},"Criado em"),e("th",{class:"px-6 py-3 text-right text-xs font-semibold text-gray-600 uppercase"},"A√ß√µes")])],-1)),e("tbody",bt,[(p(!0),y(B,null,N(a(Q),w=>(p(),y("tr",{key:w.id,class:"hover:bg-gray-50"},[e("td",ft,[e("div",gt,[e("div",{class:F(["w-10 h-10 rounded-full flex items-center justify-center text-white font-semibold",w.role==="admin"?"bg-red-700":"bg-blue-900"])},g(ae(w.nome)),3),e("div",xt,[e("p",yt,g(w.nome),1),w.role==="admin"?(p(),y("span",_t," üëë ")):(p(),y("span",wt," üë§ "))])])]),e("td",ht,g(w.email),1),e("td",$t,[e("span",{class:F(["badge",w.role==="admin"?"badge-error":"badge-info"])},g(w.role),3)]),e("td",Ct,[e("span",{class:F(["badge",w.ativo?"badge-success":"badge-warning"])},g(w.ativo?"Ativo":"Inativo"),3)]),e("td",Ut,g(re(w.created_at)),1),e("td",kt,[d(be,{"is-active":w.ativo,onToggleStatus:ye=>ne(w),onEdit:ye=>ie(w)},null,8,["is-active","onToggleStatus","onEdit"])])]))),128))])])])])):(p(),y("div",St,[d(E,{name:"heroicons:users",class:"text-gray-300 mx-auto mb-4",size:"64"}),s[15]||(s[15]=e("h3",{class:"text-lg font-semibold text-gray-800 mb-2"},"Nenhum usu√°rio encontrado",-1)),s[16]||(s[16]=e("p",{class:"text-gray-600 mb-6"},"Ajuste os filtros ou crie um novo usu√°rio",-1)),d(ee,{onClick:s[4]||(s[4]=w=>i.value=!0)})]))]),a(i)?(p(),q(fe,{key:0,"is-editing":!1,form:a(V),saving:a(f),colaboradores:a(O),onClose:W,onSubmit:le,"onUpdate:form":s[5]||(s[5]=w=>V.value=w)},null,8,["form","saving","colaboradores"])):I("",!0),a(S)&&a(l)?(p(),q(ge,{key:1,user:a(l),colaboradores:a(O),onClose:X,onSave:de},null,8,["user","colaboradores"])):I("",!0),a(t)&&a(c)?(p(),q(xe,{key:2,colaborador:a(c),onClose:Y,onSave:me},null,8,["colaborador"])):I("",!0)])}}});export{jt as default};
