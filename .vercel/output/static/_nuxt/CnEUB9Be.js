import{r as P,s as T,w,x,D as A,G as D}from"./BSA_tgdP.js";function _(a){if(!a)return 0;const t=a.split(":").map(Number);return(t[0]||0)*60+(t[1]||0)}function s(a){if(a===0)return"0h00";const t=Math.floor(a/60),n=a%60;return`${t}h${n.toString().padStart(2,"0")}`}function M(a,t){return!!(a&&t)}function H(a,t){return!!(a&&!t)||!!(!a&&t)}function m(a){return!!(a.entrada_1&&!a.saida_2)}function F(a,t){const n=t||new Date,d=`${n.getHours().toString().padStart(2,"0")}:${n.getMinutes().toString().padStart(2,"0")}`,e={...a};e.saida_2||(e.saida_2=d);const o=I(e);return a.saida_2||o.avisos.unshift("⏱️ Contagem em tempo real"),o}function I(a){const t=[];let n=0,d=0;const e=[];if(!a.entrada_1)return{totalMinutos:0,horasFormatadas:"--:--",intervaloMinutos:0,intervaloFormatado:"não registrado",avisos:["Entrada não registrada"],detalhes:"Sem entrada registrada"};const o=_(a.entrada_1),l=_(a.saida_1),u=_(a.entrada_2),r=_(a.saida_2),i=_(a.entrada_3),S=_(a.saida_3),C=M(a.saida_1,a.entrada_2),p=H(a.saida_1,a.entrada_2),h=!!(a.entrada_1&&a.saida_1&&a.entrada_2&&a.saida_2),v=!!(a.entrada_3||a.saida_3),E=h&&v&&M(a.saida_2,a.entrada_3),R=h&&v&&H(a.saida_2,a.entrada_3);if(p&&(a.saida_1&&!a.entrada_2?t.push("⚠️ Intervalo incompleto — falta horário de retorno"):!a.saida_1&&a.entrada_2&&t.push("⚠️ Intervalo incompleto — falta horário de início do intervalo")),R&&(a.saida_2&&a.entrada_3&&!a.saida_3?t.push("⚠️ Hora extra iniciada — falta horário de saída"):!a.saida_2&&a.entrada_3&&t.push("⚠️ Registro inconsistente — entrada extra sem saída da jornada")),a.entrada_1&&a.saida_2&&!a.saida_1&&!a.entrada_2)n=r-o,e.push(`Entrada (${a.entrada_1}) → Saída (${a.saida_2})`),e.push(`Cálculo: ${a.saida_2} - ${a.entrada_1} = ${s(n)}`),t.push("ℹ️ Nenhum intervalo registrado");else if(C){const c=l-o;if(n+=c,e.push(`Período 1: ${a.entrada_1} → ${a.saida_1} = ${s(c)}`),d=u-l,e.push(`Intervalo: ${a.saida_1} → ${a.entrada_2} = ${s(d)}`),a.saida_2){const f=r-u;n+=f,e.push(`Período 2: ${a.entrada_2} → ${a.saida_2} = ${s(f)}`)}if(E&&a.saida_3){const f=S-i;n+=f;const $=i-r;d+=$,e.push(`Intervalo 2: ${a.saida_2} → ${a.entrada_3} = ${s($)}`),e.push(`Período 3: ${a.entrada_3} → ${a.saida_3} = ${s(f)}`)}e.push(`Total: ${s(n)} (descontado ${s(d)} de intervalo)`)}else if(p){let c=o;a.saida_2?c=r:a.entrada_2?c=u:a.saida_1&&(c=l),n=c-o,e.push(`Entrada (${a.entrada_1}) → Último registro`),e.push(`Cálculo sem desconto de intervalo: ${s(n)}`),e.push("⚠️ Intervalo não descontado (incompleto)")}else a.entrada_1&&a.saida_1&&!a.entrada_2&&!a.saida_2?(n=l-o,e.push(`Entrada (${a.entrada_1}) → Saída (${a.saida_1})`),e.push(`Cálculo: ${s(n)}`)):a.entrada_1&&!a.saida_1&&!a.entrada_2&&!a.saida_2&&(t.push("⏱️ Registro em andamento ou incompleto"),e.push("Apenas entrada registrada"),n=0);return n<0&&(t.push("❌ ERRO: Horários inválidos (duração negativa)"),n=0),d<0&&(t.push("❌ ERRO: Intervalo com duração negativa"),d=0),d>180&&t.push("⚠️ Intervalo muito longo (mais de 3 horas)"),n>720&&t.push("⚠️ Jornada muito longa (mais de 12 horas)"),{totalMinutos:n,horasFormatadas:n>0?s(n):"--:--",intervaloMinutos:d,intervaloFormatado:d>0?s(d):"não registrado",avisos:t,detalhes:e.join(`
`)}}function j(a){return a?a.substring(0,5):"--:--"}function J(a){const t=P(new Date);let n=null;const d=()=>{t.value=new Date},e=i=>m(i)?F(i,t.value):I(i),o=T(()=>a.value.some(i=>m(i))),l=()=>{n||(n=D(d,6e4),d())},u=()=>{n&&(clearInterval(n),n=null)},r=()=>{o.value?l():u()};return w(o,i=>{i?l():u()},{immediate:!0}),x(()=>{r()}),A(()=>{u()}),{horaAtual:t,calcularHoras:e,temRegistroEmAndamento:o,registroEmAndamento:m,iniciarTimer:l,pararTimer:u,verificarTimer:r}}export{F as a,I as c,j as f,m as r,J as u};
